"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}!function(t,e){var i=function(i){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,_getPrototypeOf(n).apply(this,arguments))}return _inherits(n,i),_createClass(n,[{key:"_create",value:function(){var e="."+this.name;this._eventSuffix=e+"-temp";var i=this._opts.enableDebounce?"_debounceHandler":"_targetEnter";this.element.on("mouseenter"+e+" mousemove"+e,this[i].bind(this)).on("mouseleave"+e,(function(){t._inTooltipArea=!1})),this._scrollHandlerBinded=this._scrollHandler.bind(this)}},{key:"_scrollHandler",value:function(t){this._hide(void 0,t)}},{key:"_debounceHandler",value:function(t){var e=this;this._moveMoveTimer&&clearTimeout(this._moveMoveTimer),this._removeTitleOnHover(t.target),this._hidePrevInstance(),this._moveMoveTimer=setTimeout((function(){e._targetEnter(t),e._moveMoveTimer=null}),100)}},{key:"_handleEvents",value:function(e){var i=this,n=this._eventSuffix;t.$document.off(n),window.removeEventListener("scroll",this._scrollHandlerBinded,!0),e&&(t.$document.on("keydown"+n+" mousedown"+n,(function(t){i._hide(void 0,t)})),window.addEventListener("scroll",this._scrollHandlerBinded,!0))}},{key:"_targetEnter",value:function(i,n,o){var r,s=this;if(this.custom=!1,this.target&&(this.target.is(":hidden")||this.target.is("button[disabled], input[disabled], textarea[disabled], fieldset[disabled], select[disabled], keygen[disabled] , output[disabled], option[disabled]")))this._hide(void 0,i);else{if(i){if(!i.originalEvent)return;this.pageX=i.pageX,this.pageY=i.pageY;var a,l=this._opts.maxAllowedTraversal;r=i.target;for(var h=0;h<l&&(a=r.hasAttribute("data-ztemp-title"),!(r==this.element[0]||a||r.hasAttribute("title")||r.hasAttribute("data-title-content-id")))&&((r=r.parentElement)&&"BODY"!==r.tagName);h++);if(r=e(r),this.target&&this.target.is(":hover")&&!this.target.find(r).length){if(!this._refreshed&&(this._lastTip||this._hiddenOnTimeOut))return;r=this.target}else if(!r.length||!r.attr("title")&&!r.attr("data-ztemp-title")&&!r.attr("data-title-for-element")||r.attr("data-title-content-id")||this._opts.selector&&!r.is(this._opts.selector))return;this._hidePrevInstance(),t._inTooltipArea=this}else{if(!n)return;this.custom=!0,r=e(n)}this._hiddenOnTimeOut=!1,this.target&&this._clearTitle(!0,this.target),this.target=r,this.targetOpt=this._getOptions(r,o),this.custom&&(this.targetOpt.showDelay=0),this._clearTitle(),this.target.off(this._eventSuffix).on("mouseleave"+this._eventSuffix,(function(t){s._hiddenOnTimeOut=!1,s._hide(void 0,t)})),this._opts.lastTip&&(this._lastEvent=i),this._show(i)}}},{key:"_removeTitleOnHover",value:function(t){if(t.hasAttribute("title")){var e=t.getAttribute("title");t.removeAttribute("title"),t.setAttribute("data-ztemp-title",e)}}},{key:"_hidePrevInstance",value:function(e,i){var n=t._inTooltipArea;if(n){if(this.element.find(n.element[0]).length)return;n._hide(!0),t._inTooltipArea=!1}}},{key:"_hide",value:function(t,e){if(this.target&&this._trigger("beforehide",e)){var i=!this.target.is(":hover");i&&this._clearTitle(!0),this._clearShowTimer(),this._clearHideTimer(),this.container&&this._removeTip(t,i),this._handleEvents()}}},{key:"_show",value:function(t){var e=this,i=this.targetOpt,n=this.target;i.showDelay&&void 0===i.reshowDelay&&(this.targetOpt.reshowDelay=i.showDelay/5),this.targetOpt.hideOnTargetClick&&n.on("mousedown"+this._eventSuffix,(function(t){e._trigger("beforehide",t)&&(e._clearShowTimer(),e._removeTip(!0))})),this._showTooltip(t)}},{key:"_clearShowTimer",value:function(){clearTimeout(this.showTimer)}},{key:"_clearHideTimer",value:function(){clearTimeout(this.hideTimer)}},{key:"_setTimer",value:function(t,e){var i=this,n=e.maxDisplayTime;(n="number"==typeof n?Number(n):0)&&(this._clearHideTimer(),this.hideTimer=setTimeout((function(){i._trigger("beforehide",void 0,{exceededMaxDisplayTime:!0})&&(i._hiddenOnTimeOut=!0,i._removeTip(!0))}),n))}},{key:"_getTitleForEllipsisEle",value:function(t,e){var i=this.target;if("self"!==e&&e&&(i=i.find(e)),i.length){var n=i[0].clientWidth;if(!(""!==i[0].innerText&&n>0&&n>=i[0].scrollWidth))return t.title||i.text()}}},{key:"_showHandler",value:function(t,e){var i=this;if(this._trigger("beforeshow",t)){var n=this.targetOpt;if(!this.target.is(":visible"))return;var o=n.forElement;if(o||!n.ignoreEllipsis){var r=this._getTitleForEllipsisEle(n,o);if(!r)return;n.title=r}this._clearHideTimer(),/^(auto|top|bottom|right|left|top-left|top-right|bottom-left|bottom-right|at-cursor|follow-cursor)$/.test(n.position)||(n.position=this._DEFAULTS.position),this._isAtCursorPos()&&(void 0!==this.pageX&&void 0!==this.pageY||n.offset?n.displayType="box":n.position="top"),this._includeContent(),this._createTooltip(),this._setTimer(this.target,n),"follow-cursor"===n.position&&this.target.on("mousemove"+this._eventSuffix,(function(t){i._positionElement(t),i._setTimer(i.target,n)})),this._positionElement(t),this._handleEvents(!0),this._animate(this.container,e,"show",(function(){i._trigger("show",t)}))}}},{key:"_showTooltip",value:function(t){var e=this.targetOpt,i=e.showDelay,n=e.animation;this.container&&(this.target.is(this._lastTip)?n=i=void 0:(i=e.reshowDelay,this._trigger("hide",t,this._lastTip))),this._opts.lastTip&&(this._lastTip=this.target),this._clearShowTimer(),i?this.showTimer=setTimeout(this._showHandler.bind(this,t,n),i):this._showHandler(t,n)}},{key:"_animate",value:function(i,n,o,r){var s=function(){i.css("display","hide"===o?"none":""),r&&r()};if(n&&t.animationHandler&&!e.isEmptyObject(n)){var a={element:i,action:o,callback:s,ctype:this.name,animation:n};t.animationHandler(a)}else s()}},{key:"_includeContent",value:function(){var e=this.targetOpt;if("object"===_typeof(e)){var i=e.title=e.title||e.content||"";i="string"==typeof e.innerHTML?this._populateTemplate(e.innerHTML,e):"string"==typeof e.contentId?document.getElementById(e.contentId).innerHTML:this._encodeContent(i),e.showShortcutKey&&t.ShortCut&&(i=this._appendShortCut(e,i)),this._setContent(e,i)}}},{key:"_setContent",value:function(t,e){this._opts.content=e}},{key:"_encodeContent",value:function(e){return this.targetOpt.isMessageHTMLEncoded?e:t.encodeHTML(e)}},{key:"_populateTemplate",value:function(t,e){var i=this;return"string"==typeof t?t.replace(/(#?#[^# ]+#?#)/g,(function(t){var n=e[t.replace(/#/g,"")];return i._isNotNull(n)?i._encodeContent(n):t})):"function"==typeof t?t(e):void 0}},{key:"_isAtCursorPos",value:function(){return/^(at-cursor|follow-cursor)$/.test(this.targetOpt.position)}},{key:"_positionElement",value:function(t){var e=this._getPosition(t),i=e.direction.split("-")[0];this.container.removeClass("class").addClass("ztooltip ztooltip--"+i);var n=this.targetOpt.margin;(this._isAtCursorPos()||n&&"object"===_typeof(n))&&this._updateMargin(n,e,i),this.container.css(e.elementPosition),this._callout&&this._callout.css(e.arrowPosition)}},{key:"_getPosition",value:function(i){var n=this.targetOpt,o=this.target,r=n.position,s=n.positionAlterable;this.container.css({left:"auto",right:"auto"});var a=n.offset;return this._isAtCursorPos()||a?(a?(this.pageX=parseInt(a.left),this.pageY=parseInt(a.top)):r="bottom-left",(o=i||{preventDefault:function(){}}).pageX=this.pageX,o.pageY=this.pageY,s="flipallfit"):"auto"===n.position?(r="bottom",s="flipallfit"):void 0===s&&(s=!1),t.Position.get(o,this.container,{rtl:n.rtl,direction:r,eventObj:i,bufferSpace:this._callout?10:0,positionAlterable:s,arrowCallback:function(t,i){e(t).attr("class","ztooltip__pointer zh-"+i)},arrow:"callout"===n.displayType?{element:this._callout,direction:!0,minSpace:8}:void 0})}},{key:"_removeTipHandler",value:function(t){var e=this;if(this.container){if(!t&&this.targetOpt.pauseOnMouseOver&&this.container.is(":hover"))return;this._lastTip=null,this._animate(this.container,this.targetOpt.animation,"hide",(function(){e._callout=null,e._trigger("hide")}))}}},{key:"_removeTip",value:function(t,e){this._lastEvent=!1,this._clearHideTimer(),this.container&&(this.custom&&e&&this._clearTitle(!0,this.target),t||!this.targetOpt.hideDelay?this._removeTipHandler(t):this.hideTimer=setTimeout(this._removeTipHandler.bind(this),this.targetOpt.hideDelay))}},{key:"_getOptions",value:function(t,i){var n=t.attr("title")||t.attr("data-ztemp-title"),o={title:n};if(this._opts.parseTitleForOptions&&n&&isNaN(n)&&-1!==n.indexOf("{"))try{o=JSON.parse(n)}catch(t){}else e.extend(o,this._getTargetAttrs(t));return e.extend(!0,{},this._opts,o,i||{})}},{key:"_createTooltip",value:function(){var t=this,i=this.targetOpt;this._opts.callout="callout"===i.displayType,this._callout=!1;var n=this._render(!!this.container);n&&(this.container?this.container.stop(!0,!0).hide():this.container=e(n).on("mouseleave"+this._eventSuffix,(function(){t.target||t._removeTipHandler()}))),this.container.css("pointer-events",i.pauseOnMouseOver?"auto":"").attr("class","ztooltip "+(i.className||"")+(i.rtl?" h-rtl":"")),this._opts.callout&&(this._callout=this.container.find(".ztooltip__pointer"))}},{key:"_render",value:function(i){var n={skipParent:i};return t._render(this._opts,this.name,null,this.container&&this.container[0],e("body")[0],n)}},{key:"_isUploadFileBtn",value:function(t){return"INPUT"===t.tagName&&"file"===t.type}},{key:"_clearTitle",value:function(t,i){if((i=i||this.target)&&i.length)if(t){i.off(this._eventSuffix);for(var n=i.data("zdependentElements")||[],o=0;o<n.length;o++){var r=e(n[o]),s=r.attr("title");(void 0===s||!s&&this._isUploadFileBtn(r[0]))&&r.attr("title",r.data("ztitle")),r.removeData("ztitle")}i.removeData("zdependentElements");var a=i.data("ztitleId");a&&i.attr("data-title-content-id",a).removeData("ztitleId"),this.target=void 0}else{var l=i[0].hasAttribute("data-ztemp-title")?[]:i.parents("[title]").toArray();l.push(i);for(var h=0;h<l.length;h++){var u=e(l[h]);u.data("ztitle",u.attr("title")),u.removeAttr("title"),this._isUploadFileBtn(u[0])&&(u[0].title="")}i.data("zdependentElements",l);var c=i.attr("data-title-content-id");c&&i.data("ztitleId",c).removeAttr("data-title-content-id")}}},{key:"_trigger",value:function(t,e,i){return this._dispatchEvent(t,e,{target:i||this.target,tooltip:"show"===t?this.container:void 0})}},{key:"_destroy",value:function(){this.element.off("."+this.name),this._hide(!0),this._useParent=this._keepTemplateData=!this.container}},{key:"refresh",value:function(){this._lastEvent&&(this._refreshed=!0,this._targetEnter(this._lastEvent),this._refreshed=!1)}},{key:"setAttribute",value:function(t,i){"object"===_typeof(i)&&this._opts[t]?e.extend(this._opts[t],i):this._opts[t]=i}},{key:"_getTargetAttrs",value:function(e){var i={},n=e[0].attributes;return Object.keys(n).forEach((function(e){var o=n[e];if(o){var r=o.nodeName,s=o.value;r.match(/^data-title-/)&&(r=r.replace(/^data-title-/,"").replace(/-([a-z])/g,(function(t){return t[1].toUpperCase()})).replace(/(html)/gi,"HTML"),i[r]="true"===s||"false"===s?"true"===s:-1===s.indexOf("{")?s:t._getObject(s))}})),i}},{key:"show",value:function(t,i){return(t=e(t||this.element)).length&&((i=i||{}).showDelay=0,this._targetEnter(void 0,t,i)),t}},{key:"hide",value:function(t){this._hide(t)}},{key:"_updateMargin",value:function(t,e,i){var n=t&&parseInt(t.top),o=t&&parseInt(t.left),r=this.targetOpt.rtl?-1:1,s=e.elementPosition;if(isNaN(n)&&(n=0),isNaN(o)&&(o=0),this._isAtCursorPos()){var a=e.availableHeight-this.container.outerHeight();s.left+=o*r,n||(n=Math.min(16,a))}"top"===i?s.top-=n:"bottom"===i?s.top+=n:"right"===i?s.left+=o*r:"left"===i&&(s.left-=o*r)}},{key:"_appendShortCut",value:function(e,i){var n=this.target;n=n.is("label.zbutton")?n.prev("input"):n;var o=t._getOpts(n),r=t.ShortCut.getInfo(o.actionName,n,!1);return r&&(i+=r=e.shortcutKeyCustomHTML?e.shortcutKeyCustomHTML.replace(/(#key#)/gi,r):" ("+r+")"),i}},{key:"name",get:function(){return"ztooltip"}},{key:"attrs",get:function(){return{isMessageHTMLEncoded:!1,selector:void 0,displayType:"box",position:"at-cursor",hideOnTargetClick:!0,margin:void 0,showDelay:500,hideDelay:300,maxDisplayTime:5e3,reshowDelay:void 0,showShortcutKey:!0,enableDebounce:!1,ignoreEllipsis:!0,maxAllowedTraversal:10,animation:{show:{name:"fade"},hide:{name:"fade"}},lastTip:!1,className:void 0,innerHTML:void 0,pauseOnMouseOver:!1,positionAlterable:void 0,parseTitleForOptions:!1,forElement:""}}},{key:"EVENTS",get:function(){return["beforeshow","show","beforehide","hide"]}}]),n}(t.CoreComponent);t.registerComponent("ZTooltip",i)}(ZComponents,ZComponents.DOMUtil),function(t){function e(){var t=o(['<div class="ztooltip__pointer"></div>']);return e=function(){return t},t}function i(){var t=o(['<div class="ztooltip__content">',"</div> ",""]);return i=function(){return t},t}function n(){var t=o(["<div class=\"ztooltip\" style='display:none;'>","</div>"]);return n=function(){return t},t}function o(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}var r=ZComponents.ztooltip.Templates;r.container=function(t){return ZT.html(n(),t.children&&r.children(t))},r.children=function(t){return ZT.html(i(),ZT.customHTML(t.content),t.callout&&ZT.html(e()))}}();