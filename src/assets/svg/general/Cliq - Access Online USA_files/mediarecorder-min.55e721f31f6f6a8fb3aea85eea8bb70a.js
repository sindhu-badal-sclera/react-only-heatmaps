var ZCMediaRecorderUI={},ZCMediaRecorderImpl={},ZCMediaRecorderTemplates={},ZCMediaRecorderHandler={},ZCAudioRecorderWave={};ZCMediaRecorderUI={Constants:{minimizedVideoRecorderDimensions:{bottom:"",left:"calc(50% - 350px)",top:"calc(50% - 257.5px)",right:""},userVidContainerDimForScreenRecorder:{bottom:"45px",left:"45px"},screenRecorderDomResetDimensions:{bottom:"",left:"calc(50% - 185px)",top:"88%",right:""}},bindEvents:function(){ZCJQuery(document).on("click","[zcmediarecorderbuttons]",(function(e){e.stopPropagation();var r=ZCJQuery(this),i=r.attr("purpose");if("openScheduleMsgPopUp"==i){var t=r.attr("chatID"),d={chatID:r.attr("chatID"),triggerElement:r.closest(".zc-schedule-dropDownOption"),id:"voicemsgdropdown"+t,event:e,renderProps:{onDoneBtnClick:function(){var i={chatID:t,event:e,elem:r};ZCMediaRecorderHandler.UIEvents.handleMediaScheduling(i)}}};return ScheduleMessageUtils.updateCurrentValues(d),ScheduleMessageUtils.openScheduleMsgPopUp(d),void e.stopPropagation()}if("handleMediaScheduling"==i){d={chatID:r.attr("chatID"),event:e,elem:r};ZCMediaRecorderHandler.UIEvents.handleMediaScheduling(d)}ZCMediaRecorderHandler.UIEvents[i](e,r)}))},getMediaRecorderWrapper:function(e){var r="[zcaudiorecorder]",i=ZCMediaRecorderImpl.getCurrentAvailableSession(e);return void 0!==i&&i.isVideoRecording()&&(r="[zcvideorecorder]"),ZCJQuery(r+'[sessionid="'+e+'"]')},drawAudiofrequencyCanvas:function(e){var r=ZCMediaRecorderUI.getMediaRecorderWrapper(e).find("[audiowaves]")[0],i=r.getContext("2d");i.beginPath(),i.moveTo(0,r.height/2),i.lineTo(r.width,r.height/2),i.strokeStyle=ZCMediaRecorderConstants.audioWave.LINE_COLOR,i.lineWidth=10,i.stroke()},appendRecorderDomInComposer:function(e,r){var i=$(e).parents("#chatwindropdown");0==i.length&&(i=$(e).parents("[composer-component]").find("[composer-main-container]")),i.append(r)},removeRecorderDomFromComposer:function(e){var r=ZCMediaRecorderUI.getMediaRecorderWrapper(e),i=r.parents("#chatwindropdown");0==i.length&&(i=r.parents("[composer-component]").find("[composer-main-container]")),r.remove()},appendVideoRecorderPreviewInBody:function(e,r){$(document.body).append(e)},removeVideoRecorderPreviewFromBody:function(e){this.getMediaRecorderWrapper(e).remove()},updateRecordingStartInUI:function(e,r,i,t){if(ZCMediaRecorder.isVideoRecording(t)||ZCMediaRecorder.isScreenRecording(t)){var d=ZCMediaRecorderTemplates.getRecorderPreviewDomForVideoMessage(r,i,t),o=$(d);this.appendVideoRecorderPreviewInBody(o,t),ZCMediaRecorder.isScreenRecording(t)?(o.setAsDraggable(MediaUtil.getCriteriaForDrag()),ZCTrack.track("VIDEO_AND_SCREEN_RECORD_MSGS",{action:"screen_recording_started"})):ZCTrack.track("VIDEO_AND_SCREEN_RECORD_MSGS",{action:"video_recording_started"})}else{var s=ZCMediaRecorderTemplates.getRecorderDomForChat(r,i);this.appendRecorderDomInComposer(e,s)}},removeRecordingStartInUI:function(e,r){ZCMediaRecorder.isVideoRecording(r)||ZCMediaRecorder.isScreenRecording(r)?ZCJQuery('[zcvideorecorder][sessionid="'+e+'"]').remove():ZCMediaRecorderUI.removeRecorderDomFromComposer(e)},showDeviceSettings:function(e,r,i,t,d){var o=ZCMediaRecorderTemplates.getDeviceSettingsCustomUI(e,MediaDeviceWidget.getCurrentConfig(r,i,t,d));$("#zcrecorder_device_settings").html(o)}},ZCMediaRecorderImpl={_currentRecordingSession:void 0,_activeRecordedSessions:{},hasCurrentRecordingSession:function(){return void 0!==this._currentRecordingSession},getCurrentRecordingSession:function(){return this._currentRecordingSession},getCurrentAvailableSession:function(e){var r=ZCMediaRecorderImpl.getCurrentRecordingSession();return void 0===r&&ZCMediaRecorderImpl.hasRecordedSession(e)&&(r=this.getRecordedSession(e)),r},setCurrentRecordingSession:function(e){this._currentRecordingSession=e},clearCurrentRecordingSession:function(){this._currentRecordingSession=void 0},moveCurrentRecordingSessionToRecorded:function(){this._activeRecordedSessions[this._currentRecordingSession.getId()]=this._currentRecordingSession,this.clearCurrentRecordingSession()},hasRecordedSession:function(e){return void 0!==this._activeRecordedSessions[e]},getRecordedSession:function(e){return this._activeRecordedSessions[e]},removeRecordedSession:function(e){void 0!==this._activeRecordedSessions[e]&&delete this._activeRecordedSessions[e]},generateSessionId:function(e){return"zcv-"+$zcg._ZUID+"-"+e+"-"+Date.now()},generateFileName:function(e){var r=ZCMediaRecorderConstants.fileName.audio;return e.isVideoMessage()?r=ZCMediaRecorderConstants.fileName.video:e.isScreenRecording()&&(r=ZCMediaRecorderConstants.fileName.screen),r+"-"+$Date.getDateFieldString(new Date)+"-"+(new Date).toLocaleTimeString("en-US",{hour12:!1})},getRecorderSessionTimerId:function(e){return e+"-mediarecordersessiontimer"},getMediaPlayerSessionTimerId:function(e){return e+"-mediaplayersessiontimer"},getSessionForChatId:function(e){var r=ZCMediaRecorderImpl.getCurrentRecordingSession();if(r&&r.getChatId()===e)return r;for(var i in this._activeRecordedSessions){var t=this._activeRecordedSessions[i];if(t.getChatId()===e)return t}},init:function(){ZCMediaRecorderUI.bindEvents()},initiateMediaRecording:function(e,r,i,t,d,o,s,n,a){if(ZCMediaRecorder.isInitialized()){var c=new ZCMediaRecorderSession({session_id:e,receiver_id:r,type:t,chat_id:i,max_duration:o,handler:d,recorder_session_timer_id:ZCMediaRecorderImpl.getRecorderSessionTimerId(e),player_session_timer_id:s,receiver_name:"undefined"!=typeof Users&&"function"==typeof Users.getName?Users.getName(r):""});ZCMediaRecorderImpl.setCurrentRecordingSession(c),ZCMediaRecorder.isScreenRecording(t)&&!Settings.getFromObj("screenrecord_msg_info_viewed")?$WC.$Dlg.create({id:"screen_record_start_alert",version:3,class:"zcl-alert-dialog-2 zcl-screen-record-info-box media-alert-override",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="zcl-img xl flexM mAuto zcf-screen-record-msg"></div>',header:Resource.getRealValue("screen.record.message"),subheader:[MediaUtil.getResource("screen.record.message.info.body")]}),bodyhtml:"",buttons:[$WC.$Dlg.getButtonObj("common.cancel",$zcg._cssClasses.SECONDARY_BTN,(function(){u(),$WC.$Win.destroy("screen_record_start_alert"),Settings.update({screenrecord_msg_info_viewed:"1"})})),$WC.$Dlg.getButtonObj("common.continue",$zcg._cssClasses.PRIMARY_BTN,function(){this.requestStreamAndHandleCallbacks(t,l,u),Settings.update({screenrecord_msg_info_viewed:"1"}),$WC.$Win.destroy("screen_record_start_alert")}.bind(this))]}):this.requestStreamAndHandleCallbacks(t,l,u)}function l(e){c.setAVStream(e),c.initiateRecording(),void 0!==n&&n(e)}function u(r,i){ZCMediaRecorderImpl.handleEnd(e),void 0!==a&&a(r)}},requestStreamAndHandleCallbacks:function(e,r,i){var t=function(e){void 0!==e&&"function"==typeof r&&r(e),MediaManager.resetStreamRequested()},d=function(e,r){"function"==typeof i&&i(e,r),MediaManager.handleMediaError(e,r),MediaManager.resetStreamRequested(),ZCMediaRecorderImpl.clearCurrentRecordingSession()},o=function(){ZCMediaRecorder.isVideoRecording(e)?(MediaManager.setAsStreamRequested(WebRTCUserMedia.streamTypes.AUDIO_VIDEO,ZCMediaConstants.mediaModules.MEDIA_RECORDER),WebRTCUserMedia.requestAudioVideoStream(t,d,MediaUtil.videoResolutions.getConstraintsForVideoRes(MediaUtil.videoResolutions.getPreferredVideoRes()))):ZCMediaRecorder.isAudioRecording(e)&&(MediaManager.setAsStreamRequested(WebRTCUserMedia.streamTypes.AUDIO_ONLY,ZCMediaConstants.mediaModules.MEDIA_RECORDER),WebRTCUserMedia.requestAudioStream(t,d))};ZCMediaRecorder.isScreenRecording(e)?(MediaManager.setAsStreamRequested(WebRTCUserMedia.streamTypes.SCREEN,ZCMediaConstants.mediaModules.MEDIA_RECORDER),WebRTCUserMedia.requestScreenStream((function(e){MediaManager.resetStreamRequested();var r=function(){MediaManager.setAsStreamRequested(WebRTCUserMedia.streamTypes.AUDIO_ONLY,ZCMediaConstants.mediaModules.MEDIA_RECORDER),WebRTCUserMedia.requestAudioStream((function(r){e.addTrack(r._getPrimaryAudioTrack()),t(e)}),(function(){t(e)}))};WebRTCUserMedia.getMediaDevices(r,r)}),d,(function(){var e=ZCMediaRecorderImpl.getCurrentRecordingSession(),r=e.getId(),i=ZCMediaRecorderUI.getMediaRecorderWrapper(e.getId());e.hasRecordingData()?ZCMediaRecorderHandler.UIEvents.finishVideoRecording(void 0,i.find("[purpose=finishVideoRecording]")):(e.removeUserVideoStreamForScreenRecording(),e._closeStream(),ZCMediaRecorderImpl.handleEnd(r))}))):WebRTCUserMedia.getMediaDevices(o,o)},initiateAudioFrequencyAnalyser:function(e){ZCMediaRecorderImpl.hasCurrentRecordingSession()&&(e._stopAudioFrequencyAnalyser(),e._startAudioFrequencyAnalyser(ZCMediaRecorderHandler.recorderEvents.handleRecordingFrequency))},startAudioRecording:function(e,r){this.startMediaRecording(e,r,WebRTCUserMedia.streamTypes.AUDIO_ONLY)},startVideoRecording:function(e,r){this.startMediaRecording(e,r,WebRTCUserMedia.streamTypes.AUDIO_VIDEO)},startScreenRecording:function(e,r){this.startMediaRecording(e,r,WebRTCUserMedia.streamTypes.SCREEN)},startMediaRecording:function(e,r,i){void 0!==r&&MediaManager.handleExistingSessions(function(){var t=Participants.get(r).getRecipientFor121Chat(),d=ZCMediaRecorderImpl.generateSessionId(t);ZCMediaRecorder.isScreenRecording(i)||ZCMediaRecorderUI.updateRecordingStartInUI(e,d,r,i),ZCMediaRecorderImpl.initiateMediaRecording(d,t,r,i,ZCMediaRecorderHandler.recorderEvents,ZCMediaRecorderConstants.MAX_RECORDING_TIME,void 0,(function(t){if(ZCMediaRecorder.isScreenRecording(i)){ZCMediaRecorderUI.updateRecordingStartInUI(e,d,r,i);var o=ZCMediaRecorderUI.getMediaRecorderWrapper(d);ZCMediaRecorderHandler.UIEvents.startRecording(void 0,o.find("[purpose=startRecording]"))}}))}.bind(this))},resetRecorderWithExistingUI:function(e){ZCMediaRecorderImpl.initiateMediaRecording(e.getId(),e.getReceiverId(),e.getChatId(),e.getRecordingType(),ZCMediaRecorderHandler.recorderEvents,ZCMediaRecorderConstants.MAX_RECORDING_TIME,void 0,(function(r){if(e.isScreenRecording()){var i=ZCMediaRecorderUI.getMediaRecorderWrapper(e.getId());ZCMediaRecorderHandler.UIEvents.startRecording(void 0,i.find("[purpose=startRecording]"))}}))},handleEnd:function(e){ZCMediaRecorderImpl.removeUI(e);var r=this.getCurrentRecordingSession();void 0!==r&&r.getId()===e?(r.stopRecording(),this.removeUserVideoInScreenRecording(r),this.clearCurrentRecordingSession()):this.hasRecordedSession(e)&&((r=ZCMediaRecorderImpl.getRecordedSession(e)).pauseRecording(),this.removeUserVideoInScreenRecording(r),r.destroyRecorder(),this.removeRecordedSession(e))},removeUserVideoInScreenRecording:function(e){if(e.isUserVideoEnabledInScreenRecording()){var r=$("#zcrecorderuservideocont");ZCPIPManager.exitPictureInPicture(r.find("video")[0],()=>{r.remove(),e.removeUserVideoStreamForScreenRecording()})}},showCancelRecordingDialogForMediaCall:function(e,r){this._showCancelRecordingDialog(e,r,!0)},showCancelRecordingDialog:function(e,r){this._showCancelRecordingDialog(e,r,!1)},_showCancelRecordingDialog:function(e,r,i){var t="",d="",o="";Config.isScheduleMessageEnabled()&&r.isScheduleMessage()&&"function"==typeof e?e():(r.isVoiceMessage()?t="recording.stop.dialog.body":r.isVideoRecording()&&(t="media.msg.recording.stop.dialog.body",d="media.msg.delete.success",r.isVideoMessage()?o="video.recording":r.isScreenRecording()&&(o="screen.recording")),MediaUtil.createDialog({id:"voicerecord_end_alert",version:3,class:"zcl-alert-dialog-2 zcldel-dialog-box",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="zcl-img xl flexM mAuto zcf-delete2 zcl-img--neg"></div>',header:Resource.getRealValue("common.alert"),subheader:[MediaUtil.getResource(t,[MediaUtil.getResource(o)])]}),bodyhtml:"",buttons:[$WC.$Dlg.getButtonObj("common.cancel",$zcg._cssClasses.SECONDARY_BTN,(function(){$WC.$Win.destroy("voicerecord_end_alert")})),$WC.$Dlg.getButtonObj("common.delete",$zcg._cssClasses.NEG_PRIMARY_BTN,function(){"function"==typeof e&&e(),$WC.$Win.destroy("voicerecord_end_alert"),UI.updateBanner(MediaUtil.getResource(d,[MediaUtil.getResource(o)]))}.bind(this))]},i))},sendRecordedFile:function(e,r,i,t){var d=e.getId(),o=ZCMediaRecorderImpl.generateFileName(e),s=e.getRecordingAsFile(o),n="recording.send.success",a="recording.send.failed",c="",l="",u={};e.isVoiceMessage()?u.is_voice=!0:e.isVideoRecording()&&(n="media.msg.send.success",a="video.msg.send.failed",c="media.msg.delete.success",e.isVideoMessage()?(u.is_video=!0,l="video.recording"):e.isScreenRecording()&&(u.is_screenrecord=!0,l="screen.recording"),u.mime_type=ZCMediaRecorderConstants.recordingFormat.video);var g=function(e,i,t){ZCMediaRecorderImpl.hasRecordedSession(d)&&(Config.isAttachmentUploadOptimised()||FileUploadUI.getCallBackObject().successcallback(e,i,t),"function"==typeof r&&r(d),UI.updateBanner(MediaUtil.getResource(n,[MediaUtil.getResource(l)])),ZCMediaRecorderImpl.removeRecordedSession(d))}.bind(this),R=function(e,r){ZCMediaRecorderImpl.hasRecordedSession(d)&&(Config.isAttachmentUploadOptimised()||FileUploadUI.getCallBackObject().errorcallback(e,r),"function"==typeof i&&i(d),UI.updateBanner(MediaUtil.getResource(a,[MediaUtil.getResource(l)]),void 0,!0))}.bind(this),p=function(e,r){ZCMediaRecorderImpl.hasRecordedSession(d)&&(ZCMediaRecorderImpl.handleEnd(d),UI.updateBanner(MediaUtil.getResource(c,[MediaUtil.getResource(l)]),void 0,!0)),ZCTrack.track("VIDEO_AND_SCREEN_RECORD_MSGS",{action:"video_or_screen_record_share_cancelled"})}.bind(this);u.duration=e.getRecordingDuration();var m={mediaInfo:u,meta:e.scheduleMsgMeta||{}};void 0!==t&&FileUploadUI.setThreadCardInfoForVoiceNote(t),e.isVoiceMessage()?FileUploadUI.uploadFile(e.getChatId(),void 0,[s],m,$.extend(FileUploadUI.getCallBackObject(),{successcallback:g,errorcallback:R})):e.isVideoRecording()&&(FileUploadUI.handlePreviewWithCustomCallback(e.getChatId(),[s],m,$.extend(FileUploadUI.getCallBackObject(),{successcallback:g,errorcallback:R,cancelcallback:p})),ZCTrack.track("VIDEO_AND_SCREEN_RECORD_MSGS",{action:"video_or_screen_record_share_triggered"}))},getChatId:function(e,r,i){var t=void 0;if(e.hasChatId())t=e.getChatId();else if(void 0===(t=MediaCallImpl.getRecipiantChatIdIfOpen(r)))return void Chat.create(r,"im",void 0,void 0,void 0,function(e){void 0!==e.chid&&i(e.chid)}.bind(this));i(t)},removeUI:function(e){"undefined"!=typeof MediaCallUI&&MediaCallUI.getMediaCallWrapper(e).length>0?MediaCallUI.removeEndCallUI(e):ZCMediaRecorderUI.removeRecorderDomFromComposer(e)},handleChatWindowBeforeClose:function(e){var r=ZCMediaRecorderImpl.getSessionForChatId(e.chid);if(void 0!==r){var i=function(){ZCMediaRecorderImpl.handleEnd(r.getId())};if(r.isVideoRecording()&&r.hasRecordingData()){if(r.isInRecordingState()){var t=ZCMediaRecorderUI.getMediaRecorderWrapper(r.getId());ZCMediaRecorderHandler.UIEvents.pauseVideoRecorder(void 0,t.find("[purpose=pauseVideoRecorder]"))}ZCMediaRecorderImpl.showCancelRecordingDialog(function(){i()}.bind(this),r)}else i()}},setRecorderedVideoInPlayer:function(e){if(ZCMediaRecorderImpl.hasRecordedSession(e)){var r=ZCMediaRecorderImpl.getRecordedSession(e),i=ZCMediaRecorderUI.getMediaRecorderWrapper(e),t=i.hasClass("zc-recorder-detached");if(r.isScreenRecording())i.addClass("videomsg-preview-container zc-recording-completed zc-recorder-detached flex-col flexM").removeClass("zcscreen-recorder"),i.css(ZCMediaRecorderUI.Constants.minimizedVideoRecorderDimensions);else{i.addClass("zc-recording-completed zc-recorder-detached").removeClass("zc-recorder-fullscreen h100"),i.css(ZCMediaRecorderUI.Constants.minimizedVideoRecorderDimensions);var d=i.find("[purpose=minimizeVideoRecorderPreview]");d.length&&(d.attr({purpose:"maximizeVideoRecorderPreview","tooltip-title":MediaUtil.getResource("mediacall.fullscreen")}),d.removeClass("zcf-mini-player").addClass("zcf-fullscrn")),t||i.setAsDraggable(MediaUtil.getCriteriaForDrag())}i.removeClass("zcrecorder-paused zcrecorder-ongoing"),MediaPlayer.createPreviewForRecordedVideo(i,ZCMediaRecorderImpl.getRecordedSession(e)._getBlobUrl())}},pauseOrResumeVideoRecording:function(e){var r=!1;if(this.hasCurrentRecordingSession()){var i=this.getCurrentRecordingSession();if(i.isVideoRecording()){var t=ZCMediaRecorderUI.getMediaRecorderWrapper(i.getId());i.isInPausedState()?(ZCMediaRecorderHandler.UIEvents.resumeVideoRecorder(e,t.find("[purpose=resumeVideoRecorder]")),r=!0):i.isInRecordingState()&&(ZCMediaRecorderHandler.UIEvents.pauseVideoRecorder(e,t.find("[purpose=pauseVideoRecorder]")),r=!0)}}return r},removeDeviceSettingsPopup:function(e){var r=$("#zcrecorder_device_settings");if("true"===r.attr("shown"))return r.addClass("dN").attr("shown","false").children().remove(),ZCMediaRecorderUI.getMediaRecorderWrapper(e).find("[purpose=openDeviceSettings]").removeClass("active"),Clickoutside.clear("zcrecorder_device_settings"),MediaDeviceWidget.handleCustomUIClose(),!0}},ZCMediaRecorderTemplates=function(){var e={recordingPlayerTimeDom:'<span id="{{playback_timer_id}}">00:00</span><span>{{separator}}</span><span>{{total_recording_time}}</span>',chatRecordingDom:'<div zcaudiorecorder class="zcvoice-note-cont flexC" sessionId="{{session_id}}" chid="{{chat_id}}"><div class="{{icon_class}} mR10 fshrink"></div>{{recording_progress}}{{recording_btn}}</div>',recordingProgressDom:'<span class="clr-S font14 fontB mR20 fshrink" id="{{recording_timer_id}}">00:00</span><div class="zc-rec-progress"><span class="p2p-process-status" recordingprogress></span></div>',recordingBtnSet:'<div class="zcl-btn-sm zcl-btn--secondary fshrink" zcmediarecorderbuttons purpose="stopRecording"><span class="zcvoice-stop-icon mR6"></span><span>{{stop_btn_text}}</span></div>',playerProgressDom:'<div class="{{icon_class}} mR10 fshrink flexM" zcmediarecorderbuttons purpose="playRecording"></div><div zcmediarecorderbuttons purpose="seekPlayback" class="zc-rec-progress"><div id="scroll" class="zcad-cirle"></div><div id="played" class="zcaudsldsb"></div></div><div id="{{player_timer_id}}" class="clr-S font14 fontB mR20 fshrink">{{total_duration}}</div><div class="zcf-close zcl-icon-md zcl-icon--default fshrink zcl-round mR12" zcmediarecorderbuttons purpose="cancelRecording"></div><div class="zcl-btn-sm zcl-btn--primary fshrink {{className}}" zcmediarecorderbuttons purpose="{{purpose}}" chatID="{{chatID}}"><span class="schedule-send-btn">{{send_btn_text}}</span>{{schedule_dropdown_html}}</div>',scheduleDropDownDom:'<span id="voicemsgdropdown{{chatID}}" class="split-icon flexM {{additionalClass}} font20" zcmediarecorderbuttons chatID="{{chatID}}" purpose="showVoiceMsgDropDown"></span><div id="voicemsgdropdown_list{{chatID}}" class="zcl-menu-wrap hide posabs no-pointer" style="z-index:2;"><div class="zcl-menu-item" chatID="{{chatID}}" zcmediarecorderbuttons purpose="{{action}}"><span class="ellips">{{dropDownBtnText}}</span></div></div>',videoRecordingPreviewDom:'<div zcvideorecorder class="{{parent_class}} nite-mode" sessionId="{{session_id}}" chid="{{chat_id}}" style="{{screen_recorder_style}}">\n\t\t\t\t<div class="zcrecorder-wrapper h100">\n\t\t\t\t\t<div class="videomsg-preview-header flexC clr-M">\n\t\t\t\t\t\t<div class="{{icon_class}} mR10 mT1"></div>\n\t\t\t\t\t\t<div class="flexG flexC ellips">\n\t\t\t\t\t\t\t<div class="fontB ellips">{{title}}</div>\n\t\t\t\t\t\t\t<div id="zc-recorder-state" class="zc-av-flexC mL8 mT1 dN">\n\t\t\t\t\t\t\t\t<div class="zc-av-header-box zcrecorder-recording dN">\n\t\t\t\t\t\t\t\t\t<span class="AV-call-record-icon AV-call-record-icon-circle flexM animation"></span><span class="mL3 fontB">REC</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="zc-av-header-box zcrecorder-pause dN">\n\t\t\t\t\t\t\t\t\t<span class="zcf-pause flexM"></span><span class="mL3 fontB">{{paused_info}}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="zcl-icon--mediabtn zcl-icon zcf-close mL10 fshrink zcl-round" zcmediarecorderbuttons purpose="closeVideoRecorderPreview"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="flexM flexG posrel wh100">\n\t\t\t\t\t\t<div videomsg_preview class="videomsg-preview-body dN">\n\t\t\t\t\t\t\t{{buffer_loader}}<video id="videostream" class="wh100"></video></div>\n\t\t\t\t\t\t<div videomsg_player class="videomsg-player-body dN"><div></div></div>\n\t\t\t\t\t\t<div class="zcrecorder-pauseinfo flex-col flexM dN">\n\t\t\t\t\t\t\t<div class="clrW fontB font20">{{paused_info_header}}</div>\n\t\t\t\t\t\t\t<div class="clrW-lite font15 mT6">{{paused_info_msg}}</div>\n\t\t\t\t\t\t\t<div class="zcscreen-recorder-resume-btns flexM mT15 dN">\n\t\t\t\t\t\t\t\t<span class="clrW-lite zcl-btn-sm zcrecorder-screen-resume flexC" zcmediarecorderbuttons purpose="resumeVideoRecorder">\n\t\t\t\t\t\t\t\t\t<span class="zcf-resume mR10 mT2"></span>\n\t\t\t\t\t\t\t\t\t{{resume_button}}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class="zcl-btn-sm mL5 zcrecorder-screen-finish tooltip-right" zcmediarecorderbuttons purpose="finishVideoRecording" tooltip-title="{{finish_recording}}">{{finish_button}}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="zcrecorder_device_settings" class="zcrecorder-devicesettings dN" shown="false"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="videomsg-preview-footer">\n\t\t\t\t\t\t<span id="videomsg-devicesettings" zcmediarecorderbuttons class="zcl-icon--mediabtn zcrecorder-settings zcl-icon-xl zcf-setting zcl-round curP" purpose="openDeviceSettings"></span>\n\t\t\t\t\t\t<span id="videomsg-strength" class="zcrecorder-audio-strength mL10 flexM posabs mL50">\n\t\t\t\t\t\t\t<span class="zcf-mic clr-M disabledopacity mR5"></span>\n\t\t\t\t\t\t\t<span id="zc-recorder-audiolevel" class="posrel flex">\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span id="videomsgbtnholder" class="{{btn_class}}">\n\t\t\t\t\t\t\t<div class="videomsg-btns">\n\t\t\t\t\t\t\t\t<div class="zcl-icon-xl zcl-round zcf-mic tooltip-up screenmsg-btn zcl-icon--mediabtn mL5 dN" tooltip-title="{{mute_mic_tooltip}}" zcmediarecorderbuttons muted="false" purpose="muteUnmuteAudioInScreenRecord"></div>\n\t\t\t\t\t\t\t\t<div class="zcl-icon-xl zcl-round zcf-video-mute tooltip-up screenmsg-btn zcl-icon--mediabtn active mLR5 dN" tooltip-title="{{enable_camera}}" zcmediarecorderbuttons muted="true" purpose="muteUnmuteCameraInScreenRecord"></div>\n\t\t\t\t\t\t\t\t<div class="videomsg-start zcpseudo-bg flexM">\n\t\t\t\t\t\t\t\t\t<span class="fshrink flexM curP tooltip-up" zcmediarecorderbuttons purpose="startRecording" style="height: 30px;">\n\t\t\t\t\t\t\t\t\t\t<span class="zcvoice-process flexIC"></span>\n\t\t\t\t\t\t\t\t\t\t<span class="mL5 mR10 zc-start-recorder fontB">{{recording_start}}</span>\n\t\t\t\t\t\t\t\t\t\t<span id="{{recording_timer_id}}" class="mL6 font15 flexG fontB dN videomsg-timer"></span>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="zcl-icon-xl zcl-round zcf-pause tooltip-up flexM videomsg-btn zcl-icon--mediabtn mL5 dN" zcmediarecorderbuttons purpose="pauseVideoRecorder" tooltip-title="{{pause_tooltip}}"></div>\n\t\t\t\t\t\t\t\t<div class="zcl-icon-xl zcl-round zcf-reset font20 tooltip-up videomsg-btn zcl-icon--mediabtn mL5 dN" tooltip-title="{{reset_btn}}" zcmediarecorderbuttons purpose="resetVideoRecorder"></div>\n\t\t\t\t\t\t\t\t<div class="zcl-icon-xl zcl-round zcf-setting tooltip-up flexM screenmsg-btn zcl-icon--mediabtn mL5 dN" zcmediarecorderbuttons purpose="openDeviceSettings"></div>\n\t\t\t\t\t\t\t\t<div class="zcl-icon-xl zcl-round zcf-closeB tooltip-up screenmsg-btn zcl-icon--mediabtn mL5 dN" tooltip-title="{{close_btn}}" zcmediarecorderbuttons purpose="closeVideoRecorderPreview"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class="zcl-icon--mediabtn zcrecorder-minimize zcl-icon-xl zcf-mini-player zcl-round curP tooltip-up" zcmediarecorderbuttons {{min_max_purpose_tooltip}}></span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="zc-recorder-playback-footer justifyE">\n\t\t\t\t\t\t<span purpose="resetVideoRecorder" zcmediarecorderbuttons class="zcl-btn zcl-btn--secondary mR20">{{retake_button}}</span>\n\t\t\t\t\t\t<span purpose="sendRecording" zcmediarecorderbuttons class="zcl-btn zcl-btn--primary">{{send_button}}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>',deviceSettingsCustomUI:'<div id="{{dom_id}}" class="zcl-popup zcsetting-popup">\n\t\t\t   <div class="flex-col wh100">\n\t\t\t      <div class="font14 fontB fshrink zcsetting-popup-header clrW">{{device_settings}}</div>\n\t\t\t      <div class="flexG ovrflwA">\n\t\t\t         <div class="{{show_camera_list}}">\n\t\t\t            <div class="flexC pLR10 mT5"><span class="clr-S fontB font13">{{camera_header}}</span>\n\t\t\t               <span class="zcl-hor-divider flexG mL8"></span>\n\t\t\t            </div>\n\t\t\t            <div class="mLR8 mT6">\n\t\t\t               {{list_of_camera}}\n\t\t\t            </div>\n\t\t\t         </div>\n\t\t\t         <div class="{{show_mic_list}}">\n\t\t\t            <div class="flexC pLR10 mT5"><span class="clr-S fontB font13">{{mic_header}}</span>\n\t\t\t               <span class="zcl-hor-divider flexG mL8"></span>\n\t\t\t            </div>\n\t\t\t            <div class="mLR8 mT6">\n\t\t\t               {{list_of_mic}}\n\t\t\t            </div>\n\t\t\t         </div>\n\t\t\t         <div class="">\n\t\t\t            <div class="flexC pLR10 mT5"><span class="clr-S fontB font13">{{video_quality_header}}</span>\n\t\t\t               <span class="zcl-hor-divider flexG mL8"></span>\n\t\t\t            </div>\n\t\t\t            <div class="mLR8 mT6">\n\t\t\t               {{list_of_video_quality}}\n\t\t\t            </div>\n\t\t\t         </div>\n\t\t\t         <div class="zcsetting-popup-header mT4 dN">{{other_configs}}</div>\n\t\t\t         <div class="flexC pL10 pR20 mT10 dN">\n\t\t\t            <div class="flexG font14">Include system sounds</div>\n\t\t\t            <label class="zcl-switch no-icon"><input type="checkbox"><span class="slider"><em class="switch"></em></span></label>\n\t\t\t         </div>\n\t\t\t         <div class="flexC pL10 pR20 mT20 mB10 dN">\n\t\t\t            <div class="flexG font14">Background Blur</div>\n\t\t\t            <label class="zcl-switch no-icon"><input type="checkbox"><span class="slider"><em class="switch"></em></span></label>\n\t\t\t         </div>\n\t\t\t      </div>\n\t\t\t   </div>\n\t\t\t</div>'},r=function(e){if(Config.isScheduleMessageEnabled()){var r=ChatUI.getWin(e);return r&&r.hasScheduleMessageController()&&r.getScheduleMessageController().isInSchedulingMode()}return!1},i=function(e){return r(e)?"handleMediaScheduling":"sendRecording"},t=function(e){return r(e)?Resource.getRealValue("schmsg.schedule"):Resource.getRealValue("common.send")},d=function(i){var t=r(i);return $WC.template.replace(e.scheduleDropDownDom,{chatID:i,purpose:"showVoiceMsgDropDown",action:t?"sendRecording":"openScheduleMsgPopUp",additionalClass:t?"zcf-pointer":"zcf-schedule",dropDownBtnText:t?Resource.getRealValue("common.send"):Resource.getRealValue("schmsg.schedule")},"InSecureHTML")};return{getRecordingPlayerTimer:function(r,i,t){return $WC.template.replace(e.recordingPlayerTimeDom,{playback_timer_id:r,separator:t,total_recording_time:$ZCUtil.getDurationInHrMinSec(i)},"InSecureHTML")},getRecorderDomForChat:function(r,i){var t=$WC.template.replace(e.chatRecordingDom,{icon_class:"zcvoice-process",recording_progress:e.recordingProgressDom,recording_btn:e.recordingBtnSet},"InSecureHTML");return $WC.template.replace(t,{session_id:r,chat_id:i,recording_timer_id:ZCMediaRecorderImpl.getRecorderSessionTimerId(r),$stop_btn_text:"avcliq.media.stop"})},getRecordingPlayerDomForChat:function(r,o,s){return $WC.template.replace(e.playerProgressDom,{icon_class:"zcvoice-play zcf-newplay",purpose:i(s),player_timer_id:ZCMediaRecorderImpl.getMediaPlayerSessionTimerId(r),total_duration:o,$send_btn_text:t(s),schedule_dropdown_html:Config.isScheduleMessageEnabled()?d(s):"",className:Config.isScheduleMessageEnabled()?"zc-schedule-dropDownOption zcl-split-btn":"",chatID:s},"InSecureHTML")},getRecorderPreviewDomForVideoMessage:function(r,i,t){var d=ZCMediaRecorder.isScreenRecording(t),o=$WC.template.replace(e.videoRecordingPreviewDom,{chat_id:i,session_id:r,screen_recorder_style:d?"top: 88%; left: calc(50% - 185px);":"",parent_class:d?"zcscreen-recorder":"videomsg-preview-container zc-recorder-fullscreen flex-col wh100 flexM",icon_class:d?"zcf-screen":"zcf-video",btn_class:d?"":"flexG flexM",min_max_purpose_tooltip:d?`purpose=maximizeVideoRecorderPreview tooltip-title=${MediaUtil.getResource("mediacall.fullscreen")}`:`purpose=minimizeVideoRecorderPreview tooltip-title=${MediaUtil.getResource("videochat.minimize")}`,recording_timer_id:ZCMediaRecorderImpl.getRecorderSessionTimerId(r),title:Resource.getRealValue("new.video.note.info",[ConversationsList.getTitle(i)]),paused_info:MediaUtil.getResource("paused.video.note"),paused_info_header:MediaUtil.getResource("video.recording.paused.header"),mute_mic_tooltip:MediaUtil.getResource("common.micoff"),enable_camera:MediaUtil.getResource("videochat.cameraon"),reset_btn:MediaUtil.getResource("reset.video.note"),close_btn:MediaUtil.getResource("common.close"),recording_start:MediaUtil.getResource("media.recording.start"),pause_tooltip:MediaUtil.getResource("common.pause"),retake_button:MediaUtil.getResource("video.message.retake"),resume_button:MediaUtil.getResource("resume.video.note"),finish_button:MediaUtil.getResource("avcliq.media.stop"),finish_recording:MediaUtil.getResource("media.recording.stop"),send_button:MediaUtil.getResource("common.proceed")});return o=$WC.template.replace(o,{buffer_loader:d?"":ZCSmartConferenceTemplates.getLoaderHtml("zcvideorecordloader","",""),paused_info_msg:MediaUtil.getResource("video.recording.paused.info",['<strong class="clrW">'+MediaUtil.getResource("common.space.bar")+"</strong>"])},"InSecureHTML")},getDeviceSettingsCustomUI:function(r,i){var t='<div class="zcl-list-item {{is_active}}" deviceId="{{device_id}}" deviceType="{{device_type}}" {{button_type}} purpose="{{btn_purpose}}"><span class="flexG ellips">{{device_name}}</span><span class="sel-icon zcf-tick font12 clr-theme fontB"></span></div>',d="",o="",s="",n=MediaUtil.videoResolutions.getSupportedResolutions();r.forEach((function(e){if(ZCMediaDevices.isAudioInputDevice(e)||ZCMediaDevices.isVideoInputDevice(e)){var r=!1,s={device_name:e.label,device_id:e.deviceId,device_type:e.kind,button_type:"mediadevicewidgetbutton",btn_purpose:"setSpecificSelectedDevice"};ZCMediaDevices.isAudioInputDevice(e)?(r=i.audioInputDeviceId==e.deviceId,s.is_active=r?"sel":"",s.is_selected=r?'selected="active"':"",o+=$WC.template.replace(t,s)):ZCMediaDevices.isVideoInputDevice(e)&&(r=i.videoInputDeviceId==e.deviceId,s.is_active=r?"sel":"",s.is_selected=r?'selected="active"':"",d+=$WC.template.replace(t,s))}})),n.forEach((function(e){var r=e+"p",i=MediaUtil.videoResolutions.getPreferredVideoRes()===e;s+=$WC.template.replace(t,{device_name:r,device_id:e,device_type:"",is_active:i?"sel":"",is_selected:i?'selected="active"':"",button_type:"zcmediarecorderbuttons",btn_purpose:"setVideoRecorderResolution"})}));var a=$WC.template.replace(e.deviceSettingsCustomUI,{device_settings:MediaUtil.getResource("videochat.settings.devicesettings"),camera_header:MediaUtil.getResource("common.device.camera"),mic_header:MediaUtil.getResource("common.device.mic"),video_quality_header:MediaUtil.getResource("videochat.video.quality"),other_configs:MediaUtil.getResource("videochat.other.configs"),dom_id:"media_device_widget",show_camera_list:d?"":"dN",show_mic_list:o?"":"dN"});return a=$WC.template.replace(a,{list_of_camera:d,list_of_mic:o,list_of_video_quality:s},"InSecureHTML")}}}(),ZCMediaRecorderHandler={mediaCallRecorderEvents:{handleRecordingStart:function(e,r){MediaCallUI.adaptEndCallUIToState(e,MediaCallConstants.states.RECORDING)},handleRecordingProgress:function(e,r){var i=ZCMediaRecorderImpl.getCurrentRecordingSession();if(i&&i.getId()===e&&ZCMediaRecorderImpl.getCurrentRecordingSession().isInRecordingState()){var t=ZCJQuery("#recording-progress");if(r&&t.length>0){var d=t.attr("r");r<0&&(r=0),r>100&&(r=100);var o=(100-r)/100*(Math.PI*(2*d));t.css({strokeDashoffset:o})}}},handleRecordingEnd:function(e,r,i){var t=ZCMediaRecorderImpl.getCurrentRecordingSession();if(t&&t.getId()===e){ZCMediaRecorderImpl.moveCurrentRecordingSessionToRecorded();var d=MediaCallUI.getMediaCallWrapper(e);MediaCallUI.adaptEndCallUIToState(e,MediaCallConstants.states.RECORDED),d.find("[endedcalloptions] [buttonGroup]").html(MediaCallTemplates.getPlayRecordingBtnSet())}},handleRecordingPlaybackStart:function(e,r){if(ZCMediaRecorderImpl.hasRecordedSession(e)){var i=MediaCallUI.getMediaCallWrapper(e),t=i.find('[mediacallbuttons][purpose="playRecording"]'),d=ZCMediaRecorderImpl.getMediaPlayerSessionTimerId(e);t.attr("title",MediaUtil.getResource("common.pause")).removeClass("zcf-newplay").addClass("msi-pause").attr("purpose","pauseRecording"),0===ZCJQuery("#"+$.escapeSelector(d)).length&&i.find("[statuscontent]").html(ZCMediaRecorderTemplates.getRecordingPlayerTimer(d,r,"/"))}},handleRecordingPlaybackStop:function(e){ZCMediaRecorderImpl.hasRecordedSession(e)&&MediaCallUI.getMediaCallWrapper(e).find('[mediacallbuttons][purpose="pauseRecording"]').attr("title",MediaUtil.getResource("common.play")).removeClass("msi-pause").addClass("zcf-newplay").attr("purpose","playRecording")}},mediaCallUIEvents:{startMediaRecording:function(e){MediaManager.handleExistingSessions(function(){var r=e.attr("callId"),i=e.attr("calleeid"),t=function(){e.find("[endedcalloptions] [buttonGroup]").html(MediaCallTemplates.getStopRecordingBtnSet())}.bind(this);MediaCallUI.removeEndCallTimer(r),ZCMediaRecorderImpl.initiateMediaRecording(r,i,void 0,WebRTCUserMedia.streamTypes.AUDIO_ONLY,ZCMediaRecorderHandler.mediaCallRecorderEvents,ZCMediaRecorderConstants.VOICE_NOTE_MAX_RECORDING_TIME,ZCMediaRecorderImpl.getMediaPlayerSessionTimerId(r),t),MediaCallUI.adaptEndCallUIToState(r,MediaCallConstants.states.WAITING_FOR_PERMISSION)}.bind(this))},stopMediaRecording:function(e){var r=ZCMediaRecorderImpl.getCurrentRecordingSession();r&&r.getId()===e&&ZCMediaRecorderImpl.getCurrentRecordingSession().stopRecording()},playRecording:function(e){ZCMediaRecorderImpl.hasRecordedSession(e)&&ZCMediaRecorderImpl.getRecordedSession(e).playRecording()},pauseRecording:function(e){ZCMediaRecorderImpl.hasRecordedSession(e)&&ZCMediaRecorderImpl.getRecordedSession(e).pauseRecording()},sendRecording:function(e){var r=e.parents("[callId]").attr("callId");if(ZCMediaRecorderImpl.hasRecordedSession(r)){var i=ZCMediaRecorderImpl.getRecordedSession(r),t=i.getReceiverId();ZCJQuery(e);i.pauseRecording(),ZCMediaRecorderImpl.getChatId(i,t,function(e){ZCMediaRecorderImpl.hasRecordedSession(r)&&(i.setChatId(e),ZCMediaRecorderImpl.sendRecordedFile(i),ZCMediaRecorderImpl.removeUI(r))}.bind(this))}}},recorderEvents:{handleRecordingStart:function(e,r){if(ZCMediaRecorderImpl.hasCurrentRecordingSession()&&ZCMediaRecorderImpl.getCurrentRecordingSession().isVideoRecording()){var i=ZCMediaRecorderUI.getMediaRecorderWrapper(e);i.addClass("zcrecorder-ongoing");var t=i.find("#videomsgbtnholder");t.addClass("zc-record-start"),t.find("[purpose=startRecording]").attr({purpose:"finishVideoRecording","tooltip-title":MediaUtil.getResource("media.recording.stop")})}},handleVideoRecorderPreview:function(e,r,i){var t=ZCMediaRecorderUI.getMediaRecorderWrapper(e);MediaUtil.setStreamInContainer($zcg._ZUID,t,i),t.find("#zcvideorecordloader").remove(),i._startAudioFrequencyAnalyser((function(e){return MediaUtil.adjustLinearAudioLevel(t.find("#zc-recorder-audiolevel"),e),!0}))},handleRecordingProgress:function(e,r){var i=ZCMediaRecorderUI.getMediaRecorderWrapper(e).find("[recordingprogress]");r&&i.length>0&&i.css("width",r+"%")},handleRecordingFrequency:function(e,r){var i=Math.min.apply(null,r),t=100*e/ZCMediaConstants.FREQUENCY_BIN_RANGE,d=100*i/ZCMediaConstants.FREQUENCY_BIN_RANGE;if(ZCMediaRecorderImpl.hasCurrentRecordingSession()&&ZCMediaRecorderImpl.getCurrentRecordingSession().isInRecordingState()){var o=ZCMediaRecorderUI.getMediaRecorderWrapper(ZCMediaRecorderImpl.getCurrentRecordingSession().getId()),s=o.find("[audiowaves]")[0];o.find("[recordingprogress]").removeClass("dN"),new ZCAudioRecorderWave(s,t>50?t:d).start()}return!0},handleRecordingEnd:function(e,r,i){var t=ZCMediaRecorderImpl.getCurrentRecordingSession();if(t&&t.getId()===e){ZCMediaRecorderImpl.moveCurrentRecordingSessionToRecorded();var d=ZCMediaRecorderUI.getMediaRecorderWrapper(e);t.isVideoRecording()?ZCMediaRecorderImpl.setRecorderedVideoInPlayer(e):d.html(ZCMediaRecorderTemplates.getRecordingPlayerDomForChat(e,$ZCUtil.getDurationInHrMinSec(i),t._chatId))}},handleRecordingPlaybackStart:function(e){ZCMediaRecorderImpl.hasRecordedSession(e)&&ZCMediaRecorderUI.getMediaRecorderWrapper(e).find('[zcmediarecorderbuttons][purpose="playRecording"]').attr("title",Resource.getRealValue("common.pause")).removeClass("zcf-newplay").addClass("msi-pause zcvoice-pause").attr("purpose","pauseRecording")},handleRecordingPlaybackStop:function(e,r,i){if(ZCMediaRecorderImpl.hasRecordedSession(e)){var t=ZCMediaRecorderUI.getMediaRecorderWrapper(e),d=t.find('[zcmediarecorderbuttons][purpose="pauseRecording"]');r||(t.find("#scroll").css("left","0"),t.find("#scrollcrcl").css("left","0"),t.find("#played").css("width","0"),$("#"+$.escapeSelector(ZCMediaRecorderImpl.getMediaPlayerSessionTimerId(e))).text($ZCUtil.getDurationInHrMinSec(i))),d.attr("title",Resource.getRealValue("common.play")).removeClass("msi-pause zcvoice-pause").addClass("zcf-newplay").attr("purpose","playRecording")}},handleRecordingPlaybackTimeUpdate:function(e,r){if(ZCMediaRecorderImpl.hasRecordedSession(e)){var i=ZCMediaRecorderUI.getMediaRecorderWrapper(e),t=isFinite(r.duration)?r.duration:ZCMediaRecorderImpl.getRecordedSession(e).getRecordingDurationInSecs(),d=Math.floor(100/t*r.currentTime),o=$Util.formatsecondstotime(r.currentTime),s=i.find("#scroll");i.find("#scroll").css("left",d+"%"),i.find("#scrollcrcl").css("left",d+"%"),i.find("#played").css("width",d+"%"),s.attr("title",o),$("#"+$.escapeSelector(ZCMediaRecorderImpl.getMediaPlayerSessionTimerId(e))).text(o)}}},UIEvents:{startRecording:function(e,r){var i=r.parents("[sessionid]").attr("sessionid"),t=ZCMediaRecorderImpl.getCurrentRecordingSession();ZCMediaRecorderImpl.removeDeviceSettingsPopup(i),t&&t.getId()===i&&ZCMediaRecorderImpl.getCurrentRecordingSession().startRecording()},stopRecording:function(e,r){var i=r.parents("[sessionid]").attr("sessionid"),t=ZCMediaRecorderImpl.getCurrentRecordingSession();ZCMediaRecorderImpl.removeDeviceSettingsPopup(i),t&&t.getId()===i&&ZCMediaRecorderImpl.getCurrentRecordingSession().stopRecording()},playRecording:function(e,r){var i=r.parents("[sessionid]").attr("sessionid");ZCMediaRecorderImpl.hasRecordedSession(i)&&ZCMediaRecorderImpl.getRecordedSession(i).playRecording()},pauseRecording:function(e,r){var i=r.parents("[sessionid]").attr("sessionid");ZCMediaRecorderImpl.hasRecordedSession(i)&&ZCMediaRecorderImpl.getRecordedSession(i).pauseRecording()},resumeRecording:function(e,r){var i=r.parents("[sessionid]").attr("sessionid");ZCMediaRecorderImpl.hasRecordedSession(i)&&ZCMediaRecorderImpl.getRecordedSession(i).resumeRecording()},cancelRecording:function(e,r){var i=r.parents("[sessionid]").attr("sessionid");if(ZCMediaRecorderImpl.hasRecordedSession(i)){var t=ZCMediaRecorderImpl.getRecordedSession(i);t.pauseRecording(),ZCMediaRecorderImpl.showCancelRecordingDialog(function(){ZCMediaRecorderImpl.handleEnd(i)}.bind(this),t)}},openVideoInPIP:function(e,r){var i=r.find("video")[0];i&&ZCPIPManager.openPictureInPicture(i,void 0,ZCMediaRecorderHandler.pictureInPictureEvents)},seekPlayback:function(e,r){var i=r.parents("[sessionid]"),t=i.attr("sessionid");if(ZCMediaRecorderImpl.hasRecordedSession(t)){var d=ZCMediaRecorderImpl.getRecordedSession(t),o=d.getRecordingPlayer();d.pauseRecording();var s=e.clientX-r.offset().left,n=Math.floor(100*s/r.width()),a=(isFinite(o.duration)?o.duration:ZCMediaRecorderImpl.getRecordedSession(t).getRecordingDurationInSecs())*n/100;o.src=o.getAttribute("src"),o.currentTime=a,i.find("#scroll").css("left",n+"%"),i.find("#scrollcrcl").css("left",n+"%"),d.playRecording()}},showVoiceMsgDropDown:function(e,r){var i=r.parent().parent();i.addClass("ovrflwV");var t=r.parent(),d={srcid:e.target.id,destid:"voicemsgdropdown_list"+e.target.getAttribute("chatID"),event:e,callBack:function(){i.removeClass("ovrflwV")},customShow:function(e){t.find("#"+e.srcid).addClass("active"),t.find("#"+e.destid).removeClass("hide")},customHide:function(e){t.find("#"+e.srcid).removeClass("active"),t.find("#"+e.destid).addClass("hide")}};Clickoutside.bind(d)},handleMediaScheduling:function(e){var r=e.chatID,i=ChatUI.getWin(r);if(i){var t=i.hasScheduleMessageController()&&i.getScheduleMessageController();if(!t)return;if(t.hasMessageStorage()||t.initScheduleMessageStorage(),t.isMaximumScheduleMsgLimitReached(1))return t.destroyPopUpView(),void ScheduleMessageUtils.showScheduleMsgMaxThresholdWarningDialog();t.handleBeforeSchedulingMessages();var d={scheduleMsgMeta:{isScheduledMessage:!0,scheduledTimeStamp:t.getScheduledTimeStamp(),scheduledTimezone:t.getScheduledTimezone()}};this.sendRecording(e.event,e.elem,d)}},sendRecording:function(e,r,i){var t=r.parents("[sessionid]"),d=t.attr("sessionid"),o=t.attr("chid");i=i||{};if(ZCMediaRecorderImpl.hasRecordedSession(d)){var s=ZCMediaRecorderImpl.getRecordedSession(d);s.pauseRecording(),s.setChatId(o),$.extend(s,i),ZCMediaRecorderImpl.sendRecordedFile(s),ZCMediaRecorderUI.removeRecorderDomFromComposer(d)}},openDeviceSettings:function(e,r){var i=r.parents("[sessionid]").attr("sessionid"),t=ZCMediaRecorderImpl.getCurrentRecordingSession();if(t&&t.getId()===i&&!ZCMediaRecorderImpl.removeDeviceSettingsPopup(i)){var d=t.getAVStream(),o={handleCustomUI:function(t,d,o,s,n){ZCMediaRecorderUI.showDeviceSettings(t,d,o,s,n),Clickoutside.bind({event:e,srcid:r.attr("id"),destid:"zcrecorder_device_settings",closeOnClickSrc:!0,customShow:function(e){$("#"+e.destid).removeClass("dN").attr("shown","true"),ZCMediaRecorderUI.getMediaRecorderWrapper(i).find("[purpose=openDeviceSettings]").addClass("active")},customHide:function(e){$("#"+e.destid).addClass("dN").attr("shown","false").children().remove(),ZCMediaRecorderUI.getMediaRecorderWrapper(i).find("[purpose=openDeviceSettings]").removeClass("active")}})}};o[ZCMediaDevices.kinds.AUDIO_OUTPUT]=!1,MediaDeviceWidget.show((function(e){if(!$WC.Util.isEmptyObject(e)&&(ZCMediaDevices.setPreferredDevices(e,!0),void 0!==ZCMediaRecorderImpl.getCurrentRecordingSession()&&(e[ZCMediaDevices.kinds.AUDIO_INPUT]||e[ZCMediaDevices.kinds.VIDEO_INPUT]))){var r=function(e){void 0!==ZCMediaRecorderImpl.getCurrentRecordingSession()?t.isUserVideoEnabledInScreenRecording()&&(t.setUserVideoStreamForScreenRecording(e),MediaUtil.setStreamInContainer($zcg._ZUID,$("#zcrecorderuservideocont"),e)):WebRTCUserMedia.closeStream(e._getType())},i=function(e){void 0!==ZCMediaRecorderImpl.getCurrentRecordingSession()?e._startAudioFrequencyAnalyser((function(e){return MediaUtil.adjustLinearAudioLevel($("#zc-recorder-audiolevel"),e),!0})):WebRTCUserMedia.closeStream(e._getType())};e[ZCMediaDevices.kinds.AUDIO_INPUT]&&e[ZCMediaDevices.kinds.VIDEO_INPUT]?t.isVideoMessage()?WebRTCUserMedia.requestAndReplaceTracksInStream(d,WebRTCUserMedia.streamTypes.AUDIO_VIDEO,i):t.isUserVideoEnabledInScreenRecording()?WebRTCUserMedia.requestAndReplaceTracksInStream(t.getUserVideoStreamInScreenRecording(),WebRTCUserMedia.streamTypes.VIDEO_ONLY,r):t.isUserAudioEnabledInScreenRecording()&&WebRTCUserMedia.requestAndReplaceTracksInStream(d,WebRTCUserMedia.streamTypes.AUDIO_ONLY,i):e[ZCMediaDevices.kinds.AUDIO_INPUT]?(WebRTCUserMedia.requestAndReplaceTracksInStream(d,WebRTCUserMedia.streamTypes.AUDIO_ONLY,i),d._stopAudioFrequencyAnalyser()):e[ZCMediaDevices.kinds.VIDEO_INPUT]&&(t.isVideoMessage()?WebRTCUserMedia.requestAndReplaceTracksInStream(d,WebRTCUserMedia.streamTypes.VIDEO_ONLY,r):t.isUserVideoEnabledInScreenRecording()&&WebRTCUserMedia.requestAndReplaceTracksInStream(t.getUserVideoStreamInScreenRecording(),WebRTCUserMedia.streamTypes.VIDEO_ONLY,r))}}),o,d,d)}},pauseVideoRecorder:function(e,r){var i=r.parents("[sessionid]").attr("sessionid"),t=ZCMediaRecorderImpl.getCurrentRecordingSession();if(ZCMediaRecorderImpl.removeDeviceSettingsPopup(i),t&&t.getId()===i){var d=ZCMediaRecorderUI.getMediaRecorderWrapper(t.getId());d.addClass("zcrecorder-paused").removeClass("zcrecorder-ongoing");var o=d.find("#videomsgbtnholder").find("[purpose=pauseVideoRecorder]");o.attr({purpose:"resumeVideoRecorder","tooltip-title":MediaUtil.getResource("resume.video.note")}),o.removeClass("zcf-pause").addClass("zcf-resume"),t.pauseOngoingRecording()}},resumeVideoRecorder:function(e,r){var i=r.parents("[sessionid]").attr("sessionid"),t=ZCMediaRecorderImpl.getCurrentRecordingSession();if(ZCMediaRecorderImpl.removeDeviceSettingsPopup(i),t&&t.getId()===i){var d=ZCMediaRecorderUI.getMediaRecorderWrapper(t.getId());d.removeClass("zcrecorder-paused").addClass("zcrecorder-ongoing");var o=d.find("#videomsgbtnholder").find("[purpose=resumeVideoRecorder]");o.attr({purpose:"pauseVideoRecorder","tooltip-title":MediaUtil.getResource("common.pause")}),o.addClass("zcf-pause").removeClass("zcf-resume"),t.resumeRecording()}},resetVideoRecorder:function(e,r){var i=r.parents("[sessionid]").attr("sessionid"),t=ZCMediaRecorderImpl.getCurrentAvailableSession(i);ZCMediaRecorderImpl.removeDeviceSettingsPopup(i);var d=ZCMediaRecorderImpl.hasRecordedSession(i);if(t&&t.getId()===i){var o=ZCMediaRecorderUI.getMediaRecorderWrapper(t.getId());t.isInRecordingState()&&ZCMediaRecorderHandler.UIEvents.pauseVideoRecorder(void 0,o.find("[purpose=pauseVideoRecorder]")),o.removeClass("zc-recording-completed"),t.isScreenRecording()?(o.addClass("zcscreen-recorder").removeClass("videomsg-preview-container zc-recording-completed zc-recorder-detached flex-col flexM"),o.css(ZCMediaRecorderUI.Constants.screenRecorderDomResetDimensions)):o.css(ZCMediaRecorderUI.Constants.minimizedVideoRecorderDimensions),o.removeClass("zcrecorder-paused zcrecorder-ongoing"),$WC.VideoPlayerFactory.removeSpecificComponent("videomsg-preview","zcrecordervideopreview");var s=o.find("#videomsgbtnholder");s.removeClass("zc-record-start");var n=s.find("[purpose=resumeVideoRecorder]");n.length&&(n.attr("purpose","pauseVideoRecorder"),n.addClass("zcf-pause").removeClass("zcf-resume"));var a=s.find("[purpose=finishVideoRecording]");a.attr({purpose:"startRecording"}),a.removeAttr("tooltip-title"),d?(t.destroyRecorder(),ZCMediaRecorderImpl.resetRecorderWithExistingUI(t),ZCMediaRecorderImpl.removeRecordedSession(t.getId()),ZCTrack.track("VIDEO_AND_SCREEN_RECORD_MSGS",{action:"reset_finished_recording"})):t&&(t._getRecorder().stopRecording((function(){t.clearRecordedData()})),ZCTrack.track("VIDEO_AND_SCREEN_RECORD_MSGS",{action:"reset_ongoing_recording"}))}},finishVideoRecording:function(e,r){var i=r.parents("[sessionid]").attr("sessionid"),t=ZCMediaRecorderImpl.getCurrentRecordingSession();if(ZCMediaRecorderImpl.removeDeviceSettingsPopup(i),this.stopRecording(e,r),t.isScreenRecording()&&t.isUserVideoEnabledInScreenRecording()){var d=ZCMediaRecorderUI.getMediaRecorderWrapper(t.getId());this.muteUnmuteCameraInScreenRecord(e,d.find("[purpose=muteUnmuteCameraInScreenRecord]"))}},minimizeVideoRecorderPreview:function(e,r){var i=r.parents("[sessionid]").attr("sessionid"),t=ZCMediaRecorderImpl.getCurrentRecordingSession();if(ZCMediaRecorderImpl.removeDeviceSettingsPopup(i),t&&t.getId()===i){var d=ZCMediaRecorderUI.getMediaRecorderWrapper(t.getId());d.addClass("zc-recorder-detached").removeClass("zc-recorder-fullscreen"),d.css(ZCMediaRecorderUI.Constants.minimizedVideoRecorderDimensions);var o=d.find("[purpose=minimizeVideoRecorderPreview]");o.attr({purpose:"maximizeVideoRecorderPreview","tooltip-title":MediaUtil.getResource("mediacall.fullscreen")}),o.removeClass("zcf-mini-player").addClass("zcf-fullscrn"),d.setAsDraggable(MediaUtil.getCriteriaForDrag())}},maximizeVideoRecorderPreview:function(e,r){var i=r.parents("[sessionid]").attr("sessionid"),t=ZCMediaRecorderImpl.getCurrentRecordingSession();if(ZCMediaRecorderImpl.removeDeviceSettingsPopup(i),t&&t.getId()===i){var d=ZCMediaRecorderUI.getMediaRecorderWrapper(t.getId());d.removeClass("zc-recorder-detached").addClass("zc-recorder-fullscreen");var o=d.find("[purpose=maximizeVideoRecorderPreview]");o.attr({purpose:"minimizeVideoRecorderPreview","tooltip-title":MediaUtil.getResource("videochat.minimize")}),o.removeClass("zcf-fullscrn").addClass("zcf-mini-player"),d.setAsNonDraggable()}},closeVideoRecorderPreview:function(e,r){var i=r.parents("[sessionid]").attr("sessionid"),t=ZCMediaRecorderImpl.getCurrentAvailableSession(i),d=ZCMediaRecorderImpl.hasRecordedSession(i);if(t&&t.getId()===i){var o=ZCMediaRecorderUI.getMediaRecorderWrapper(t.getId());t.isInRecordingState()&&ZCMediaRecorderHandler.UIEvents.pauseVideoRecorder(void 0,o.find("[purpose=pauseVideoRecorder]"));var s=function(){if(t._closeStream(),ZCMediaRecorderImpl.removeUserVideoInScreenRecording(t),ZCMediaRecorderUI.removeVideoRecorderPreviewFromBody(t.getId()),d)ZCMediaRecorderImpl.removeRecordedSession(t.getId());else{t.isInRecordingState()||t.isInPausedState()?t._getRecorder().stopRecording((function(){t.destroyRecorder(),ZCMediaRecorderImpl.clearCurrentRecordingSession()})):(t.destroyRecorder(),ZCMediaRecorderImpl.clearCurrentRecordingSession())}};t.hasRecordingData()?ZCMediaRecorderImpl.showCancelRecordingDialog(s,t):s()}},muteUnmuteAudioInScreenRecord:function(e,r){var i=r.parents("[sessionid]").attr("sessionid"),t=ZCMediaRecorderImpl.getCurrentAvailableSession(i);ZCMediaRecorderImpl.removeDeviceSettingsPopup(i);var d=ZCMediaRecorderImpl.hasRecordedSession(i),o="true"===r.attr("muted");d||(t.muteUnmuteAudioInScreenRecord(o),t&&t.getId()===i&&(o?r.removeClass("zcf-mic-mute active").addClass("zcf-mic").attr({muted:"false","tooltip-title":Resource.getRealValue("common.micoff")}):r.removeClass("zcf-mic").addClass("zcf-mic-mute active").attr({muted:"true","tooltip-title":Resource.getRealValue("common.micon")})))},muteUnmuteCameraInScreenRecord:function(e,r){var i=r.parents("[sessionid]").attr("sessionid"),t=ZCMediaRecorderImpl.getCurrentAvailableSession(i);ZCMediaRecorderImpl.removeDeviceSettingsPopup(i);var d="true"===r.attr("muted");if(t&&t.getId()===i){ZCMediaRecorderUI.getMediaRecorderWrapper(t.getId());var o=$("#zcrecorderuservideocont");if(d){if(!o.length){var s=ZCMediaRecorder.isPIPForScreenRecordingEnabled(),n=`<div id="zcrecorderuservideocont" class="flexM" ${s?'zcmediarecorderbuttons purpose="openVideoInPIP"':""}>\n\t\t\t\t\t\t\t\t<div class="AV-call-videocontainer AV-call-video-muted" videocontainer>`+'<video class="AV-call-video zc-wh100 zc-av-posrel"></video>'+`${s?`<div class="zcrecorder-pip zc-av-alignM zc-av-flexM">\n\t\t\t\t\t\t\t\t\t\t<span class="msi-swap" title="${I18N("common.pictureInpicture")}"></span>\n\t\t\t\t\t\t\t\t\t</div>`:""}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>`;o=$(n),$(document.body).append(o)}MediaManager.setAsStreamRequested(WebRTCUserMedia.streamTypes.VIDEO_ONLY,ZCMediaConstants.mediaModules.MEDIA_RECORDER),WebRTCUserMedia.requestVideoStream((function(e){MediaUtil.setStreamInContainer($zcg._ZUID,o,e,(function(){o.addClass("zcrecorder-uservideo posabs"),o.css(ZCMediaRecorderUI.Constants.userVidContainerDimForScreenRecorder),o.setAsDraggable(MediaUtil.getCriteriaForDrag());var e={min:160,max:400},r=$.extend({},MediaUtil.getCriteriaForResize(),{aspectRatio:1,avoidResizeUsingBorders:!0,widthRange:e,heightRange:e});o.setAsResizable(r)})),t.setUserVideoStreamForScreenRecording(e),MediaManager.resetStreamRequested(),t.getAVStream()._startAudioFrequencyAnalyser((function(e){var r=105*e/ZCMediaConstants.FREQUENCY_BIN_RANGE,i="0px 0px 1px 5px rgb(255 149 36 / 50%), 0px 0px 1px 10px rgb(255 149 36 / 30%)";return(r=Math.floor(r/10))>5&&(i="0px 0px 1px "+r+"px rgb(255 149 36 / 50%), 0px 0px 1px "+(r+10)+"px rgb(255 149 36 / 30%)"),o.css({"box-shadow":i}),!0})),r.removeClass("zcf-video-mute active").addClass("zcf-video").attr({muted:"false","tooltip-title":Resource.getRealValue("videochat.cameraoff")})}),(function(e,r){MediaManager.handleMediaError(e,r),MediaManager.resetStreamRequested()}),MediaUtil.videoResolutions.getConstraintsForVideoRes(MediaUtil.videoResolutions.getPreferredVideoRes()))}else ZCMediaRecorderImpl.removeUserVideoInScreenRecording(t),r.removeClass("zcf-video").addClass("zcf-video-mute active").attr({muted:"true","tooltip-title":Resource.getRealValue("videochat.cameraon")})}},setVideoRecorderResolution:function(e,r){var i=r.parents("[sessionid]").attr("sessionid"),t=ZCMediaRecorderImpl.getCurrentAvailableSession(i),d=r.attr("deviceId");if(Clickoutside.handleClickOnChild(e),t&&t.getId()===i&&(MediaUtil.videoResolutions.setPreferredVideoRes(d),t.isVideoMessage())){var o=MediaUtil.videoResolutions.getConstraintsForVideoRes(d);if(!$WC.Util.isEmptyObject(o)&&o.video)t.getAVStream()._getPrimaryVideoTrack().applyConstraints(o.video).catch()}}},pictureInPictureEvents:{onChange:function(e,r){$("#zcrecorderuservideocont").toggleClass("dN",r)},onCamToggle:function(e){var r=ZCMediaRecorderImpl.getCurrentRecordingSession();if(r&&r.isScreenRecording){var i=ZCMediaRecorderUI.getMediaRecorderWrapper(r.getId());ZCMediaRecorderHandler.UIEvents.muteUnmuteCameraInScreenRecord(void 0,i.find('[zcmediarecorderbuttons][purpose="muteUnmuteCameraInScreenRecord"]'))}},onMicToggle:function(e){var r=ZCMediaRecorderImpl.getCurrentRecordingSession();if(r&&r.isScreenRecording){var i=ZCMediaRecorderUI.getMediaRecorderWrapper(r.getId());ZCMediaRecorderHandler.UIEvents.muteUnmuteAudioInScreenRecord(void 0,i.find('[zcmediarecorderbuttons][purpose="muteUnmuteAudioInScreenRecord"]'))}},isVideoMuted:function(){var e=ZCMediaRecorderImpl.getCurrentRecordingSession();if(e){var r=e.getAVStream();return!(!r||!r._hasVideoTrack())&&!r._getPrimaryVideoTrack().enabled}},isAudioMuted:function(){var e=ZCMediaRecorderImpl.getCurrentRecordingSession();if(e){var r=e.getAVStream();return!(!r||!r._hasAudioTrack())&&!r._getPrimaryAudioTrack().enabled}}}},(ZCAudioRecorderWave=function(e,r){this._id=void 0,this._context=void 0,this._positionX=void 0,this._speed=void 0,this._stopAnimation=!1,this._canvas=e,this._canvasWidth=e.width,this._canvasHeight=e.height,this._lineHt=r/100*e.height,this._lineHt<ZCMediaRecorderConstants.audioWave.MIN_LINE_HEIGHT_THRESHOLD&&(this._lineHt=ZCMediaRecorderConstants.audioWave.MIN_LINE_HEIGHT_THRESHOLD)}).prototype={start:function(){this._context=this._canvas.getContext("2d"),this._positionX=this._canvasWidth,this._speed=ZCMediaRecorderConstants.audioWave.SPEED,this._moveLine(),this._drawLine(),this._id=requestAnimationFrame(this._animate.bind(this))},_drawLine:function(){this._context.beginPath(),this._context.moveTo(this._positionX,this._canvasHeight/2-this._lineHt/2),this._context.lineTo(this._positionX,this._canvasHeight/2+this._lineHt/2),this._context.lineWidth=ZCMediaRecorderConstants.audioWave.LINE_WIDTH,this._context.lineCap=ZCMediaRecorderConstants.audioWave.LINE_STYLE,this._context.stroke()},_moveLine:function(){this._positionX+=this._speed,this._positionX<0&&this._clear()},_clearPrevLine:function(){this._context.clearRect(this._positionX+ZCMediaRecorderConstants.audioWave.LINE_WIDTH/2,0,ZCMediaRecorderConstants.audioWave.LINE_WIDTH,this._canvasHeight),this._context.beginPath(),this._context.moveTo(this._positionX+ZCMediaRecorderConstants.audioWave.LINE_WIDTH/2,this._canvasHeight/2),this._context.lineTo(this._positionX+3*ZCMediaRecorderConstants.audioWave.LINE_WIDTH/2,this._canvasHeight/2),this._context.strokeStyle=ZCMediaRecorderConstants.audioWave.LINE_COLOR,this._context.lineWidth=1,this._context.stroke()},_animate:function(){this._moveLine(),this._drawLine(),this._clearPrevLine(),this._stopAnimation||(this._id=requestAnimationFrame(this._animate.bind(this)))},_clear:function(){this._stopAnimation=!0,cancelAnimationFrame(this._id)}};var ZCMediaRecorderSession={};(ZCMediaRecorderSession=function(e){this._id=e.session_id,this._chatId=e.chat_id,this._receiverId=e.receiver_id,this._receiverName=e.receiver_name,this._type=e.type||WebRTCUserMedia.streamTypes.AUDIO_ONLY,this._avStream=e.av_stream,this._isUserAudioForScreeRecordingIncluded=!1,this._isUserVideoForScreeRecordingIncluded=!1,this._userVideoStreamForScreenRecording=void 0,this._maxDuration=e.max_duration||ZCMediaRecorderConstants.MAX_RECORDING_TIME,this._handler=e.handler,this._recorderSessionTimerId=e.recorder_session_timer_id,this._recordingPlaybackSessionTimerId=e.player_session_timer_id,this._currentState=ZCMediaRecorderConstants.states.IDEAL,this._recorder=void 0,this._blobUrl=void 0,this._autoEndRecordingTimer=void 0,this._recordingStartTime=void 0,this._recordingPausedTime=void 0,this._recordingEndTime=void 0,this._recordingPlayer=void 0,this._isRecordingPlayerPaused=!1,this._isScheduledMessage=!1}).prototype={getId:function(){return this._id},hasChatId:function(){return void 0!==this._chatId},getChatId:function(){return this._chatId},setChatId:function(e){this._chatId=e},getReceiverId:function(){return this._receiverId},getReceiverName:function(){return this._receiverName},isVoiceMessage:function(){return WebRTCUserMedia.isAudioStreamType(this.getRecordingType())},isVideoMessage:function(){return WebRTCUserMedia.isAudioVideoStreamType(this.getRecordingType())},isScreenRecording:function(){return WebRTCUserMedia.isScreenStreamType(this.getRecordingType())},isVideoRecording:function(){return this.isVideoMessage()||this.isScreenRecording()},isScheduleMessage:function(){return this._isScheduledMessage},setScheduleMessage:function(e){this._isScheduledMessage=e},isUserAudioEnabledInScreenRecording:function(){return this.isScreenRecording()&&this._isUserAudioForScreeRecordingIncluded},setUserVideoEnabledInScreenRecording:function(e){this._isUserVideoForScreeRecordingIncluded=e},isUserVideoEnabledInScreenRecording:function(){return this.isScreenRecording()&&this._isUserVideoForScreeRecordingIncluded},setUserVideoStreamForScreenRecording:function(e){this._userVideoStreamForScreenRecording=e,this.setUserVideoEnabledInScreenRecording(!0)},getUserVideoStreamInScreenRecording:function(){return this._userVideoStreamForScreenRecording},removeUserVideoStreamForScreenRecording:function(){this.isUserVideoEnabledInScreenRecording()&&(WebRTCUserMedia.closeStream(WebRTCUserMedia.streamTypes.VIDEO_ONLY),this._userVideoStreamForScreenRecording=void 0,this.setUserVideoEnabledInScreenRecording(!1))},getRecordingType:function(){return this._type},getAVStream:function(){return this._avStream},setAVStream:function(e){this._avStream=e,this.isScreenRecording()&&e._hasAudioTrack()&&(this._isUserAudioForScreeRecordingIncluded=!0)},isInRecordingState:function(){return ZCMediaRecorderConstants.isInRecordingState(this.getCurrentState())},isInPausedState:function(){return ZCMediaRecorderConstants.isInPausedState(this.getCurrentState())},isInStoppedState:function(){return ZCMediaRecorderConstants.isInStoppedState(this.getCurrentState())},getCurrentState:function(){return this._currentState},setCurrentState:function(e){this._currentState=e},_getFileFormat:function(){return this.isVideoRecording()?ZCMediaRecorderConstants.recordingFormat.video:ZCMediaRecorderConstants.recordingFormat.audio},_getFileExtension:function(){return this.isVideoRecording()?ZCMediaRecorderConstants.fileExtension.video:ZCMediaRecorderConstants.fileExtension.audio},_getRecorder:function(){return this._recorder},_getConfig:function(){var e=function(e){if("function"==typeof this._handler.handleRecordingProgress){var r=(new Date-this._recordingStartTime)/this._maxDuration*100;this._handler.handleRecordingProgress(this.getId(),r)}}.bind(this);return{type:this.getRecordingType(),mimeType:ZCMediaRecorderConstants.recordingFormat.audio,recorderType:RecordRTC.StereoAudioRecorder,disableLogs:!0,numberOfAudioChannels:ZCMediaRecorderConstants.noOfAudioChannels,desiredSampRate:ZCMediaRecorderConstants.samplingRate,timeSlice:ZCMediaRecorderConstants.CHUNKING_DURATION,ondataavailable:e,checkForInactiveTracks:!0}},_setRecorder:function(){this.isVideoRecording()?this._recorder=new NativeMediaRecorder(this.getAVStream(),{mimeType:this._getFileFormat()}):this._recorder=new RecordRTC(this.getAVStream(),this._getConfig())},getRecordingPlayer:function(){return void 0===this._recordingPlayer&&this.canPlayRecordedFile()&&(this._setRecordingPlayer(),this._bindPlayerEvents()),this._recordingPlayer},_setRecordingPlayer:function(){this._recordingPlayer=new Audio(this._getBlobUrl())},getRecordingDuration:function(){return this._recordingEndTime-this._recordingStartTime},getRecordingDurationInSecs:function(){return this.getRecordingDuration()/1e3},startRecording:function(){this.isVideoRecording()&&this.isInPausedState()?this._getRecorder().resume():this._getRecorder().startRecording(),this.setCurrentState(ZCMediaRecorderConstants.states.RECORDING),"function"==typeof this._handler.handleRecordingStart&&this._handler.handleRecordingStart(this.getId(),this.getCurrentState()),this.startRecorderSessionTimer(),this._recordingStartTime=new Date,void 0!==this._maxDuration&&(this._autoEndRecordingTimer=setTimeout(this.stopRecording.bind(this),this._maxDuration))},showVideoRecordingPreviewAndAllowStartRecording:function(){"function"==typeof this._handler.handleVideoRecorderPreview&&this._handler.handleVideoRecorderPreview(this.getId(),this.getCurrentState(),this.getAVStream())},stopRecording:function(){if(this.isInRecordingState()||this.isInPausedState()){var e=this.isInPausedState(),r=function(r){this._blobUrl=r,this.setCurrentState(ZCMediaRecorderConstants.states.STOPPED),this._recordingEndTime=new Date,e&&(this._recordingEndTime=this._recordingPausedTime,this._recordingPausedTime=void 0),"function"==typeof this._handler.handleRecordingEnd&&this._handler.handleRecordingEnd(this.getId(),this.getCurrentState(),this.getRecordingDuration()),this.stopRecorderSessionTimer()}.bind(this);this.clearEndRecordingTimer(),this._recorder.stopRecording(r)}this._closeStream()},pauseOngoingRecording:function(){this._getRecorder().pause(),this._recordingPausedTime=new Date,this.setCurrentState(ZCMediaRecorderConstants.states.PAUSED),SessionTimers.pauseTimer(this._recorderSessionTimerId),this.clearEndRecordingTimer()},resumeRecording:function(){this._getRecorder().resume();var e=new Date,r=this._recordingStartTime-this._recordingPausedTime;this._recordingStartTime=new Date(Number(this._recordingStartTime)+(e-this._recordingPausedTime)),void 0!==this._maxDuration&&(this._autoEndRecordingTimer=setTimeout(this.stopRecording.bind(this),this._maxDuration-r)),this._recordingPausedTime=void 0,this.setCurrentState(ZCMediaRecorderConstants.states.RECORDING),SessionTimers.resumeTimer(this._recorderSessionTimerId)},_getBlobUrl:function(){return this._blobUrl},_closeStream:function(){void 0!==this._avStream&&(WebRTCUserMedia.closeStream(this.getAVStream()._getType()),this.isUserAudioEnabledInScreenRecording()&&WebRTCUserMedia.closeStream(WebRTCUserMedia.streamTypes.AUDIO_ONLY),this.isUserVideoEnabledInScreenRecording()&&WebRTCUserMedia.closeStream(WebRTCUserMedia.streamTypes.VIDEO_ONLY),this._avStream=void 0)},clearEndRecordingTimer:function(){clearTimeout(this._autoEndRecordingTimer),this._autoEndRecordingTimer=void 0},_bindPlayerEvents:function(){var e=this.getRecordingPlayer();e.onplay=function(e){"function"==typeof this._handler.handleRecordingPlaybackStart&&this._handler.handleRecordingPlaybackStart(this.getId(),this.getRecordingDuration()),this.startMediaPlayerTimer()}.bind(this),e.onpause=function(e){"function"==typeof this._handler.handleRecordingPlaybackStop&&this._handler.handleRecordingPlaybackStop(this.getId(),!0),this.pauseMediaPlayerTimer()}.bind(this),e.onended=function(e){"function"==typeof this._handler.handleRecordingPlaybackStop&&this._handler.handleRecordingPlaybackStop(this.getId(),!1,this.getRecordingDuration()),this.stopMediaPlayerTimer()}.bind(this),e.ontimeupdate=function(e){"function"==typeof this._handler.handleRecordingPlaybackTimeUpdate&&this._handler.handleRecordingPlaybackTimeUpdate(this.getId(),e.target)}.bind(this)},startRecorderSessionTimer:function(){void 0!==this._recorderSessionTimerId&&(ZCJQuery("#"+$.escapeSelector(this._recorderSessionTimerId)).empty(),SessionTimers.setTimer(this._recorderSessionTimerId,{allowPauseAndResume:!0}))},stopRecorderSessionTimer:function(){void 0!==this._recorderSessionTimerId&&SessionTimers.clearTimer(this._recorderSessionTimerId)},startMediaPlayerTimer:function(){void 0!==this._recordingPlaybackSessionTimerId&&(this._isRecordingPlayerPaused?SessionTimers.resumeTimer(this._recordingPlaybackSessionTimerId):(ZCJQuery("#"+$.escapeSelector(this._recordingPlaybackSessionTimerId)).empty(),SessionTimers.setTimer(this._recordingPlaybackSessionTimerId,{allowPauseAndResume:!0})))},pauseMediaPlayerTimer:function(){SessionTimers.pauseTimer(this._recordingPlaybackSessionTimerId),this._isRecordingPlayerPaused=!0},stopMediaPlayerTimer:function(){void 0!==this._recordingPlaybackSessionTimerId&&(this._isRecordingPlayerPaused=!1,SessionTimers.clearTimer(this._recordingPlaybackSessionTimerId),ZCJQuery("#"+$.escapeSelector(this._recordingPlaybackSessionTimerId)).text("00:00"))},initiateRecording:function(){void 0!==this._avStream&&(this._setRecorder(),this.isVideoMessage()?this.showVideoRecordingPreviewAndAllowStartRecording():this.isVoiceMessage()&&this.startRecording())},getRecordingAsFile:function(e){return new File([this._recorder.getBlob()],e+this._getFileExtension(),{type:this._getFileFormat()})},canPlayRecordedFile:function(){return this._recorder.getBlob().size>0&&ZCMediaRecorderConstants.isInStoppedState(this.getCurrentState())},playRecording:function(){var e=this.getRecordingPlayer();void 0!==e&&e.paused&&e.play()},pauseRecording:function(){var e=this.getRecordingPlayer();void 0!==e&&e.pause()},destroyRecorder:function(){this.clearRecordedData(),this._getRecorder().destroy(),this._recorder=void 0},clearRecordedData:function(){this._getRecorder().clearRecordedData(),this.stopRecorderSessionTimer(),this.clearEndRecordingTimer(),this.setCurrentState(ZCMediaRecorderConstants.states.IDEAL),this._recordingPlayer&&(this._recordingPlayer.srcObject=null,this._recordingPlayer=void 0),this._recordingStartTime=void 0,this._recordingPausedTime=void 0,this._recordingEndTime=void 0},muteUnmuteAudioInScreenRecord:function(e){this.isScreenRecording()&&void 0!==this._avStream&&(e?this._avStream._enableAudioTrack():this._avStream._disableAudioTrack())},hasRecordingData:function(){return this.isInRecordingState()||this.isInPausedState()||this.isInStoppedState()}};