var ComposerComponentUtils={constants:{ONE_ONE_CHAT_ID_NOT_KNOWN:"CHAT_ID_NOT_KNOWN_FOR_121_CHAT"},isChatIdExist:function(t){return"object"==typeof t&&t.chatId&&"string"==typeof t.chatId},isUndefined:function(t){var e=function(t){return void 0===t};return"object"==typeof t?t.constructor===Array&&0!=t.filter(e).length:e(t)},isString:function(t){return"string"==typeof t},isFunction:function(t){return"function"==typeof t},isDocumentFragment:function(t){return t instanceof DocumentFragment},constructAndGetId:function(t){var e=t.chatId;return t.msgId&&(e+="_"+t.msgId),"composer-component-"+e},applyCustomAttributes:function(t,e){var i=$(t);for(var n in e)i.attr(n,e[n]);return i[0].outerHTML},generateUniqueId:function(){var t=0;return function(e){return t+=1,e?e+t:t}}(),templates:function(){var t={composer:'<div id="{{COMPOSER_ID}}" composer-component class="zc-composer-wrap {{CUSTOM_CLASS}}"><div class="zc-composer-cont"><div class="zc-composer-main" composer-main-container><div attachment-feature-container></div><div div-editor-container></div></div></div><div smiley-feature-container></div><div voice-recorder-feature-container></div><div maxlimit-feature-container></div></div>',divEditor:'<div id="{{COMPOSER_ID}}-editor" class="zc-composer-input {{VOICE_MESSAGE_ICON_PADDING}}" data-composer-id="{{COMPOSER_ID}}" placeholder="{{PLACEHOLDER}}" data-type="composer" data-trigger="smiley" dir="auto" tabIndex="0" composer-component-editor rule="msg" contenteditable="true"></div>',attachmentFeature:'<div class="zc-composer-attach flexM" id="{{COMPOSER_ID}}-attachment-icon" attachment-options-container  data-composer-id="{{COMPOSER_ID}}"><div id="filepickeractionsholder{{COMPOSER_ID}}" class="filepckr-actn"><div class="fileatchmnt zcl-menu-wrap" align="top">{{ATTACHMENT_OPTIONS}}</div></div><em class="zcf-attach"></em></div>',attachmentOptions:"{{CODE_SNIPPET}}{{WHITE_BOARD}}{{ATTACH_FROM_CLOUD}}{{UPLOAD_FROM_COMPUTER}}",attachmentOptionsTemplates:{codeSnippet:'<div purpose="codesnippet" class="zcl-menu-item ellips" attachment-option data-composerid="{{COMPOSER_ID}}"><em class="zcl-menu-item-icn zcf-code-snippet"></em><span class="ellips">'+Resource.getRealValue("common.code.snippet")+"<span></div>",whiteBoard:'<div purpose="whiteboard" class="zcl-menu-item ellips" attachment-option data-composerid="{{COMPOSER_ID}}"><em class="zcl-menu-item-icn zcf-artboard"></em><span class="ellips">'+Resource.getRealValue("board.attach")+"</span></div>",attachCloud:'<div purpose="cloudatchmnt" class="zcl-menu-item ellips" attachment-option data-composerid="{{COMPOSER_ID}}"><em class="zcl-menu-item-icn zcf-cloud"></em><span class="ellips">'+Resource.getRealValue("common.attach.method.cloud")+"</span></div>",uploadComputer:'<div id="subfile{{COMPOSER_ID}}" class="zcl-menu-item ellips posrel"><em class="zcl-menu-item-icn zcf-computer"></em><span class="ellips">'+Resource.getRealValue("common.attach.method.desktop")+'</span><form id="upload{{COMPOSER_ID}}" type="html5" enctype="multipart/form-data"><input type="file" multiple name="file1" class="sendfile wh100" id="file{{COMPOSER_ID}}"></form></div>'},smileyFeature:'<div class="zc-composer-emoji flexM"><em class="zcf-emoji cur" id="{{COMPOSER_ID}}-smiley-icon" data-composer-id="{{COMPOSER_ID}}"  data-action="openSmileyContainer" ></em></div><div id="{{COMPOSER_ID}}-smiley-container" class="smileydivmn" ignore_sticker="true" ignore_giphy="true"></div><div class="zc-composer-abscont smilyatdrpdwn animEmoji dN" id="{{COMPOSER_ID}}-smiley-suggestion-container" data-composer-id="{{COMPOSER_ID}}" smiley-suggestion-container></div>',voiceRecorderFeature:'<div class="zc-composer-recorder flexM"><em class="zcf-mic cur" id="{{COMPOSER_ID}}-recorder-icon" data-composer-id="{{COMPOSER_ID}}"  data-action="startVoiceRecorder"></em></div>',atmentionFeature:'<div class="zc-composer-abscon" id="{{COMPOSER_ID}}-user-suggestion-container" data-composer-id="{{COMPOSER_ID}}" user-suggestion-container></div>',maxLimitFeature:'<div id="{{COMPOSER_ID}}-max-limit" class="zc-composer-count dN">{{MAXLIMIT}}</div>'},e=function(t){var e=t.additionalInfoObj||{},i={COMPOSER_ID:t.composerId},n=Object.assign({},i,e),s=t.isInsecureHtml?"InSecureHTML":"";return t.customAttributes&&(t.template=ComposerComponentUtils.applyCustomAttributes(t.template,t.customAttributes)),$WC.template.replace(t.template,n,s)};return{getComposer:function(i){i={template:t.composer,composerId:i.composerId,customAttributes:i.customAttributes,additionalInfoObj:{CUSTOM_CLASS:i.customClass||""}};return e(i)},getDivEditor:function(i){i={template:t.divEditor,composerId:i.composerId,additionalInfoObj:{PLACEHOLDER:i.placeHolder,VOICE_MESSAGE_ICON_PADDING:!WmsImpl.isGuestConferenceUser()&&ZCMediaRecorder.isVoiceNoteFromChatEnabled()?"zcaudiorecord":""}};return e(i)},getSmileyFeature:function(i){return e({template:t.smileyFeature,composerId:i})},getVoiceRecorderFeature:function(i){return e({template:t.voiceRecorderFeature,composerId:i})},getAttachmentFeature:function(i){var n={template:t.attachmentFeature,composerId:i.composerId},s=e(n),o=this.getAttachmentOptions(i);return e({template:s,additionalInfoObj:{ATTACHMENT_OPTIONS:o},isInsecureHtml:!0})},getAttachmentOptions:function(i){var n=t.attachmentOptionsTemplates,s=i.composerId,o=i.permissions,r={template:t.attachmentOptions,additionalInfoObj:{CODE_SNIPPET:o.hasSnippet?e({template:n.codeSnippet,composerId:s}):"",WHITE_BOARD:o.hasWhiteBoard?e({template:n.whiteBoard,composerId:s}):"",ATTACH_FROM_CLOUD:o.hasAttachCloud?e({template:n.attachCloud,composerId:s}):"",UPLOAD_FROM_COMPUTER:o.hasUpload?e({template:n.uploadComputer,composerId:s}):""},isInsecureHtml:!0};return e(r)},getMaxLimitFeature:function(i){var n={MAXLIMIT:i.maxLimit||1e3};i={template:t.maxLimitFeature,composerId:i.composerId,additionalInfoObj:n};return e(i)},getAtMentionFeature:function(i){return e({template:t.atmentionFeature,composerId:i})}}}(),mixin:function(t,e){e.forEach((function(e){Object.assign(t,e)}))},getDomCache:function(t){return{editor:"#"+t+"-editor",smiley_icon:"#"+t+"-smiley-icon",recorder_icon:"#"+t+"-recorder-icon",attachment_icon:"#"+t+"-attachment-icon",attachment_options:"#filepickeractionsholder"+t,smiley_container:"#"+t+"-smiley-container",smiley_suggestion_container:"#"+t+"-smiley-suggestion-container",at_mentions_suggestion_container:"#"+t+"-user-suggestion-container",at_mentions_suggestion_list:"#"+t+"-user-suggestion-container > .zc-composer-listcont",at_mentions_list_container:"#"+t+"-user-list",max_limit_container:"#"+t+"-max-limit"}},createAndGetElement:function(t,e,i){var n=document.createElement("div"),s={composerId:t,customClass:e,customAttributes:i};return n.innerHTML=this.templates.getComposer(s),n},isSmileySelectFromComposerSuggestion:function(t){var e=t.hasAttribute("code"),i=t.parentElement.classList.contains("zc-composer-input"),n="smileys"==t.parentElement.parentElement.parentElement.id;return e&&!i&&n},isSmileySelectFromPopUp:function(t){var e=t.hasAttribute("code"),i=t.parentElement.classList.contains("zc-composer-input");return e&&!i},getChatDetailsConstructor:function(){function t(t){this.chatId=t,this.chatDetails=this._getChatDetails()||{},this.channelDetails=this._getChannelDetails()}return t.prototype={_getChatDetails:function(){return ConversationsList.getAll()[this.chatId]},_getChannelDetails:function(){return this.isChannel()?Channels.getByChid(this.chatId):null},isChannel:function(){return!$.isEmptyObject(Channels.getByChid(this.chatId))},isCrossProductChat:function(){return 5==this.chatDetails.ctype},isThreadChat:function(){return this.chatDetails.ctype==$zcg.THREADCHAT},isGroupChat:function(){return ConversationsList.isGroupChat(this.chatId)},isSystemChat:function(){return this.isDefaultBot()||this.isCustomBot()},isDefaultBot:function(){return new $CliqChatId(this.chatId).isDefaultBot()},isCustomBot:function(){return new $CliqChatId(this.chatId).isCustomBot()},isOrgChannel:function(){return this.isChannel()&&Channels.isOrgScope(Channels.getLevel(this.channelDetails))},isOrgGroupChannel:function(){return this.isChannel()&&Channels.isOrgGroupScope(Channels.getLevel(this.channelDetails))},isSharedChannel:function(){return this.isChannel()&&Channels.isSharedScope(Channels.getLevel(this.channelDetails))},isPrivateChannel:function(){return this.isChannel()&&Channels.isPrivateScope(Channels.getLevel(this.channelDetails))},isOpenToAllChannel:function(){return this.isChannel()||!Channels.isOpenToAll(this.channelDetails)},hasSpecialMentionPermissions:function(){return this.isChannel()&&ChannelsPermission.hasPermission(Channels.ACTIONS.SPECIAL_MENTIONS,this.channelDetails)},hasMentionUsersPermissions:function(){return this.isChannel()&&ChannelsPermission.hasPermission(Channels.ACTIONS.MENTION_USERS,this.channelDetails)},hasAddMemberPermission:function(){return this.isChannel()&&ChannelsPermission.hasPermission(Channels.ACTIONS.ADD_MEMBER,this.channelDetails)},hasAnyAdvancedRules:function(){return this.isChannel()&&Channels.hasAnyAdvancedRules(this.channelDetails)},hasPendingInvite:function(){return $WC.Matcher.check("emailid",this.chatDetails.addinfo?this.chatDetails.addinfo.PEND_INV:"")},hasChannelScopeId:function(){return this.isChannel()&&!$.isEmptyObject(this.channelDetails.scid)},getChannelScopeId:function(){return this.channelDetails.scid},getUserSearchIn:function(){var t=SearchAgent.PARTICIPANTS+SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS;return this.isCrossProductChat()||(t+=SearchAgent.BOTS),this.isOrgChannel()&&this.hasSpecialMentionPermissions()&&!this.hasAnyAdvancedRules()&&(t+=SearchAgent.ORGGROUPS),this.isOrgGroupChannel()&&(t+=SearchAgent.CUSTOMSEARCH,this.hasChannelScopeId()&&(t+=SearchAgent.ORGGROUPS)),this.isThreadChat()&&(t+=SearchAgent.SUBSCRIBERS+SearchAgent.UNSUBSCRIBERS),t},getChannelsSearchIn:function(){if(this.isOpenToAllChannel())return this.isOrgChannel()&&!this.hasAnyAdvancedRules()||this.isOrgGroupChannel()?SearchAgent.CHANNELS:void 0},getChannelCategory:function(){if(this.isOpenToAllChannel())return this.isOrgChannel()&&!this.hasAnyAdvancedRules()?ChannelsUI.List.RETRIVE_ORG:this.isOrgGroupChannel()?ChannelsUI.List.RETRIVE_ORG_GROUP:void 0},getChannelScId:function(){if(this.isChannel())return this.channelDetails.scid},getValidOrgGroups:function(){var t=null;return this.isChannel()&&this.isOrgGroupChannel()&&this.hasChannelScopeId()&&(t=this.getChannelScopeId()),t},getAdditionalSearchCriteria:function(){var t={};return this.isThreadChat()&&(t.threadchid=this.chatId,t.parentchid=this.chatDetails.getParentChatId()),t},allOrgGroups:function(){var t=!1,e=this.isOrgChannel()&&this.hasSpecialMentionPermissions()&&!this.hasAnyAdvancedRules(),i=this.isOrgGroupChannel()&&this.hasChannelScopeId();return this.isChannel()&&(e||i)&&(t=!0),t},getAllowedTriggers:function(){var t=["@","+",":","cc:","cc:@","/"],e=[];if(this.isChannel())return e=[":"],SecurityManager.hasPermission(Modules.Commands)&&e.push("/"),this.hasSpecialMentionPermissions()&&e.push("#","cc:@","cc:"),this.hasMentionUsersPermissions()&&e.push("@"),this.hasAddMemberPermission()&&e.push("+"),e;if(this.isSystemChat())return e=[":","/","@"];if(this.hasPendingInvite())return e=[":","/","@","cc:","cc:@"];if(!SecurityManager.hasPermission(Modules.GroupChat,MActions.Create)){var i=t.indexOf("+");return e=t,-1!==i&&e.splice(i,1),e}return t},isSpecialMentionAllowed:function(){return this.isChannel()?ChannelsPermission.hasPermission(Channels.ACTIONS.SPECIAL_MENTIONS,Channels.getChannelId(this.chatId)):this.isGroupChat()&&new $CliqChatId(this.chatId).isChat()},isAtMentionTriggerAllowed:function(){var t=this.getAllowedTriggers().join("");return/@|cc/.test(t)},isAvailableMentionAllowed:function(){return this.isSpecialMentionAllowed()},isAllMentionAllowed:function(){return this.isSpecialMentionAllowed()},isChannelMentionAllowed:function(){var t=this.getAllowedTriggers().join("");return/#/.test(t)}},t}(),chatDetails:function(t){return new this.getChatDetailsConstructor(t)},defaultOneToOneChatDetails:function(){return{searchIn:SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS+SearchAgent.PARTICIPANTS,validOrgGroups:null,allOrgGroups:!1}},getSearchInOrgGroupsAndAllGroupsByChatId:function(t){if(t==this.constants.ONE_ONE_CHAT_ID_NOT_KNOWN)return this.defaultOneToOneChatDetails();var e=this.chatDetails(t);return{searchIn:e.getUserSearchIn(),validOrgGroups:e.getValidOrgGroups(),allOrgGroups:e.allOrgGroups(),additionalSearchCriteria:e.getAdditionalSearchCriteria()}},getChannelsSearchIn:function(t){return this.chatDetails(t).getChannelsSearchIn()},getChannelScid:function(t){return this.chatDetails(t).getChannelScId()},getChannelCategory:function(t){return this.chatDetails(t).getChannelCategory()},getAllowedTriggers:function(t){return t?t==this.constants.ONE_ONE_CHAT_ID_NOT_KNOWN?["@",":","cc:","cc:@"]:this.chatDetails(t).getAllowedTriggers():[":"]},isAtMentionTriggerAllowed:function(t){return t==this.constants.ONE_ONE_CHAT_ID_NOT_KNOWN||this.chatDetails(t).isAtMentionTriggerAllowed()},isAvailableMentionAllowed:function(t){return t!=this.constants.ONE_ONE_CHAT_ID_NOT_KNOWN&&this.chatDetails(t).isAvailableMentionAllowed()},isAllMentionAllowed:function(t){return t!=this.constants.ONE_ONE_CHAT_ID_NOT_KNOWN&&this.chatDetails(t).isAllMentionAllowed()},isChannelMentionAllowed:function(t){return t!=this.constants.ONE_ONE_CHAT_ID_NOT_KNOWN&&this.chatDetails(t).isChannelMentionAllowed()},createMentionMemberNode:function(t,e,i){return Composer.createMentionMemberNode(t,e,i)},getPlainTextFromComposer:function(t){return Composer.getPlainTextFromComposer(t)},getSelectedUsers:function(t,e){return Composer.getSelectedList(t)},getComposerInstanceByEvent:function(t){var e=$(t.currentTarget).attr("data-composer-id");return ComposerComponent.getComposerById(e)},createContextualFragment:function(t){return t instanceof DocumentFragment?t:document.createRange().createContextualFragment(t)},getFragment:function(){return document.createDocumentFragment()},getComposerContentAsFragment:function(t){var e=document.getElementById(t);if(!e)throw new Error("Composer not exists in the DOM :(");var i=document.createDocumentFragment(),n=e.innerHTML;const s=this.createContextualFragment(n);return i.appendChild(s),i},getZeroWidthTextNode:function(){return document.createTextNode("\u200b")},convertToComposerInsertableNodes:function(t){var e=t.htmlString,i=t.atMention,n=!!this.isUndefined(t.allMention)||t.allMention,s=!!this.isUndefined(t.availableMention)||t.availableMention,o=!!this.isUndefined(t.channelMention)||t.channelMention,r=document.createRange().createContextualFragment(e),a=this;return[].slice.call(r.childNodes).map((function(t,e,r){var c=a.getNodeDetails(t);return c.isSelfMentionNode()?"@"+WmsImpl.getNickName():function(t){return t.isMentionNode()&&!i||t.isAllMentionNode()&&!n||t.isAvailableMentionNode()&&!s||t.isChannelMentionNode()&&!o}(c)?t.innerText:c.isSmileyNode()||c.isBrNode()?function(t,e,i){var n=a.getFragment(),s=e&&a.getNodeDetails(e).hasZeroWidthSpace(),o=i&&a.getNodeDetails(i).hasZeroWidthSpace();return!s&&n.appendChild(a.getZeroWidthTextNode()),n.appendChild(t),!o&&n.appendChild(a.getZeroWidthTextNode()),n}(t,r[e-1]):c.isTextNode()?t.textContent:t})).reduce((function(t,e){return t.append(e),t}),this.getFragment())},getNodeDetails:function(){function t(t){this.node=t}return t.prototype={getLength:function(){return this.isTextNode()?this.getTextNodeLength():this.isBrNode()||this.isSmileyNode()?1:this.node.innerText.length},isTextNode:function(){return this.node.nodeType==Node.TEXT_NODE},isBrNode:function(){return"br"==this.getNodeName()},isSmileyNode:function(){return $(this.node).attr("code")},isAnchorNode:function(){return"a"==this.getNodeName()},isMentionNode:function(){return $(this.node).attr("uid")},isSelfMentionNode:function(){return this.isMentionNode()==WmsImpl.getZuid()},isAllMentionNode:function(){return"mention_6"==$(this.node).attr("elemtype")},isAvailableMentionNode:function(){return"mention_7"==$(this.node).attr("elemtype")},isChannelMentionNode:function(){return"channel"==$(this.node).attr("elemtype")},getNodeName:function(){return this.node.nodeName.toLowerCase()},getSplicedNode:function(t){if(t-this.getLength()<0){if(!this.isTextNode())return null;this.hasZeroWidthSpace()&&(t+=1),this.node.nodeValue=this.node.nodeValue.slice(0,t)}return this.node},hasZeroWidthSpace:function(){return this.isTextNode()&&8203==this.node.nodeValue.charCodeAt(0)},getTextNodeLength:function(){var t=this.node.length;return this.hasZeroWidthSpace()&&t--,t}},function(e){return new t(e)}}(),getSplicedHtml:function(t){t={htmlString:t.htmlString,spliceLimit:this.isUndefined(t.spliceLimit)?Number.POSITIVE_INFINITY:t.spliceLimit,atMention:t.atMention||!1};for(var e,i=document.createDocumentFragment(),n=this.createContextualFragment(t.htmlString),s=[].slice.call(n.childNodes),o=t.spliceLimit,r={atMention:t.atMention},a=0;null!=(e=s[a])&&0!=o;a++){var c=this.getNodeDetails(e,r),l=c.getSplicedNode(o);if(!l)break;i.appendChild(l),o-=c.getLength()}return i},initEditor:function(t){if(!(t in $WC.DivEditor.editors)){$WC.DivEditor.initEditor(t,{avoidEventBinding:!0,highlightclass:"sel",trigger:"composer"})}},getTextNodeValue:function(t){if(8203!==t.charCodeAt(0))return t;for(var e=0,i="";!isNaN(t.charCodeAt(e));)[8203].includes(t.charCodeAt(e))?i+="":i+=t.charAt(e),++e;return i},getSmileyNodeValue:function(t,e){var i=Composer.getSmileyCode(t).trim();return/\s$/.test(e)?i:" "+i},getMsgContent:function(t){for(var e=$WC.DivEditor.getNodes(t),i=e.length,n="",s=0;s<i;s++){var o=e[s];if(o.nodeType!==Node.TEXT_NODE){var r=o.getAttribute("nodetype"),a=o.getAttribute("elemtype");Composer.isMentionTrigger(r,a)?n+=Composer.getMention(o):":"==r||o.hasAttribute("code")?n+=this.getSmileyNodeValue(o,n):"BR"!==o.tagName?n+=$(o).text():n+="\n"}else n+=this.getTextNodeValue(o.nodeValue)}return n=$WC.DivEditor.removeBufferCharacters(n),n=$.trim(n)},getCopiedText:function(t){return window.clipboardData?window.clipboardData.getData("Text"):(t.originalEvent||t).clipboardData.getData("text/plain")},addSpaceIfNoSpaceExistsAtEnd:function(t){return this.isString(t)&&/[\s|&nbsp;]$/.test(t)?t:t+" "},removeZeroWidthSpace:function(t){return this.isString(t)&&""!=t&&$WC.Util.unescapeHTML(t.replace(/\u200B|&#8203;/g,""))||""}},ComposerFeatures={getSmileyFeature:function(){return{smileyFeature:{smileyTrigger:":",data:{},updateData:function(t){this.data={parent_element:t.parentElement,composerId:t.composerId,smiley_icon:t.smiley_icon,smiley_suggestion_container:t.smiley_suggestion_container,smiley_container:t.smiley_container,div_editor_id:t.div_editor_id.replace("#","")}},Util:ComposerComponentUtils,init:function(t){this.updateData(t),this.render()},render:function(){var t=this.Util.templates.getSmileyFeature(this.data.composerId);$(this.data.parent_element).find("[smiley-feature-container]").replaceWith(t)},openSmileyContainer:function(t){var e=this.data.smiley_icon.replace("#",""),i=this.data.smiley_container.replace("#","");Smiley.showSmileyUI(e,i,t)},closeSmileyContainer:function(t){$Util.isCtrlorCmdKey(t)||Clickoutside.handleClickOnChild(t)},getSmileyNode:function(t){var e=t.attr("code"),i=t.attr("unicode");e=i||e;var n=Smiley.replace(e,!0,!0);return n="undefined"!=typeof CustomSmiley?CustomSmiley.replaceEmoji(n,!1):n,$(n)[0]},updateRecentSmiley:function(t){var e=t.attr("code"),i=t.parents("[data-purpose]").attr("data-purpose");Smiley.updateRecentSmiley(e,i)},isSmileyTrigger:function(t){return t==this.smileyTrigger},openSmileySuggestions:function(t){var e=this.data.div_editor_id.replace("#",""),i=this.data.smiley_suggestion_container.replace("#",""),n={listid:i,srcid:e,destid:i,searchin:32,peopledata:!0,val:this.smileyTrigger+t};SearchAgent.search(n)&&(this.selectFirstSmileyInSuggestion(),this.scrollTop())},scrollTop:function(){$(this.data.smiley_suggestion_container).scrollTop(0)},clearClickOutside:function(){this.emptyAndHideSuggestionContainer(),Clickoutside.clear(this.data.smiley_suggestion_container)},selectFirstSmileyInSuggestion:function(){var t=$(this.data.smiley_suggestion_container);t.find('[purpose="search"]').first().addClass("srchbn sel"),t.show(),ZCScroll.customScroll(t,!0)},isSmileySuggestionVisible:function(){return $(this.data.smiley_suggestion_container).is(":visible")},emptyAndHideSuggestionContainer:function(){$(this.data.smiley_suggestion_container).empty().hide()},getSelectedSmileyNode:function(t){var e=t||$(this.data.smiley_suggestion_container).find(".sel");return this.getSmileyNode(e)},handleSmileyNavigation:function(t){var e=$(this.data.smiley_suggestion_container),i=Math.floor(e.width()/e.find('[elemtype="smiley"]').first().outerWidth());DropdownUtil.handleGridNavigation(t,e,"[purpose='search']",i)},canPreventDefaultKeyDown:function(t){var e=t.which;return!t.shiftKey&&$Util.isArrowKey(e)&&this.isSmileySuggestionVisible()}}}},getVoiceRecorderFeature:function(){return{voiceRecorderFeature:{data:{},updateData:function(t){this.data={composerId:t.composerId,parent_element:t.parentElement,recorder_icon:t.recorder_icon,chatId:t.chatId}},Util:ComposerComponentUtils,init:function(t){this.updateData(t),this.render()},render:function(){var t=this.Util.templates.getVoiceRecorderFeature(this.data.composerId);$(this.data.parent_element).find("[voice-recorder-feature-container]").replaceWith(t)},startVoiceRecording:function(t){ZCMediaRecorderImpl.startAudioRecording(t,this.data.chatId)}}}},getAttachmentFeature:function(){return{attachmentFeature:{data:{},updateData:function(t){this.data={parentElement:t.parentElement,attachment_icon:t.attachment_icon,composerId:t.composerId,permissions:t.attachmentOptions}},init:function(t){this.updateData(t),this.render()},render:function(){var t={composerId:this.data.composerId,permissions:this.data.permissions},e=ComposerComponentUtils.templates.getAttachmentFeature(t);$(this.data.parentElement).find("[attachment-feature-container]").replaceWith(e)}}}},getGifFeature:function(){return{gifFeature:{data:{},updateData:function(t){this.data={parent_element:t.parentElement,smiley_container:t.smiley_container}},init:function(t){this.updateData(t);var e=$(this.data.parent_element).find(this.data.smiley_container);e.attr("ignore_giphy","false"),e.attr("ignore_sticker","false")}}}},getAtMentionFeature:function(){return{atMentionFeature:{data:{},constants:{PARTICIPANTS:"participants",ALL:"all",AVAILABLE:"available"},updateData:function(t){this.data={composerId:t.composerId,parentElement:t.parentElement,chatId:t.chatId,parentChatId:t.parentChatId,div_editor_id:t.div_editor_id,at_mentions_suggestion_container:t.at_mentions_suggestion_container,suggestion_list_container:t.at_mentions_suggestion_list,at_mentions_list_container:t.at_mentions_list_container,allowMultipleMentions:t.allowMultipleMentions,oneToOneChatparticipantId:t.oneToOneChatparticipantId,additionalSearchCriteria:t.additionalSearchCriteria||{}}},Util:ComposerComponentUtils,validUserMentiontriggers:["@","cc:","cc:@"],validChannelMentionTrigger:["#"],activeTrigger:"",atTriggerPosition:{},init:function(t){this.updateData(t),this.render()},render:function(){var t=this.Util.templates.getAtMentionFeature(this.data.composerId);$("body").append(t)},getSelectedUserNode:function(t){return t=t||$(this.data.at_mentions_suggestion_container).find(".sel")[0],this.Util.createMentionMemberNode(t,this.activeTrigger,this.data.chatId)},openUsersSuggestionPopUp:function(t){var e=this.Util.getSearchInOrgGroupsAndAllGroupsByChatId(this.data.chatId),i=e.searchIn,n=e.validOrgGroups,s=e.allOrgGroups,o=this.getIgnoreList(),r=this.getUsersGroupingMode(),a=this.data.div_editor_id.replace("#",""),c=this.data.at_mentions_suggestion_container.replace("#",""),l=this.getListContainer(),d=this.templates;$(this.data.at_mentions_suggestion_container).html(l);var h={listid:this.data.at_mentions_list_container.replace("#",""),srcid:a,destid:c,debugsource:a,searchin:i,chid:this.data.chatId,peopledata:!0,groupingmode:r,ignorelist:o,allstatuscontacts:!1,protocol:[],listHtml:d.user_suggestion_list,groupshtml:d.groups_suggestion_list,customCategoryTemplate:d.category_template,customWrapperTemplate:d.sticky_title_wrapper,limit:25,oneToOneChatparticipantId:this.data.oneToOneChatparticipantId,validorggroups:n,allorggroups:s,customobject:void 0,val:t,specialmentions:!this.data.oneToOneChatparticipantId,ignoreGuest:!0,clearcallback:function(){this.emptyAndHideSuggestions()}.bind(this)};$.extend(h,e.additionalSearchCriteria,this.data.additionalSearchCriteria),SearchAgent.search(h)&&("*"==t&&(this.updateAtTriggerPosition(),this.adjustSuggestionPosition()),MentionsUI.populatePermissions($(this.data.at_mentions_suggestion_container),this.Util.chatDetails(this.data.chatId)))},openChannelsSuggestionPopUp:function(t){var e=this.data.div_editor_id.replace("#",""),i=this.templates,n=this.data.at_mentions_list_container.replace("#",""),s=$(this.data.at_mentions_suggestion_container),o=this.data.parentChatId||this.data.chatId;s.html(this.getListContainer());var r={listid:n,srcid:e,destid:this.data.at_mentions_suggestion_container.replace("#",""),debugsource:e,searchin:this.Util.getChannelsSearchIn(o),chid:o,ignorelist:[Channels.getChannelId(o)],channelslistHtml:i.channels_suggestion_list,customCategoryTemplate:i.category_template,customWrapperTemplate:i.channel_sticky_title_wrapper,limit:25,val:t,replacecontentonsuccesscallback:!0,scid:this.Util.getChannelScid(o),channelcategory:this.Util.getChannelCategory(o),add_open_to_all_only:!0,clearcallback:function(){this.emptyAndHideSuggestions()}.bind(this)};SearchAgent.search(r)&&"*"==t&&(this.updateAtTriggerPosition(),this.adjustSuggestionPosition())},updateAtTriggerPosition:function(){var t=$(document),e=window.getCaretPosition(),i=t.height()-e.top,n=e.left-11.64,s=t.width()-n-11.64,o=s,r=$(this.data.at_mentions_suggestion_container),a=r.width(),c=r.height()||510,l={bottom:i,"max-height":510},d=s>=a,h=e.top>c,u=e.top,m=i;d?l.left=n:l.right=o,l["max-height"]=u>510?510:u,h||(u>=m?l["max-height"]=u>510?510:u:(delete l.bottom,l.top=u+14+2,l["max-height"]=m>510?510:m),l["max-height"]-=19),this.setAtTriggerPosition(l)},setAtTriggerPosition:function(t){this.atTriggerPosition=t},getAtTriggerPosition:function(){return this.atTriggerPosition},adjustSuggestionPosition:function(){var t=$(this.data.at_mentions_suggestion_container);t.css({left:"",right:"",bottom:"",top:"","max-height":""});var e=this.getAtTriggerPosition();t.css(e)},getIgnoreList:function(){var t=WmsImpl.getZuid(),e=this.data.allowMultipleMentions;return[t].concat(e?this.getSpecialMentions():this.getAllMentions())},getListContainer:function(){return'<div id="'+this.data.composerId+'-user-list" class="zc-composer-list"></div>'},getAllMentions:function(){return $(this.data.div_editor_id).find("span[nodetype]").toArray().map((function(t){return $(t).attr("uid")}))},getSpecialMentions:function(){var t=$(this.data.div_editor_id).find("span[nodetype]").toArray(),e=this.constants;return t.filter((function(t){return[e.ALL,e.PARTICIPANTS,e.AVAILABLE].includes($(t).attr("uid"))})).map((function(t){return $(t).attr("uid")}))},getUsersGroupingMode:function(){return new $CliqChatId(this.data.chatId).isChannel()?SearchAgent.GROUPING_CHANNELS:SearchAgent.GROUPING_CHATS},setCurrentAtTriggerValue:function(t){this.activeTrigger=t},isUserMentionTrigger:function(t){return this.validUserMentiontriggers.includes(t)},isChannelMentionTrigger:function(t){return this.validChannelMentionTrigger.includes(t)},emptyAndHideSuggestions:function(){$(this.data.at_mentions_suggestion_container).empty().hide()},isSuggestionsVisible:function(){return $(this.data.at_mentions_list_container).is(":visible")},handleSuggestionNavigation:function(t){DropdownUtil.handleListNavigation(t,$(this.data.at_mentions_suggestion_container),"[purpose='search']")},canPreventDefaultKeyDown:function(t){var e=t.which;return[$zcg.UP_KEYCODE,$zcg.DOWN_KEYCODE].includes(e)&&this.isSuggestionsVisible()},templates:{user_suggestion_list:'<div uid="{USERID}" elemtype="contact" data-val="{DNAME}" purpose="search" class="zcl-list-item ellips"><div class="zcl-img mR12"><img src="{IMGURL}"><span class="{STATUSCLASS}"></span></div><div id="contactdname{USERID}" class="flexG ellips"><div class="font14 ellips">{DNAMEVAL}</div><div id="contactmailid{USERID}" class="font13 mT5 clr-lp1 ellips">{EMAILID}</div></div></div>',channels_suggestion_list:'<div id="channel{ID}" uid="{CHANNELID}" elemtype="channel" purpose="search" class="zcl-list-item ellips"><div class="zcl-img mR12"><img src="{IMGURL}"></div><div id="channelname{ID}" class="flexG ellips"><div class="font14 ellips">{DNAMEVAL}</div><div class="font13 mT5 clr-lp1 ellips">{CDESCRIPTION}</div></div></div>',groups_suggestion_list:'<div id="group{ID}" uid="{GROUPID}" elemtype="group" purpose="search" class="zcl-list-item ellips"><div class="zcl-img mR12"><img src="{IMGURL}"></div><div id="groupdname{ID}" class="flexG ellips"><div class="font14 ellips">{DNAMEVAL}</div><div class="font13 mT5 clr-lp1 ellips">{DNAMEVAL}</div></div></div>',sticky_title_wrapper:'<div class="zc-composer-listcont"><div class="zc-composer-title zc-composer-fixedtitle" zc_sticky_title></div></div>',channel_sticky_title_wrapper:'<div class="zc-composer-listcont"><div class="zc-composer-title zc-composer-fixedtitle">'+Resource.getRealValue("menuname.channelsandgroups")+"</div></div>",category_template:'<div class="dN mT6 font13" categorygroup="specialmentions" ><div class="zc-composer-title flexC" mentiontitle="specialmentions" zc_grouping_title ></div></div><div class="dN" categorygroup="participant" ><div class="zc-composer-title flexC" mentiontitle="participant" zc_grouping_title >'+Resource.getRealValue("common.participants")+'<span></span></div></div><div class="dN" categorygroup="subscribers" ><div class="zc-composer-title flexC" mentiontitle="subscribers" zc_grouping_title >'+Resource.getRealValue("thread.followers")+'<span></span></div></div><div class="dN" categorygroup="unsubscribers" ><div class="zc-composer-title flexC" mentiontitle="unsubscribers" zc_grouping_title >'+Resource.getRealValue("thread.unfollowers")+'<span></span></div></div><div class="dN" categorygroup="teammember" ><div class="zc-composer-title flexC" mentiontitle="teamMember" zc_grouping_title >'+Resource.getRealValue("common.team.members")+'<span></span></div></div><div class="dN" categorygroup="orgUser" ><div class="zc-composer-title flexC" mentiontitle="orgUser" zc_grouping_title >'+Resource.getRealValue("common.org.users")+'<span></span></div></div><div class="dN" categorygroup="orgGroups" ><div class="zc-composer-title flexC" mentiontitle="orgGroups" zc_grouping_title >'+Resource.getRealValue("module.teams")+"<span>( "+Resource.getRealValue("common.teams.members.notified")+' )</span></div></div><div class="dN" categorygroup="externalcontacts" ><div class="zc-composer-title flexC" mentiontitle="external" zc_grouping_title >'+Resource.getRealValue("common.external.users")+"<span> ("+Resource.getRealValue("common.user.will.not.notified")+')</span></div></div><div class="dN" categorygroup="botcontacts" ><div class="zc-composer-title flexC" mentiontitle="bot" zc_grouping_title >'+Resource.getRealValue("bots.title")+'<span> </span></div></div><div class="dN" categorygroup="channels"><div class="zc-composer-title flexC" mentiontitle="channel" zc_grouping_title>'+Resource.getRealValue("menuname.channelsandgroups")+'<span></span></div></div><div class="dN" categorygroup="chats"><div class="zc-composer-title flexC" mentiontitle="chat" zc_grouping_title>'+Resource.getRealValue("menuname.chats")+"<span></span></div></div>"}}}},getMaxLimitFeature:function(){return{maxLimitFeature:{data:{},updateData:function(t){this.data={composerId:t.composerId,maxLimit:t.maxLimit,parentElement:t.parentElement,editorId:t.div_editor_id,max_limit_container:t.max_limit_container}},currentLength:0,Util:ComposerComponentUtils,getMaxLimit:function(){return this.data.maxLimit},init:function(t){this.updateData(t),this.render()},render:function(){var t={composerId:this.data.composerId,maxLimit:this.data.maxLimit},e=this.Util.templates.getMaxLimitFeature(t);$(this.data.parentElement).find("[maxlimit-feature-container]").replaceWith(e)},getCurrentLength:function(){var t=$(this.data.editorId)[0];if(t){var e=Array.prototype.slice.apply(t.childNodes),i=this;return e.reduce((function(t,e){return t+i.Util.getNodeDetails(e).getLength()}),0)}},getAvailableLimit:function(){var t=this.getCurrentLength();return this.getMaxLimit()-t},updateAvailableLimit:function(){var t=this.getAvailableLimit();$(this.data.max_limit_container).text(t).toggleClass("clr-R",0==t)},canPreventDefaultKeyDown:function(t){return!$Util.isCtrlorCmdKey(t)&&1==t.key.length&&this.getAvailableLimit()<=0},show:function(){$(this.data.max_limit_container).show()},hide:function(){$(this.data.max_limit_container).hide()}}}}},ComposerComponentController={init:function(){this.render(),this.setAllowedTriggers(),this.initFeatures()},lastEnterKeyTime:-1,allowedTriggers:[],currentTrigger:null,Util:ComposerComponentUtils,isDirty:!1,getHtml:function(){return this.element.innerHTML},getComposerContentAsFragment:function(){return this.Util.getComposerContentAsFragment(this.getDivEditorIdWithoutHash())},clear:function(){ComposerComponent.clear(this.composerId)},initFeatures:function(){var t=this.getParamsForFeatures();this.getFeatures().forEach((function(e){e.init(t)}))},hasSmileyFeature:function(){return"smileyFeature"in this},hasVoiceRecorderFeature:function(){return"voiceRecorderFeature"in this},hasMaxLimitFeature:function(){return"maxLimitFeature"in this},hasAtMentionFeature:function(){return"atMentionFeature"in this},hasGifFeature:function(){return"gifFeature"in this},hasAttachmentFeature:function(){return"attachmentFeature"in this},updateChatId:function(t){return this.chatId=t,this.handleChatIdUpdate(),this},updateWithNoChatId:function(t){return this.chatId=this.Util.constants.ONE_ONE_CHAT_ID_NOT_KNOWN,this.oneToOneChatparticipantId=t,this.handleChatIdUpdate(),this},getChatId:function(){return this.chatId},handleChatIdUpdate:function(){this.updateOneToOneChatparticipantId(),this.setAllowedTriggers();var t=this.getParamsForFeatures();this.getFeatures().forEach((function(e){e.updateData(t)})),this.reRender()},reRender:function(){var t=$(this.DC.editor).html();this.clearComposer(),this.updateComposerTypingLimit(),this.innerHtml(t),this.handleOnComposerContentChange()},updateOneToOneChatparticipantId:function(){this.chatId!=this.Util.constants.ONE_ONE_CHAT_ID_NOT_KNOWN&&(this.oneToOneChatparticipantId=null)},updateAdditionalSearchCriteria:function(t){this.params.additionalSearchCriteria=t||{},this.hasAtMentionFeature()&&this.atMentionFeature.updateData(this.getParamsForFeatures())},getParamsForFeatures:function(){return{composerId:this.composerId,parentElement:this.element,chatId:this.chatId,parentChatId:this.params.parentChatId,at_mentions_suggestion_container:this.DC.at_mentions_suggestion_container,at_mentions_list_container:this.DC.at_mentions_list_container,at_mentions_suggestion_list:this.DC.at_mentions_suggestion_list,smiley_icon:this.DC.smiley_icon,recorder_icon:this.DC.recorder_icon,smiley_suggestion_container:this.DC.smiley_suggestion_container,smiley_container:this.DC.smiley_container,max_limit_container:this.DC.max_limit_container,div_editor_id:this.DC.editor,maxLimit:this.params.maxLimit,allowMultipleMentions:this.params.allowMultipleMentions,oneToOneChatparticipantId:this.oneToOneChatparticipantId,additionalSearchCriteria:this.params.additionalSearchCriteria,attachmentOptions:{hasSnippet:!!this.params.attachmentOptions&&this.params.attachmentOptions.hasSnippet,hasWhiteBoard:!!this.params.attachmentOptions&&this.params.attachmentOptions.hasWhiteBoard,hasAttachCloud:!!this.params.attachmentOptions&&this.params.attachmentOptions.hasAttachCloud,hasUpload:!!this.params.attachmentOptions&&this.params.attachmentOptions.hasUpload}}},getFeatures:function(){var t=[];return this.hasSmileyFeature()&&t.push(this.smileyFeature),this.hasVoiceRecorderFeature()&&t.push(this.voiceRecorderFeature),this.hasMaxLimitFeature()&&t.push(this.maxLimitFeature),this.hasAtMentionFeature()&&t.push(this.atMentionFeature),this.hasAttachmentFeature()&&t.push(this.attachmentFeature),this.hasGifFeature()&&t.push(this.gifFeature),t},render:function(){var t={composerId:this.composerId,placeHolder:this.params.placeHolder||""},e=this.Util.templates.getDivEditor(t);$(this.element).find("[div-editor-container]").replaceWith(e)},afterRender:function(){return this.renderDefaultValue(),this.handleOnComposerContentChange(),this},renderDefaultValue:function(){var t=this.params.defaultValue;t&&(t=this.Util.isString(t)?this.Util.addSpaceIfNoSpaceExistsAtEnd(t):t,this.innerHtml(t))},handleOnComposerContentChange:function(){this.updateComposerDirty(),this.isDirty&&this.handleOnChangeCallBack()},updateComposerDirty:function(){var t=this.params.defaultValue||"";if(!this.isDirty&&!this.Util.isDocumentFragment(t)){var e=this.Util.removeZeroWidthSpace($(this.DC.editor).html()).trim(),i=(t=this.Util.removeZeroWidthSpace(t).trim())!=e;this.setDirty(i)}},setDirty:function(t){this.isDirty=t},setAllowedTriggers:function(){this.allowedTriggers=this.Util.getAllowedTriggers(this.chatId),this.params.parentChatId&&this.allowedTriggers.push("#")},updateCurrentTrigger:function(){this.currentTrigger=$WC.DivEditor.getSearchValueAndTrigger(this.allowedTriggers,this.getDivEditorIdWithoutHash()),this.currentTrigger.val.startsWith(" ")&&(this.currentTrigger.trigger="")},getCurrentTrigger:function(){return this.currentTrigger.trigger},getCurrentTriggerSearchValue:function(){return this.currentTrigger.val||"*"},isIgnorableKeyUpEvent:function(t){return t.which==$zcg.SHIFT_KEYCODE},handleUpArrowKeyDown:function(){if("function"==typeof this.params.upArrowPressCallBack&&!this.isAnySuggestionsOpen()&&this.isContentEmpty())return this.params.upArrowPressCallBack(),!0},onComposerKeyUp:function(t){if(!this.isIgnorableKeyUpEvent(t)){var e=!1;if(this.updateCurrentTrigger(),t.which==$zcg.ESCAPE_KEYCODE&&(e=this.handleEscape(t)),!e&&this.hasSmileyFeature()&&(e=this.handleSmiley(t)),!e&&this.hasAtMentionFeature()&&(e=this.handleAtMention(t)),!e&&t.which===$zcg.ENTER_KEYCODE&&this.isContentEmpty()){if(this.Util.isFunction(this.params.doubleEnterCallBack)&&this.isDoubleEnter())return void this.params.doubleEnterCallBack();this.setLastEnterKeyPressTime($Util.getSyncedCurrentTime())}this.updateComposerTypingLimit(),this.handleOnComposerContentChange()}},onComposerKeyDown:function(t){var e=!1,i=t.which;if(i!=$zcg.TAB_KEYCODE)return i===$zcg.ENTER_KEYCODE?(this.handleKeyDownEnter(t),t.preventDefault()):(i===$zcg.UP_KEYCODE&&(e=this.handleUpArrowKeyDown()),!e&&this.hasSmileyFeature()&&(e=this.smileyFeature.canPreventDefaultKeyDown(t)),!e&&this.hasAtMentionFeature()&&(e=this.atMentionFeature.canPreventDefaultKeyDown(t)),!e&&this.hasMaxLimitFeature()&&(e=this.maxLimitFeature.canPreventDefaultKeyDown(t)),e?t.preventDefault():void 0);t.preventDefault()},onComposerMouseDown:function(t){this.hideSmileySuggestions()},onComposerPaste:function(t){var e=(t.originalEvent||t).clipboardData;if(e&&e.items&&!e.getData("text/plain"))return this.onAttachmentPaste(e.items),t.preventDefault();var i=this.Util.getCopiedText(t).trim();return i=this.hasMaxLimitFeature()?$WC.$CUtil.processXSS(i):i,i=this.hasMaxLimitFeature()?this.getSplicedText(i):i,$WC.DivEditor.insertText(this.getDivEditorIdWithoutHash(),i),this.updateComposerTypingLimit(),this.handleOnComposerContentChange(),ZCScroll.scrollToCursor($(this.DC.editor)),t.preventDefault()},handleKeyDownEnter:function(t){if($Util.isCtrlorCmdKey(t))this.handleCmndEnterCallBack();else if(t.shiftKey)this.insertBreakNode(),ZCScroll.scrollToCursor($(this.DC.editor));else if(!this.isAnySuggestionsOpen()){if(this.hasEnterCallBack())return void(this.isContentNotEmpty()&&this.handleEnterCallBack());!this.params.restrictNewLineEnter&&this.insertBreakNode(),ZCScroll.scrollToCursor($(this.DC.editor))}},hasEnterCallBack:function(){return"function"==typeof this.params.enterCallBack},handleEnterCallBack:function(){this.params.enterCallBack()},onCodeSnippetClick:function(){"function"==typeof this.params.onCodeSnippetClick&&this.params.onCodeSnippetClick()},onWhiteBoardClick:function(){"function"==typeof this.params.onWhiteBoardClick&&this.params.onWhiteBoardClick()},onFileSelect:function(t,e){"function"==typeof this.params.onFileSelect&&this.params.onFileSelect(t,e)},onSendVoiceRecording:function(t,e,i){"function"==typeof this.params.onSendVoiceRecording&&this.params.onSendVoiceRecording(t,e,i)},onAttachmentPaste:function(t){"function"==typeof this.params.onAttachmentPaste&&this.params.onAttachmentPaste(t)},isAnySuggestionsOpen:function(){return!(!this.hasSmileyFeature()||!this.smileyFeature.isSmileySuggestionVisible())||!(!this.hasAtMentionFeature()||!this.atMentionFeature.isSuggestionsVisible())},insertBreakNode:function(){var t=document.createElement("br");this.insertNode(t,!1)},handleOnChangeCallBack:function(){this.isDirty,"function"==typeof this.params.onChange&&this.params.onChange()},clearComposer:function(){var t=$(this.DC.editor)[0],e=$WC.DivEditor;e.clear(t),e.cleanEditor(null,t)},handleEscape:function(t){var e=$(this.DC.editor)[0],i=$WC.DivEditor.removeBufferCharacters(e.innerHTML).length,n=this.hasSmileyFeature()&&this.smileyFeature.isSmileySuggestionVisible(),s=this.hasAtMentionFeature()&&this.atMentionFeature.isSuggestionsVisible();return n?(this.smileyFeature.emptyAndHideSuggestionContainer(),t.stopPropagation()):s?(this.atMentionFeature.emptyAndHideSuggestions(),t.stopPropagation()):i?(this.clearComposer(),t.stopPropagation()):this.params.onEscapePress&&(this.params.onEscapePress(t),t.stopPropagation()),!0},handleCmndEnterCallBack:function(t){var e=this.params.cmndEnterCallBack;return!!e&&(e(),!0)},hideSmileySuggestions:function(){this.hasSmileyFeature()&&this.smileyFeature.clearClickOutside()},handleSmiley:function(t){if(this.hasSmileyFeature()){var e=this.smileyFeature,i=!1,n=function(){if(e.isSmileySuggestionVisible()){var i=t.which,n=$Util.isArrowKey(i),s=i===$zcg.ENTER_KEYCODE||i===$zcg.TAB_KEYCODE;if(n)return e.handleSmileyNavigation(t),!0;if(s){var o=e.getSelectedSmileyNode();return this.insertSelectionInComposer(o,e.smileyTrigger,!0),e.emptyAndHideSuggestionContainer(),!0}}e.emptyAndHideSuggestionContainer()}.bind(this),s=function(){if(e.isSmileyTrigger(this.getCurrentTrigger()))return e.openSmileySuggestions(this.getCurrentTriggerSearchValue()),!0}.bind(this);return(i=n())||(i=s()),i}},onVoiceRecorderStart:function(t,e){this.voiceRecorderFeature.startVoiceRecording(t,e)},onOpenSmileyContainer:function(t){var e=this.smileyFeature;e.openSmileyContainer(t),e.emptyAndHideSuggestionContainer()},onSmileyClickFromPopUp:function(t){var e=this.smileyFeature,i=$(t.target),n=e.getSelectedSmileyNode(i);this.Util.initEditor(this.getDivEditorIdWithoutHash()),this.insertNodeInComposer(n),this.insertSpaceInComposer(),e.updateRecentSmiley(i),e.closeSmileyContainer(t),e.emptyAndHideSuggestionContainer()},onSmileyClickFromComposerSuggestion:function(t){var e=this.smileyFeature,i=$(t.currentTarget),n=e.getSelectedSmileyNode(i);this.insertSelectionInComposer(n,e.smileyTrigger,!0),e.emptyAndHideSuggestionContainer()},openAttachmentOptions:function(t){Clickoutside.bind({event:t,srcid:this.DC.attachment_icon.replace("#",""),destid:this.DC.attachment_options.replace("#","")})},handleAtMention:function(t){if(this.hasAtMentionFeature()){var e=this.atMentionFeature,i=!1,n=function(){if(e.isSuggestionsVisible()){var i=t.which,n=i===$zcg.UP_KEYCODE||i===$zcg.DOWN_KEYCODE,s=i===$zcg.ENTER_KEYCODE&&!t.shiftKey;if(n)return e.handleSuggestionNavigation(t),!0;if(s){var o=e.getSelectedUserNode();return this.insertSelectionInComposer(o,e.activeTrigger,!0),e.emptyAndHideSuggestions(),!0}}e.emptyAndHideSuggestions()}.bind(this),s=function(){var t=e.isUserMentionTrigger(this.getCurrentTrigger()),i=e.isChannelMentionTrigger(this.getCurrentTrigger());if(!t&&!i||"function"!=typeof this.params.hasAtMentionPermission||this.params.hasAtMentionPermission())return t?(e.setCurrentAtTriggerValue(this.getCurrentTrigger()),e.openUsersSuggestionPopUp(this.getCurrentTriggerSearchValue()),!0):i?(e.setCurrentAtTriggerValue(this.getCurrentTrigger()),e.openChannelsSuggestionPopUp(this.getCurrentTriggerSearchValue()),!0):void 0}.bind(this);return(i=n())||(i=s()),i}},onUserClickFromComposerSuggestion:function(t){var e=this.atMentionFeature,i=$(t.currentTarget)[0],n=e.getSelectedUserNode(i);this.insertSelectionInComposer(n,e.activeTrigger,!0),e.emptyAndHideSuggestions()},blur:function(){this.hasMaxLimitFeature()&&this.maxLimitFeature.hide()},focus:function(){var t=this.getDivEditorIdWithoutHash();this.Util.initEditor(t),$WC.DivEditor.focus(t),$(this.DC.editor)[0].scrollTop=$(this.DC.editor)[0].scrollHeight,this.maxLimitFeature&&this.maxLimitFeature.show()},innerHtml:function(t){var e={atMention:this.hasAtMentionFeature()&&this.Util.isAtMentionTriggerAllowed(this.chatId),htmlString:t,allMention:this.Util.isAllMentionAllowed(this.chatId),availableMention:this.Util.isAvailableMentionAllowed(this.chatId),channelMention:this.Util.isChannelMentionAllowed(this.chatId)};t=t instanceof DocumentFragment?t:this.Util.convertToComposerInsertableNodes(e);return t=this.getSplicedHtml(t),$(this.DC.editor).html(t).blur(),this.updateComposerTypingLimit(),this},getSplicedHtml:function(t){if(!this.hasMaxLimitFeature())return t;var e={htmlString:t,spliceLimit:this.maxLimitFeature.getAvailableLimit(),atMention:this.params.atMention};return this.Util.getSplicedHtml(e)},getSplicedText:function(t){return $(this.getSplicedHtml(t)).text()},getDivEditorIdWithoutHash:function(){return this.DC.editor.replace("#","")},adjustRange:function(){var t=this.getDivEditorIdWithoutHash(),e=$WC.DivEditor.editors[t],i=$(this.DC.editor)[0];if(!$WC.Util.isEmpty(e)){var n=e.currentRange.startContainer;!n||n.id!==t&&n.parentElement.id!==t?e.currentRange=!1:i.focus()}},isInvalidNodeToInsert:function(t,e){if(!(this.hasMaxLimitFeature()&&t instanceof Node))return!1;var i=0;return e&&(i=this.getGraceLength()),this.Util.getNodeDetails(t).getLength()>this.maxLimitFeature.getAvailableLimit()+i},getGraceLength:function(){var t=this.DC.editor.replace("#",""),e=$WC.DivEditor.editors[t].current_caret,i=e.dom_node.nodeValue,n=this.getCurrentTrigger(),s=i.lastIndexOf(" "+n)+1||i.lastIndexOf("\xa0"+n)+1||i.lastIndexOf("\u200b"+n)+1;return e.offset-s},insertSelectionInComposer:function(t,e,i){if(!this.isInvalidNodeToInsert(t,e)){var n=$(this.DC.editor)[0];$WC.DivEditor.insertSelection(n,e,t),i&&$WC.DivEditor.insertText(n.id," "),this.updateComposerTypingLimit(),this.handleOnComposerContentChange()}},insertNodeInComposer:function(t){this.adjustRange(),this.insertNode(t,!0),this.updateComposerTypingLimit(),this.handleOnComposerContentChange()},insertNode:function(t,e){if(!this.isInvalidNodeToInsert(t)){var i=$(this.DC.editor)[0],n=this.getDivEditorIdWithoutHash();$WC.DivEditor.insertObject(n,i,t)}},setLastEnterKeyPressTime:function(t){this.lastEnterKeyTime=t},isDoubleEnter:function(){return $Util.getSyncedCurrentTime()-this.lastEnterKeyTime<500},insertSpaceInComposer:function(){this.hasMaxLimitFeature()&&this.maxLimitFeature.getAvailableLimit()<=0||$WC.DivEditor.insertText(this.getDivEditorIdWithoutHash()," ")},getPlainText:function(){var t=this.getDivEditorIdWithoutHash();return Composer.getPlainTextFromComposer(t)},getMsgContent:function(){var t=$(this.DC.editor)[0];return this.Util.getMsgContent(t)},getMsgData:function(){var t=$(this.DC.editor)[0];return Composer.getMessageData(t,!0)},getSenderAndReplyToMsgUid:function(){return this.params.getSenderAndReplyToMsgUid&&this.params.getSenderAndReplyToMsgUid()},isComposerDirty:function(){return this.isDirty},isContentEmpty:function(){return 0==this.getPlainText().trim().length},isContentNotEmpty:function(){return!this.isContentEmpty()},clearContent:function(){$WC.DivEditor.clear($(this.DC.editor)[0])},updateComposerTypingLimit:function(){this.hasMaxLimitFeature()&&this.maxLimitFeature.updateAvailableLimit()}},ComposerComponent=function(){var t={},e=ComposerComponentUtils,i=function(e){var i=n(e),s=i.composerId;return t[s]=i,i},n=function(t){var i=s(),n=r(t);return e.mixin(i.prototype,n),new i(t)},s=function(){function t(t){this.composerId=e.generateUniqueId("composer-component-"),this.chatId=t.chatId,this.element=e.createAndGetElement(this.composerId,t.customClass,t.customAttributes),this.params=t,this.DC=e.getDomCache(this.composerId),this.init()}return t.prototype=o(),t},o=function(){return Object.assign({},ComposerComponentController)},r=function(t){var i=[],n=!!e.isUndefined(t.smileys)||t.smileys,s=!e.isUndefined(t.recorder)&&t.recorder,o=!e.isUndefined(t.gifs)&&t.gifs,r=!e.isUndefined(t.attachments)&&t.attachments,a=!e.isUndefined(t.maxLimit),c=!e.isUndefined([t.atMention,t.chatId])&&t.atMention;return n&&i.push(ComposerFeatures.getSmileyFeature()),s&&i.push(ComposerFeatures.getVoiceRecorderFeature()),o&&i.push(ComposerFeatures.getGifFeature()),r&&i.push(ComposerFeatures.getAttachmentFeature()),c&&i.push(ComposerFeatures.getAtMentionFeature()),a&&i.push(ComposerFeatures.getMaxLimitFeature()),i},a=function(e){if(e in t)return t[e]};return{getHtml:function(t){return i(t).getHtml()},getNewComposerInstance:i,clear:function(i){var n,s=a(i);if(s){var o=s.getDivEditorIdWithoutHash();!function(e){delete t[e]}(i),n=s.composerId,$(e.getDomCache(n).at_mentions_suggestion_container).remove(),function(t){var e=$WC.DivEditor.editors;t in e&&delete e[t]}(o)}},getComposerById:a,getAll:function(){return t}}}(),ComposerComponentEvents=function(){var t=ComposerComponentUtils,e=function(e){var i=t.getComposerInstanceByEvent(e);if(i){var n=i.getDivEditorIdWithoutHash();$WC.DivEditor._onKeyUp(n,e),i.onComposerKeyUp(e),$WC.DivEditor.cleanEditor(e,this)}},i=function(e){var i=t.getComposerInstanceByEvent(e);if(i){var n=i.getDivEditorIdWithoutHash();$WC.DivEditor._onKeyDown(n,e),i.onComposerKeyDown(e),$WC.DivEditor.cleanEditor(e,this)}},n=function(e){var i=t.getComposerInstanceByEvent(e);if(i){i.getDivEditorIdWithoutHash();i.onComposerMouseDown(e)}},s=function(e){var i=t.getComposerInstanceByEvent(e);if(i){var n=i.getDivEditorIdWithoutHash();$WC.DivEditor._onMouseUp(n,e,this),$WC.DivEditor.cleanEditor(e,this)}},o=function(e){var i=t.getComposerInstanceByEvent(e);i&&i.onComposerPaste(e)},r=function(e){var i=t.getComposerInstanceByEvent(e);i&&(i.blur(),$WC.DivEditor.cleanEditor(e,this))},a=function(e){var i=t.getComposerInstanceByEvent(e);i&&i.focus()},c=function(t){t.stopPropagation();var e=$(t.currentTarget).closest("[smiley-suggestion-container]").attr("data-composer-id");ComposerComponent.getComposerById(e).onSmileyClickFromComposerSuggestion(t)},l=function(t){t.stopPropagation();var e=$(t.target).closest("[user-suggestion-container]").attr("data-composer-id");ComposerComponent.getComposerById(e).onUserClickFromComposerSuggestion(t)},d=function(t){t.stopPropagation();var e=$(t.currentTarget).attr("data-composer-id");ComposerComponent.getComposerById(e).openAttachmentOptions(t)},h=function(t){var e=$(t.currentTarget),i=e.attr("purpose");if(i){var n=e.attr("data-composerid"),s=ComposerComponent.getComposerById(n);s&&("codesnippet"==i&&s.onCodeSnippetClick(),"whiteboard"==i&&s.onWhiteBoardClick())}},u=function(t){t.stopPropagation();var e=$(t.currentTarget).attr("id"),i=ComposerComponent.getComposerById(e);if(i){var n=t.target.files,s=t.target.parentNode.getAttribute("type");i.onFileSelect(n,s),setTimeout(()=>{t.target.value=""},200)}},m=function(e){var i=$(e.target),n=i.attr("data-action"),s=e.currentTarget.id,o="stickerConf"==i[0].getAttribute("data-purpose"),r=t.isSmileySelectFromPopUp(i[0]);if("openSmileyContainer"==n)return e.stopPropagation(),void ComposerComponent.getComposerById(s).onOpenSmileyContainer(e);if(o){$(this).closest("[thread-card]")[0]&&Smiley.threadStartStickerSend(i[0])}else{if("startVoiceRecorder"==n)return e.stopPropagation(),void ComposerComponent.getComposerById(s).onVoiceRecorderStart(i,e);if(r)return e.stopPropagation(),void ComposerComponent.getComposerById(s).onSmileyClickFromPopUp(e)}};return{init:function(){var t=$(document);t.on("keyup","[composer-component-editor]",e),t.on("keydown","[composer-component-editor]",i),t.on("mousedown","[composer-component-editor]",n),t.on("mouseup","[composer-component-editor]",s),t.on("blur","[composer-component-editor]",r),t.on("focus","[composer-component-editor]",a),t.on("paste","[composer-component-editor]",o),t.on("change","[composer-component]",u),t.on("click","[composer-component] [smiley-suggestion-container] [purpose='search']",c),t.on("click","[composer-component] [attachment-options-container]",d),t.on("click","[composer-component] [attachment-option]",h),t.on("click","[user-suggestion-container] [purpose='search']",l),t.on("click","[composer-component]",m)}}}();ComposerComponentEvents.init();