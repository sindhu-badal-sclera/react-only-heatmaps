var ScheduleMessageUtils={CONSTANTS:{max_limit:25,DUMMY_CHATID:"dummy_chid",AT:"at",MINIMUM_TIMESTAMP:1},statusMap:{check_in:1,check_out:2,user_available:3,call_end:4},setPromptSnoozeTime:function(e){this.promptSnoozeTime=e},getPromptSnoozeTime:function(){return this.promptSnoozeTime||(this.promptSnoozeTime=localStorage.getItem("snoozePrompt"))},mockScheduleMessageObjAsNormalMessageObj:function(e){if(0!=(e=e||[]).length){var t=this;return e.map((function(e){return e=e.data||e,t.isTextMessage(e)?t.mockScheduleTextMsgAsNormalTextMsg(e):t.isAttachmentMessage(e)?t.mockScheduleAttMsgAsNormalAttMsg(e):void 0}))}},isTextMessage:function(e){return e.message.mtype==$zcg.TEXT_MTYPE||"string"==typeof e.message.message},isAttachmentMessage:function(e){return e.message.mtype==$zcg.ATTACHMENT_MTYPE},mockScheduleTextMsgAsNormalTextMsg:function(e){var t={isScheduledMsg:!0,id:e.id+"",lmsgtime:"0",createdTime:e.created_time,msguid:e.id,time:e.time+"",scheduleTimezone:e.timezone?e.timezone:""};return e.schedule_status&&(t.schedule_status=e.schedule_status,t.time=ScheduleMessageUtils.getMinimumTimeStamp(e.schedule_status)),t=$.extend({},e.message,t)},mockScheduleAttMsgAsNormalAttMsg:function(e){var t={isScheduledMsg:!0,mode:"att",lmsgtime:"0",msguid:e.id,mtype:$zcg.ATTACHMENT_MTYPE,isSchMsg:!0,createdTime:e.created_time,id:e.id+"",time:e.time,dname:e.dname||WmsImpl.getNickName(),scheduleTimezone:e.timezone?e.timezone:""};return e.schedule_status&&(t.schedule_status=e.schedule_status,t.time=ScheduleMessageUtils.getMinimumTimeStamp(e.schedule_status)),t=$.extend({},e.message,t)},getSelectedHourAndMinute:function(e,t,s){if(s){var i,n=(S=$(e.target)).attr("set_time_button"),a=$(document.activeElement);void 0!==a.attr("time_format")?i=a:void 0===i&&(i=t.find('[time_format="hours"]'));var o=parseInt(i.val());return isNaN(o)?(i.addClass("error"),{isInvalidCustomTime:!0}):(o=DateTimeWidget.prototype._time._verifyRangeAndGetValue(i.attr("time_format"),o,"plusone"===n),i.val(o),i.closest(".error").removeClass("error"),i.select(),e.preventDefault(),(C="hours"==i.attr("time_format"))?{hours:o}:{mins:o})}var d=e.which,c=d>=48&&d<=57||d>=96&&d<=105,l=d===$zcg.UP_KEYCODE||d===$zcg.DOWN_KEYCODE,h=l||d===$zcg.LEFT_KEYCODE||d===$zcg.RIGHT_KEYCODE,r=d===$zcg.LEFT_KEYCODE||d===$zcg.RIGHT_KEYCODE,u=d===$zcg.BACKSPACE_KEYCODE||46===d,g=(e.metaKey||e.ctrlKey)&&65==e.keyCode,m=d==$zcg.TAB_KEYCODE||e.shiftKey&&d==$zcg.TAB_KEYCODE,p=c||h||u||g||m;if((!p||l||r)&&e.preventDefault(),p){var S,M=(S=$(e.target)).attr("time_format"),C="hours"==M;if("keydown"===e.type){if(o=parseInt(S.val()),l&&!isNaN(o))return o=DateTimeWidget.prototype._time._verifyRangeAndGetValue(M,o,d===$zcg.UP_KEYCODE),S.val(o),S.select(),S.closest(".error").removeClass("error"),C?{hours:o}:{mins:o};if(r){var T=S.attr("time_format");"hours"===T&&t.find("[time_format='mins']").select(),"mins"===T&&t.find("[time_format='hours']").select()}}else if("keyup"===e.type){if(!(o=S.val()))return S.addClass("error"),{isInvalidCustomTime:!0};if(c||u){var f=DateTimeWidget.prototype._time._getRange(M);return o<f[0]||o>f[1]?(S.addClass("error"),{isInvalidCustomTime:!0}):(S.closest(".error").removeClass("error"),C?{hours:o}:{mins:o})}}}},$getScheduledMessageSelectionPopUpUIContainer:function(){return this.$scheduleMsgPopUp||(this.$scheduleMsgPopUp=$("#schedule-msg-popup-container"))},isValidTimeStamp:function(e){var t=e.scheduleMsgPopUpState,s=t.state.timezone,i=t.scheduleOptions[t.state.selectedSchedulingOption].getTimeStamp(),n=EventsMain.UTIL.getTimestampForGivenTimezone(i,s);return!(EventsMain.UTIL.getTimestampForGivenTimezone((new Date).getTime(),s)>n)},getPopUpDataBasedOnType:function(e){return{DELETEALL:{imgHTML:'<div class="zcl-img xl flexM mAuto zcf-delete2 zcl-img--neg"></div>',header:()=>Resource.getRealValue("schmsg.header.deleteall"),subheader:()=>"",btnText:e=>Resource.getRealValue("schmsg.deleteall",[e])},DELETE:{imgHTML:'<div class="zcl-img xl flexM mAuto zcf-delete2 zcl-img--neg"></div>',header:()=>Resource.getRealValue("schmsg.header.delete"),subheader:()=>"",btnText:()=>Resource.getRealValue("message.option.delete")}}[e]},renderConfirmDialog:function(e){var t=e.type,s=e.scheduledMsgCount,i=e.recipientZuid,n=i&&Contacts.getDisplayName(i)||"",a=this.getPopUpDataBasedOnType(t);return new Promise((function(e,t){$WC.$Dlg.create({id:"scheduledeletemsg",version:3,class:"zcl-alert-dialog-2 zcldel-dialog-box zc-sched-dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:Resource.getRealValue(a.imgHTML),header:a.header(s,n),subheader:[a.subheader(n)]}),bodyhtml:"",buttons:[{text:Resource.getRealValue("common.cancel"),colour:$zcg._cssClasses.SECONDARY_BTN,action:()=>$WC.$Dlg.destroy("scheduledeletemsg")},{text:a.btnText(s),colour:$zcg._cssClasses.NEG_PRIMARY_BTN,action:()=>e()}]})}))},showScheduleOptionAsDropDown:function(e){var t=e.soruceEle,s=e.destinationEle,i=e.event,n=e.parentElement,a=e.callBack;Clickoutside.bind({srcid:t,destid:s,event:i,closeOnClickSrc:!0,callback:function(){a&&a()},customShow:function(e){n.find("#"+e.srcid).addClass("active"),n.find("#"+e.destid).removeClass("hide")},customHide:function(e){n.find("#"+e.srcid).removeClass("active"),n.find("#"+e.destid).addClass("hide")}})},showScheduleMsgMaxThresholdWarningDialog:function(){$WC.$Dlg.create({id:"schedulemaxthresholdwarning",version:3,class:"zcl-alert-dialog-2 zcldel-dialog-box zc-sched-dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="zcl-img flexM mAuto zcf-schedule zcl-img--neg"></div>',header:Resource.getRealValue("schmsg.limit.header",[ScheduleMessageUtils.CONSTANTS.max_limit]),subheader:""}),bodyhtml:"",buttons:[{text:Resource.getRealValue("common.cancel"),colour:$zcg._cssClasses.SECONDARY_BTN,action:()=>$WC.$Dlg.destroy("schedulemaxthresholdwarning")}]})},openScheduleMsgPopUp:function(e){var t=ChatUI.getWin(e.chatID),s=e.triggerElement;if(t){var i=t.getScheduleMessageController();i&&(i.setScheduleMsgPopUpTriggeringEle(s),i.onScheduleMessageIconClick(e.renderProps))}},updateCurrentValues:function(e){ScheduleMessageUtils.previousPopUpTriggeringElemenetid=e.id,ScheduleMessageUtils.previousChatId=e.chatID},clearCurrentValues:function(){ScheduleMessageUtils.previousPopUpTriggeringElemenetid=null,ScheduleMessageUtils.previousChatId=null},isScheduleMsgPopUpAlreadyHandledOnTheEle:function(e){return ScheduleMessageUtils.previousPopUpTriggeringElemenetid==e.id&&ScheduleMessageUtils.previousChatId==e.chatID&&(Clickoutside.handleClickOnChild(e.event),ScheduleMessageUtils.clearCurrentValues(),!0)},handleFileUploadSuccess:function(e,t){var s=ChatUI.getWin(e);s&&s.getScheduleMessageController().scheduleMessageSuccessCb(t[0])},handleFileEditSuccess:function(e,t){var s=ChatUI.getWin(e);s&&s.getScheduleMessageController().onEditScheduleMsgSuccessCb(t)},handleScheduleMsgInSlashCmd:function(e,t){var s=ChatUI.getWin(e);if(s&&s.hasScheduleMessageController()){var i=s.getScheduleMessageController();i.hasMessageStorage()||i.initScheduleMessageStorage(),s.getScheduleMessageController().scheduleMessageSuccessCb(t)}},isCustomOptionSelected:function(e){return void 0!==this.statusMap[e]},getScheduleTimeOrScheduleStatus:function(e){return ScheduleMessageUtils.isCustomOptionSelected(e.scheduledTimeStamp)?{schedule_status:e.scheduledTimeStamp}:{schedule_time:e.scheduledTimeStamp}},getRecipientStatusMap:function(e,t){if(t){var s=ConversationsList.get121RecipientIdFromChatId(t),i=Users.getName(s);if(i)return{check_in:Resource.getRealValue("schmsg.user.checkout",[i]),user_available:Resource.getRealValue("schmsg.user.dnd",[i]),call_end:Resource.getRealValue("schmsg.user.onacallormeeting",[i]),check_out:Resource.getRealValue("schmsg.user.checkin",[i])}[e]}},getMinimumTimeStamp:function(e){var t=new Date(ScheduleMessageUtils.CONSTANTS.MINIMUM_TIMESTAMP);return t.setFullYear({check_in:2e3,check_out:1990,user_available:1980,call_end:1970}[e]),t.getTime()},isReplyMessage:function(e){return e.replyTo},isReplyPrivateMessage:function(e){return e.replyFrom},isWDPickerMessage:function(e){return e.workdrive_data},showScheduleMsgMaxWarningBanner:function(){UI.updateBanner(Resource.getRealValue("schmsg.warning",[ScheduleMessageUtils.CONSTANTS.max_limit]),2e3,!1,!0)},dummyCwinObj:null,getDummyCwinObj:function(){return this.dummyCwinObj||(this.dummyCwinObj=new $Cwin(this.CONSTANTS.DUMMY_CHATID))},openScheduleMsgInfoPopUp:function(e){var t=e.chid,s=e.msguid,i=ChatUI.getWin(t);if(Config.isScheduleMessageEnabled()&&i&&i.hasScheduleMessageController()&&i.getScheduledMsgCwin().hasMessage(s)){var n=i.getScheduledMsgCwin().getMessage(s),a=MessagePreview.getPreviewLayout(n.msgobj,"",!0),o={id:"schedulemsginfopopup",version:3,headerhtml:this.getScheduleInfoPopUpHeaderHTML(a,n.msgobj),bodyhtml:this.getScheduleInfoPopUpBodyHTML(n,i),class:"zcl-alert-dialog-2 zcldel-dialog-box del-usr-msg-alert-dialog zcscheduleinfopopup"};$WC.$Dlg.create(o)}},getScheduleInfoPopUpHeaderHTML:function(e,t){var s=$WC.template.replace(ScheduleMessageTemplates.infoHeader,{chatTitle:ConversationsList.getTitle(t.chid)});return $WC.template.replace(s,{html:e},"InSecureHTML")},getScheduleInfoPopUpBodyHTML:function(e){var t,s=e.getScheduleTime(),i=e.msgobj,n=i.createdTime||Date.now(),a=$Date.getMonthString(n)+" "+$Date.getDateString(n)+", "+new Date(n).getFullYear()+" "+$Date.time(n);return t=this.isCustomOptionSelected(s)?ScheduleMessageUtils.getRecipientStatusMap(s,i.chid):$Date.day(s,{shorten:!0})+" "+ScheduleMessageUtils.CONSTANTS.AT+" "+$Date.time(s,{shorten:!0}),$WC.template.replace(ScheduleMessageTemplates.infoBody,{createdTime:I18N("schmsg.scheduled.on",[`<span class="fontB zcschedinfoheader">${a}</span>`]),scheduledTime:I18N("schmsg.scheduled.for",[`<span class="fontB zcschedinfoheader">${t}</span>`])},"InSecureHTML")},getConvertedTimeStampBasedOnTimezone:function(e,t){var s=(Users.getInfo($zcg._ZUID)||{}).timezone;if(!s)return t;var i=new Date(t),n=Timezones.getTimezoneOffset(s),a=Timezones.getTimezoneOffset(e);if(Timezones.hasTimeZoneMap()&&n&&a){var o=i.toString(),d=Date.parse(`${o} UTC`)-Date.parse(`${o} ${a}`);return t+(Date.parse(`${o} UTC`)-Date.parse(`${o} ${n}`)-d)}return t},scrollToScheduleMsg:function(e){var t=e.chid,s=ChatUI.getWin(t);s&&(s.hasScheduleMessageController()&&(s.getScheduleMessageController().hasMessageStorage()||s.getScheduleMessageController().initScheduleMessageStorage(),s.getScheduledMsgCwin().findAndScrollToMsg(e)))},isSameStatus:function(e,t){return!(!e.schedule_status||!t.schedule_status)&&e.schedule_status==t.schedule_status},getTopBarEle:function(){return this.$topBarEle||(this.$topBarEle=$("#ztb-menu-container"))},hasPostInParent:function(e){return e.postInParent||e.post_in_parent},hasFiles:function(e){return e.files},canPostMsgInParentChat:function(e,t,s){var i=ChatUI.getWin(e);return!(!i||!i.isThreadChat())&&(s?i.canPostInParent():t.post_in_parent)},handleScheduleMsgInTopBar:function(){var e=$("#ztb-menu-container").find("#ztb-topBarScheduleMsgIcon");ScheduleMessageApis.fetchAllScheduledMessages({}).then(t=>{t.data.length>0?(e.removeClass("dN"),e.find(".zcf-schedule").removeClass("dN")):e.addClass("dN")}).catch(t=>{e.addClass("dN")})},handlePromptOnUserMention:function(e){var t=ChatUI.getWin(e);(t&&t.getMentionedUsers()).forEach(t=>{this.handleStatusChange(e,t)})},handleSchedulePromptOnUserStatusChange:function(e){Object.keys(ChatUI.exist).forEach(t=>this.handleStatusChange(t,e))},handleStatusChange:function(e,t){if(ConversationsList.isOnetoOneChat(e)&&!ConversationsList.get(e).isGuestChat&&Participants.get(e).isParticipantExist(t)){var s=ChatUI.getWin(e),i=s&&s.hasScheduleMessageController()&&s.getScheduleMessageController();i&&i.handleStatusChange(t)}},createScheduleMsgPromptForUploadUI:function(e){var{chid:t,$element:s,destroyPromptCB:i}=e,n=ChatUI.getWin(t);if(ConversationsList.isOnetoOneChat(t)&&!ConversationsList.get(t).isGuestChat){var a=n&&n.hasScheduleMessageController()&&n.getScheduleMessageController();if(a){var o=a.getScheduleMsgPrompt();if(!ScheduleMessageUtils.hasValidPrompt(t))return;var d={destroyPromptCB:i},c=o.updateProps(d).getPromptHTML(),l=s.find('[data-view="schedulemsgprompt"]');l.removeClass("dN").html(c),o.bindEvents(l)}}},getOpenedFileUploadModal:function(){var e,t={fileupload:()=>FileUploadUI};return Object.keys(t).forEach(s=>{var i=t[s]();i.isExist&&(e=i)}),e},getScheduleMsgPromptHTML:function(e){if(e&&Config.isScheduleMessagePromptEnabled()&&ScheduleMessageUtils.hasValidPrompt(e)){var t=ChatUI.getWin(e);return(t&&t.hasScheduleMessageController()&&t.getScheduleMessageController().getScheduleMsgPrompt()).getPromptHTML()}},hasValidPrompt:function(e){if(!e||!Config.isScheduleMessagePromptEnabled())return!1;var t=ChatUI.getWin(e),s=t&&t.hasScheduleMessageController()&&t.getScheduleMessageController();if(s){var i=s.getScheduleMsgPrompt();return!i.hasSnoozed()&&i.hasValidPrompt()}},hideScheduleMsgPrompt:function(e){var t=ChatUI.getWin(e);if(t&&t.hasScheduleMessageController()){var s=t.getScheduleMessageController().getScheduleMsgPrompt();s&&s.toggleScheduleMsgPrompt(!1)}}},ScheduleMessageTemplates={scheduledChatWindow:{outerContainer:'<div class="schedule-msg-component-container"></div>',container:`<div class="zcsched-msg-cont in-view">\n            <div class="zcsched-msg-hdr flexC pLR10 curP" data-action="expandOrCollapseSchWindow">\n                <div class="flexG font13 fontB" data-action="expandOrCollapseSchWindow">${I18N("schmsg.title")} <span class="zc-schmsg-count {{alertclass}}" data-action="expandOrCollapseSchWindow">(<span id="sch-msg-count" data-action="expandOrCollapseSchWindow">{{sch_msg_count}}</span>/${ScheduleMessageUtils.CONSTANTS.max_limit})</span>\n                </div>\n                <div class="fshrink flexC hide-on-empty ">\n                    <span class="zcl-icon-sm zcl-icon--default zcf-send clr-theme hide-in-collapse" data-action="sendAllScheduledMessages" title="${I18N("chat.sendall")}"></span>\n                    <span class="zcl-dropdown-divider mLR10 hide-in-collapse"></span>\n                    <span class="zcl-icon-sm zcl-icon--default zcl-icon--neg clr-R zcf-delete2 hide-in-collapse" data-action="deleteAllScheduledMessages" title="${I18N("chat.deleteall")}"></span>\n                    <span class="zcl-dropdown-divider mLR10 hide-in-collapse"></span>\n                    <span class="zcf-slide-down clr-icon font12 cur hide-in-collapse" data-action="expandOrCollapseSchWindow"></span>\n                    <span class="zcf-upArrow font10 mR4 hide-in-expand" data-action="expandOrCollapseSchWindow"></span>\n                </div>\n            </div>\n            <div id="zcsched-msg-main" class="zcsched-msg-main pB15">\n                <div id="chatbody" class="currchatpanel" zcsched-chat-body>\n                    <div id="msgarea">\n                    </div>\n                </div>\n                <div id="zcsched-msg-info" class="flexM font11 fontI zcsched-msg-info mB10 dN">\n                    <span class="clr-lp1"><span id="scheduling-time"></span></span>\n                    <span class="zcl-dot mLR5"></span><span class="zcl-btn-neg--link font11"  data-action="cancelScheduling">${I18N("common.cancel")}</span>\n                </div>\n            </div>\n        </div>`,date:'<div class="zcsched-msg-time flexM mTB10" msguid="{{msguid}}" msgtime="{{time}}"  zcsched-msg-time><span class="font15 clr-lp1 pLR20" purpose="date"  msguid="{{msguid}}" msgtime="{{time}}">{{scheduled_date}}</span>\n        </div>',scheduleInfo:'<div class="flexM font11 fontI zcsched-msg-info mB10"><span class="clr-lp1">Scheduling message for <span class="clr-S">Sun Dec 25, 2021</span> at <span class="clr-S">12:01 AM</span></span><span class="zcl-dot mLR5"></span><span class="zcl-btn-neg--link font11">Cancel</span></div>'},schedulemessagepopupui:{container:"<div id='schedulepopupmsgselection{{chatid}}'><div>",content:"<span class='zcl-close sm zcf-closeB zcl-popup-close mT2' data-action='destroyView'></span><header class='zcl-pop_header flexC'><div class=''><div class='font16 fontB'>{{popUpTitle}}</div></div><div class='flexG textR font11' data-action='showRecipientTimeZone' data-purpose='schedtimezone'><span class='zcl-btn-secondary--link font11 header_rec_timezone'>{{timeZone}}</span></div></header><section class='zcl-popup_section'>{{option_html}}</section><section class='schdeulemsgdatesection zc-calendarsec zcl-popup_section dN'>{{calendarDateTimeHTML}}</section><section class='reschdeulemsgpopupsection zcl-popup_section {{showRescheduleCheckBox}}'>{{rescheduleCheckBoxHTML}}</section><footer class='flexC zcl-popup_footer justifyE'><div class='zcl-btn-xs zcl-btn--secondary mL30' data-action='destroyView'>"+I18N("common.cancel")+"</div>{{footerBtnHTML}}</footer>",rescheduleCheckBoxHTML:"<div class='pB5'><label for='allreschedulemsg' class='flexIC curP'><div class='zcl-checkbox'><input id='allreschedulemsg' category='general' type='checkbox' data-action='onSelectRescheduleChange' {{checked}} /><span class='zcf-tick flexM'></span></div><div class='font13'><span class='zc-reschedTime'>{{formattedRescheduledTime}}</span></div></label></div>",scheduleBtn:"<div class='zcl-btn-xs zcl-btn--primary sched-msg-done-btn' data-action='onScheduleBtnClick'>"+I18N("schmsg.schedule")+"</div>",rescheduleBtn:"<div class='zcl-btn-xs zcl-btn--primary sched-msg-done-btn' data-action='onRescheduleBtnClick'>"+I18N("schmsg.update")+"</div>",calendarDateTimeHTML:"<div class='flexC'><div class='flexC' purpose='timeinput'><div class='zcl-dropdown-input' id='schedcalendar{{chatid}}' purpose='openDateTimeCalendar' data-action='showCalendar' data-view='schedule-msg-calendar' style='margin-right: 10px;'><span class='zcl-dropdown-label font14 ellips' schedule-msg-date=''>{{currentDate}}</span><em class='zcl-dropdown-icon zcl-dropdown-divider zcf-datepicker mL5 font14'></em></div><div class='date-picker-wrp posabs' id='calendar{{chatid}}' purpose='openDateTimeCalendar' data-action='showCalendar'><div id='schedulemessagecalendar{{chatid}}' class='data-picker-wrap'></div></div><div class='tp-item flexC set-time-bgc'><div class='flexG pLR5 line1'><input class='tp-input' time_format='hours' data-time='hours' value='{{hours}}' maxlength='2'><span class='timeseparate'>:</span><input class='tp-input' time_format='mins' data-time='mins' value='{{mins}}' maxlength='2'></div><div class='fshrink tp-incr-cont'><span set_time_button='plusone' purpose='setTime' class='zcf-upArrow tp-incr-icon flexM'></span><span set_time_button='minusone' purpose='setTime' class='zcf-downArrow tp-incr-icon flexM'></span></div></div><div time_input='ampm' class='tp-item flexC mL12 set-time-bgc' ampm='am'><span data-action='onMeridienChange' data-meridien='am' purpose='setAmPm' class='tp-ampm flexM {{amSelectedClass}}'>AM</span><span data-action='onMeridienChange' data-meridien='pm' purpose='setAmPm' class='tp-ampm flexM {{pmSelectedClass}}'>PM</span></div></div>",option:'<div class="zcsched-msg-option mT20 {{showClass}}"><label for="{{id}}" class="zcl-radio mR20"><input id="{{id}}" name="schedulemsgdate" data-selectedOptionId="{{selectedOptionId}}" type="radio" value="{{key}}" {{checked}} class="dN" data-action="onScheduleOptionChange"><span class="radio-btn-marked mR6"></span><div class="ellips whitespaceN wdbreak line18 clr-M sched-msg-status">{{displayName}}</div></label></div>',skeletonLoader:"<span class='zcl-close sm zcf-closeB zcl-popup-close mT2' data-action='destroyView'></span><header class='zcl-pop_header flexC'><div class=''><div class='font16 fontB'>{{popUpTitle}}</div></div><div class='flexG textR font11'></div></header><section class='zcl-popup_section'><div class='flex-col fshrink'><div class='skelton-loader skelton-color m10'></div><div class='skelton-loader skelton-color m10'></div><div class='skelton-loader skelton-color m10'></div><div class='skelton-loader skelton-color m10'></div><div class='skelton-loader skelton-color m10'></div></div></section>"},schedule_icon:'<em class="type-icon schedule-type-icon flexM zcf-schedule pT2"></em>',infoBody:'<div class="p5"><div class="mB10 zcl-clr-secondary">{{createdTime}}</div><div class="mT10 zcl-clr-secondary">{{scheduledTime}}</div></div>',infoHeader:'<div><div class="w90 justifySB flexC pTB10"><div class="font17 fontB zcl-clr-secondary ellips"><span>'+I18N("schmsg.scheduled.info")+' - </span><span class="zcschedinfoheader">{{chatTitle}}</span></div></div><blockquote class="quotedmsgdiv reply-dt msgactdiv textL zcschedinfomsgcont mT10">{{html}}</blockquote></div>'},ScheduleMessageList=function(){MessageList.apply(this,arguments),this.nextToken="",this.overrideTopMoreLogic()};ScheduleMessageList.prototype=Object.create(MessageList.prototype),ScheduleMessageList.prototype.constructor=ScheduleMessageList,ScheduleMessageList.prototype.super=MessageStorage.prototype,ScheduleMessageList.prototype.isScheduledMessageList=!0,ScheduleMessageList.prototype.setNextToken=function(e){this.nextToken=e},ScheduleMessageList.prototype.getNextToken=function(){return this.nextToken},ScheduleMessageList.prototype.hasNextToken=function(){return Boolean(this.getNextToken())},ScheduleMessageList.prototype.overrideTopMoreLogic=function(){Object.defineProperty(this,"topMore",{get:function(){return this.isEmpty()||this.hasNextToken()}})};var ScheduleMessageStorage=function(e){MessageStorage.call(this,e),this.nextToken=""};ScheduleMessageStorage.prototype=Object.create(MessageStorage.prototype),ScheduleMessageStorage.prototype.constructor=ScheduleMessageStorage,ScheduleMessageStorage.prototype.super=MessageStorage.prototype,ScheduleMessageStorage.prototype.getNewMessageList=function(e){return void 0===e?new ScheduleMessageList:new ScheduleMessageList(e,this.getChid())},ScheduleMessageStorage.prototype.isListEmpty=function(){return this.getList().isEmpty()},ScheduleMessageStorage.prototype.getTopMessageFetchPromise=function(e,t){return ScheduleMessageApis.fetchScheduledMessages({chatId:this.getChid(),nextToken:this.getList().getNextToken()}).then(e=>this.onTranscriptFetchSuccess(e,t),()=>this.onTranscriptFetchFailure(resp,t))},ScheduleMessageStorage.prototype.deleteMessage=function(e){if(this.getList().hasMessage(e)){var t=this.getList().getMessage(e),s=t.getNextVisible();s=s&&this.getList().hasMessage(s.getMsguid())?s:null;var i=t.getPreviousVisible();i=i&&this.getList().hasMessage(i.getMsguid())?i:null;var n=s?s.getTime():0,a=i?i.getTime():0;this.publishEvent("clearScheduleMessage",t);var o=!!n&&$Date.isSameDay(t.getTime(),n),d=!!a&&$Date.isSameDay(t.getTime(),a);o||d?$Date.isSameDay(t.getTime(),a)||this.publishEvent("constructSenderHtml",s):this.publishEvent("removeScheduledMsgDate",t.getScheduleTime()),this.getList().remove(t,!0)}},ScheduleMessageStorage.prototype.onTranscriptFetchSuccess=function(e,t){if(e&&e.data&&0!=e.data.length){var s=e.data;s=ScheduleMessageUtils.mockScheduleMessageObjAsNormalMessageObj(s),this.getList().setNextToken(e.next_token),this.handleFetch(s,t)}},ScheduleMessageStorage.prototype.onTranscriptFetchFailure=function(e,t){this.handleFetchError(t)},ScheduleMessageStorage.prototype.canAppendMessage=function(e,t){return!t||(e.getTime()<=t.getTime()||$Date.isSameDay(e.getTime(),t.getTime())||e.getScheduleTime()==t.getScheduleTime())},ScheduleMessageStorage.prototype.canPrependMessage=function(e,t){return!t||t.getTime()<e.getTime()&&!$Date.isSameDay(e.getTime(),t.getTime())},ScheduleMessageStorage.prototype.editMessage=function(e){if(e.isScheduledMessage())return this.super.editMessage.apply(this,arguments)},ScheduleMessageStorage.prototype.addNewMessage=function(e){if(e.isScheduledMessage())return this.super.addNewMessage.apply(this,arguments)},ScheduleMessageStorage.prototype.insertMessageInBetween=function(e){for(var t=this.getList(),s=new Iterator(t);s.hasNext();){var i=s.next();if(i.getTime()<e.getTime())return t.insertBeforeMessage(i,e),this.preProcessMessageList(),void this.publishEvent("insertInBetween",e)}},ScheduleMessageStorage.prototype.scrollToMsg=function(e){this.publishEvent("scrollToMsg",e)},ScheduleMessageStorage.prototype.resendMessage=function(e){var t={message:e.getObject().msg,currTime:e.getMsguid(),scheduledTimeStamp:e.getTime()};ChatUI.getWin(this.getChid()).getScheduleMessageController().scheduleTextMessage(t)},ScheduleMessageStorage.prototype.fetchInBetween=function(){},ScheduleMessageStorage.prototype.preProcessMessageList=function(){this.sortMessageList()},ScheduleMessageStorage.prototype.sortMessageList=function(){var e=this.getList(),t=this.mergeSort(e.head);e.head=t;for(var s=e.head;null!==s.next;)s=s.next;e.tail=s},ScheduleMessageStorage.prototype.mergeSort=function(e){if(null==e||null==e.next)return e;var t=this.splitTheMsgListInToTwoEqualHalf(e);return this.merge(this.mergeSort(e),this.mergeSort(t))},ScheduleMessageStorage.prototype.splitTheMsgListInToTwoEqualHalf=function(e){for(var t,s=e,i=e;null!=s.next&&null!=s.next.next;)s=s.next.next,i=i.next;return t=i.next,i.next=null,t},ScheduleMessageStorage.prototype.merge=function(e,t){return null==e?t:null==t?e:parseInt(e.msgobj.time)>parseInt(t.msgobj.time)||e.msgobj.schedule_status==t.msgobj.schedule_status?(e.next=this.merge(e.next,t),e.next.prev=e,e.prev=null,e):(t.next=this.merge(e,t.next),t.next.prev=t,t.prev=null,t)};var ScheduleMessageView=function(e,t,s){MessageView.call(this,e,t,s)};ScheduleMessageView.prototype=Object.create(MessageView.prototype),ScheduleMessageView.prototype.constructor=ScheduleMessageView,ScheduleMessageView.prototype.super=MessageView.prototype,ScheduleMessageView.prototype.initPermission=function(){var e={star:!1,messageOperations:!0,reply:!1,reaction:!1,avoidReaction:!0,addReaction:!1,avoidNewMessageDom:!0,moreOptions:!1,readReceipt:!1,rescheduleMessage:!0,editScheduleMessage:!0,deleteScheduleMessage:!0,sendScheduleMessage:!0};this.permissions=e},ScheduleMessageView.prototype.showDateHint=function(){},ScheduleMessageView.prototype.addSendingStatus=function(){},ScheduleMessageView.prototype.clearScheduleMessage=function(e){var t=this.getMessageDom(e),s=this.getSender(e.getMsguid());t.remove(),s.remove()},ScheduleMessageView.prototype.removeScheduledMsgDate=function(e){this.view.find(`[zcsched-msg-time][msgtime="${e}"]`+this.getIgnorableMsgSelector()).remove()},ScheduleMessageView.prototype.scrollToMsg=function(e){this.super.scrolltoMsg.call(this,e)},ScheduleMessageView.prototype.constructSenderHtml=function(e){var t=MsgTemplate.getSenderField(e.msgobj,{});this.getMessage(e.getMsguid()).before(t)},ScheduleMessageView.prototype.disableHoverByMsgUid=function(e){this.getMessage(e).addClass("curN")},ScheduleMessageView.prototype.enableHoverByMsgUid=function(e){this.getMessage(e).removeClass("curN")},ScheduleMessageView.prototype.handleViewReply=function(e){var t=e.chid?e.chid:e.$element[0].getAttribute("data-chatid");if(t){var s=ChatUI.getWin(t);s&&s.getScheduleMessageController().onSchCwinCollapse(),e.chid=t||e.chid}this.super.handleViewReply.call(this,e)};var ScheduleMessageSelectionPopUpUi=function(e){this.chatID=e.chatId,this.params=e,this.state={selectedSchedulingOption:"tomorrow",customDate:Date.now(),customHours:"",customMins:"",customMeridien:"",timezone:"",rendered:!1,isInvalidCustomTime:!1},this.userDetailsFetchPromise=null,this.$el=$(this.getContainer())};ScheduleMessageSelectionPopUpUi.prototype={CONSTANTS:{PM:"pm",AM:"am",CUSTOM_DATE:"customDate",MERDIEN_SEL_CLASS:"tp-sel",SET_TIME:"setTime",DAY_DIFF:864e5,DISABLE_BTN_CLASS:"zcdisabled",CLICK_OUTSIDE_CONTAINER_ID:"schedule-msg-popup-container",TOMORROW:"tomorrow",TODAY:"today",MONDAY:"monday",USER_ON_A_CALL:101,USER_ON_MEETING:102,USER_AVAIL:1,USER_IN_DND:5,USER_IN_AWAY:7,USER_IN_IDLE:4,USER_ENGAGED:3,FRIDAY_NUM:5,SATURDAY_NUM:6,USER_OFFLINE:0,USER_LOGOUT:1,CUSTOM_STATUS_ONE:"recipientStatus",CUSTOM_STATUS_TWO:"userCheckOut",CUSTOM_STATUS_CHECKIN:"userCheckIn",CHECK_IN:"check_in",USER_AVAILABLE:"user_available",CALL_END:"call_end",CHECK_OUT:"check_out",CALENDAR_SHOW_MAX_MSGPOSITION:4},getSelectedTimeStamp:function(e){var t=this.CONSTANTS;if(e==t.TOMORROW)return new Date((new Date).getTime()+this.CONSTANTS.DAY_DIFF).setHours(9,0,0,0);if(e==t.TODAY)return(new Date).setHours(9,0,0,0);if(e==t.MONDAY){var s=new Date;return s.getDay()==t.SATURDAY_NUM?s=s.setDate(s.getDate()+2):s.getDay()==t.FRIDAY_NUM&&(s=s.setDate(s.getDate()+3)),new Date(s).setHours(9,0,0,0)}return e==t.CUSTOM_STATUS_ONE?this.getStatusCodeDisplayName(this.getRecipientStatusCode()):e==t.CUSTOM_STATUS_TWO?this.CONSTANTS.CHECK_OUT:e==t.CUSTOM_STATUS_CHECKIN?this.CONSTANTS.CHECK_IN:e==t.CUSTOM_DATE?this.getConvertedDateBasedOnMeridiem().getTime():void 0},getStatusCodeDisplayName:function(e){var t=this.CONSTANTS;return{1:t.CHECK_IN,0:t.USER_AVAILABLE,5:t.USER_AVAILABLE,7:t.USER_AVAILABLE,3:t.USER_AVAILABLE,4:t.USER_AVAILABLE,101:t.CALL_END,102:t.CALL_END}[e]},getStatusCode:function(){var e=this.getRecipientStatusCode();return e||e==this.CONSTANTS.USER_OFFLINE?e:this.isUserLoggedOut()?this.CONSTANTS.USER_LOGOUT:void 0},getConvertedDateBasedOnMeridiem:function(){var e=this.state,t=this.CONSTANTS,s=new Date(e.customDate),i=parseInt(e.customHours)||0,n=parseInt(e.customMins)||0,a=e.customMeridien;return a==t.PM&&12!=i?s.setHours(i+12):a==t.AM&&12==i?s.setHours(i-12):s.setHours(i),s.setMinutes(n),s.setSeconds(0),s},isCurrentTimeBetween12AMAnd6AM:function(){var e=(new Date).getHours();if(e>=0&&e<=6)return!0},getScheduleOptions:function(){var e=this,t={tomorrow:{renderOrder:1,getTimeStamp:()=>e.getSelectedTimeStamp(this.CONSTANTS.TOMORROW),getDisplayName:()=>I18N("schmsg.tomorrow")},today:{renderOrder:2,getTimeStamp:()=>e.getSelectedTimeStamp(this.CONSTANTS.TODAY),getDisplayName:()=>I18N("schmsg.today")},monday:{renderOrder:3,getTimeStamp:()=>e.getSelectedTimeStamp(this.CONSTANTS.MONDAY),getDisplayName:()=>I18N("schmsg.monday")},recipientStatus:{renderOrder:4,getTimeStamp:()=>e.getSelectedTimeStamp(this.CONSTANTS.CUSTOM_STATUS_ONE),getDisplayName:function(){if(e.state.isUserDetailsFetched){var t=e.getRecipientStatusCode();return e.getScheduleDisplayOptionBasedOnRecipientStatus(t)}}},userCheckOut:{renderOrder:5,getTimeStamp:()=>e.getSelectedTimeStamp(this.CONSTANTS.CUSTOM_STATUS_TWO),getDisplayName:function(){if(e.state.isUserDetailsFetched&&!e.state.ischeckInCheckOutViewPermissionRestricted&&!e.isUserLoggedOut())return e.getScheduleDisplayOptionBasedOnRecipientStatus(333)}},userCheckIn:{renderOrder:6,getTimeStamp:()=>e.getSelectedTimeStamp(this.CONSTANTS.CUSTOM_STATUS_CHECKIN),getDisplayName:function(){if(e.state.isUserDetailsFetched&&!e.state.ischeckInCheckOutViewPermissionRestricted&&e.isUserLoggedOut())return e.getScheduleDisplayOptionBasedOnRecipientStatus(e.CONSTANTS.USER_LOGOUT)}},customDate:{renderOrder:7,getTimeStamp:()=>e.getSelectedTimeStamp(this.CONSTANTS.CUSTOM_DATE),getDisplayName:()=>I18N("reminders.set.customtime")}};return ConversationsList.isOnetoOneChat(this.chatID)&&!ConversationsList.get(this.chatID).isGuestChat||delete t.recipientStatus,t},fetchAdditionalDetails:function(){return Promise.all([this.fetchUserInfoIf121Chat(),this.fetchTimeZone()])},fetchUserInfoIf121Chat:function(){if(!ConversationsList.isOnetoOneChat(this.chatID)||ConversationsList.get(this.chatID).isGuestChat)return Promise.resolve();var e=ConversationsList.get121RecipientIdFromChatId(this.chatID);return e?Users.getMutualContactInfoFromCacheOrServer(e,{lookUpAtServer:!0}):void 0},fetchTimeZone:function(){return Timezones.fetchAllTimeZones()},getRecipientStatusCode:function(){var e=this.getRecipientContactInfo();if(e){var t=e.status,s=e.st,i=this.CONSTANTS,n=[i.USER_IN_DND,i.USER_IN_AWAY,i.USER_ENGAGED,i.USER_IN_IDLE,i.USER_OFFLINE].includes(t);if(s!==i.USER_ON_A_CALL&&s!==i.USER_ON_MEETING&&n)return t;if(s==i.USER_ON_A_CALL)return s;if(s==i.USER_ON_MEETING)return s}},isUserLoggedOut:function(){return 0==(this.getRecipientUserInfo()||{}).checkin_status},isUserAvailable:function(){return(this.getRecipientUserInfo()||{}).status==this.CONSTANTS.USER_AVAIL},getRecipientUserInfo:function(){var e=ConversationsList.get121RecipientIdFromChatId(this.chatID);return Users.getInfo(e)},getRecipientContactInfo:function(){var e=ConversationsList.get121RecipientIdFromChatId(this.chatID);return Contacts.get(e)},getScheduleDisplayOptionBasedOnRecipientStatus:function(e){var t=this.getUserName(),s=Resource.getRealValue("schmsg.user.dnd",[t]);return{1:Resource.getRealValue("schmsg.user.checkout",[t]),0:s,5:s,3:s,7:s,4:s,101:Resource.getRealValue("schmsg.user.onacallormeeting",[t]),102:Resource.getRealValue("schmsg.user.onacallormeeting",[t]),333:Resource.getRealValue("schmsg.user.checkin",[t])}[e]},getUserName:function(){var e=ConversationsList.get121RecipientIdFromChatId(this.chatID);return Users.getName(e)},renderLoader:function(){return this.$el.append(this.getLoaderHTML()),this.appendPopUpHTMLInBody(),this.bindClickOutside(),this.bindEvents(),this},getLoaderHTML:function(){return $WC.template.replace(this.template.skeletonLoader,{popUpTitle:this.state.isReschedule?I18N("schmsg.reschedule.title"):I18N("schmsg.tooltip.title")},"InSecureHTML")},render:function(){return this.preRender(),this.$el.html(this.getPopUpHTML()),this.appendPopUpHTMLInBody(),this.afterRender(),this.updateState({rendered:!0}),this},preRender:function(){this.scheduleOptions=this.getScheduleOptions(),this.convertTimeStampBasedOnTimezone(),this.updateToNearsetTime(),this.updateCustomDate(),this.changeSelectedSchedulingOptionBasedOnTimeStamp(),this.updateTimeZone()},updateCustomDate:function(){var e=this.state.timeStamp;e&&this.updateState({customDate:e})},convertTimeStampBasedOnTimezone:function(){if(!this.isCustomOptionSelected()&&this.state.timeStamp){var e=ScheduleMessageUtils.getConvertedTimeStampBasedOnTimezone(this.state.timezone,this.state.timeStamp);this.updateState({timeStamp:e})}},changeSelectedSchedulingOptionBasedOnTimeStamp:function(){this.state.timeStamp?this.isCustomOptionSelected()?this.updateSchedulingBasedOnUserInfo():this.updateSchedulingBasedOnDefaultOption():this.state.selectedSchedulingOption=this.isCurrentTimeBetween12AMAnd6AM()?this.CONSTANTS.TODAY:this.CONSTANTS.TOMORROW},updateSchedulingBasedOnUserInfo:function(){var e=this.getRecipientStatusCode(),t=this.getScheduleDisplayOptionBasedOnRecipientStatus(e);this.state.timeStamp==this.CONSTANTS.CHECK_OUT?this.updateState({selectedSchedulingOption:this.CONSTANTS.CUSTOM_STATUS_TWO}):this.state.timeStamp==this.CONSTANTS.CHECK_IN?this.updateState({selectedSchedulingOption:this.CONSTANTS.CUSTOM_STATUS_CHECKIN}):t?this.updateState({selectedSchedulingOption:this.CONSTANTS.CUSTOM_STATUS_ONE}):this.updateState({selectedSchedulingOption:this.isCurrentTimeBetween12AMAnd6AM()?this.CONSTANTS.TODAY:this.CONSTANTS.TOMORROW})},updateSchedulingBasedOnDefaultOption:function(){for(var e=this.state.timeStamp,t=this.CONSTANTS,s=[t.TOMORROW,t.TODAY,t.MONDAY,t.CUSTOM_DATE],i=0;i<s.length;i++){if(e==this.getSelectedTimeStamp(s[i])){this.updateState({selectedSchedulingOption:s[i]});break}}},appendPopUpHTMLInBody:function(){this.getParentContainer().html(this.$el)},afterRender:function(){this.renderTimeZoneDropDown(),this.clearBindOutside(),this.closeMsgOptions(),this.bindClickOutside(),this.bindEvents(),this.showOrHideCustomDateOption()},getScheduledMsgTopPostion:function(e){var t=e.top,s=e.bottom,i=this.$el.height();return t>i&&s<i?i/2:t-i-30},positionAbove:function(e){if(ChatUI.isExist(this.chatID)){var t=e[0].getBoundingClientRect(),s=t.right,i=this.$el.width(),n=this.getScheduledMsgTopPostion(t),a=n>0?n:0,o=s>i?s-i:s;this.getParentContainer().toggleClass("zcsched-caloverflw",!(n>=0)),this.getParentContainer().toggleClass("zcsched-calauto",n>0),this.getParentContainer().css({top:a+"px",left:o+"px"})}},bindClickOutside:function(){var e=this,t=this.state.isReschedule,s=this.state.triggeringEle,i={srcid:t?s.attr("id"):this.DOMSELECTORS.scheduleMsgIcon,destid:this.CONSTANTS.CLICK_OUTSIDE_CONTAINER_ID,closeOnClickSrc:!0,customShow:function(){t&&s.parent().addClass("zcvsble"),e.showScheduleMsgSelectionPopUpContainer(),MessageOperations.setPreviousScheduleMsgOptionEle(s)},customHide:function(){t&&(s.parent().removeClass("zcvsble"),MessageOperations.visibleMsgOptionListUid=void 0,MessageOperations.setPreviousScheduleMsgOptionEle(null)),e.destroyView(),e.clearBindOutside()},callback:function(){e.clearBindOutside()}};MessageOperations.visibleMsgOptionListUid=e.state.schMsgUid,Clickoutside.bind(i)},clearBindOutside:function(){Clickoutside.clear(this.CONSTANTS.CLICK_OUTSIDE_CONTAINER_ID)},closeMsgOptions:function(){MessageOperations.closeScheduleOptionsDOM()},getPopUpHTML:function(){var e=this.getSchedulingOptionsHtml(),t=this.getCalendarSectionHTML(),s=this.getFooterButtonHTML(),i=this.state.isReschedule,n=i&&this.getRescheduleCheckBoxHTML(),a=this.getFormattedTimezone();return $WC.template.replace(this.template.content,{calendarDateTimeHTML:t,option_html:e,chatid:this.chatID,footerBtnHTML:s,popUpTitle:i?I18N("schmsg.reschedule.title"):I18N("schmsg.tooltip.title"),showRescheduleCheckBox:i?"":"dN",rescheduleCheckBoxHTML:i?n:"",timeZone:a||""},"InSecureHTML")},getFooterButtonHTML:function(){var e=this.state.isReschedule?this.template.rescheduleBtn:this.template.scheduleBtn;return $WC.template.replace(e,{})},getRescheduleCheckBoxHTML:function(){var e=this.getFormattedRescheduleTime();return $WC.template.replace(this.template.rescheduleCheckBoxHTML,{formattedRescheduledTime:I18N("schmsg.rescheduleall.confirm",[e])})},getFormattedRescheduleTime:function(){var e,t=this.state.customDate;if(this.state.selectedSchedulingOption==this.CONSTANTS.CUSTOM_DATE){var s,i=$Date.get(t),n=$Date.time(t);s=0==i.minutes?n.slice(0,2)+" "+n.slice(-2):n,e=i.date+"/"+(i.month+1)+"/"+i.year+", "+s}else e=this.getScheduleOptions()[this.state.selectedSchedulingOption].getDisplayName();return e},getFormattedTimezone:function(){var e=new RegExp(/\(([^)]+)\)/);return this.state.timezone&&Timezones.hasTimeZoneMap()&&Timezones.findTimeZone(this.state.timezone)?e.exec(Timezones.findTimeZone(this.state.timezone))[1]:""},getCalendarSectionHTML:function(){var e=this.getFormattedDate(),t=this.getCurrentNearestTime();return $WC.template.replace(this.template.calendarDateTimeHTML,{chatid:this.chatID,currentDate:e,hours:t.hours,mins:t.mins,amSelectedClass:t.meridien==this.CONSTANTS.AM?this.CONSTANTS.MERDIEN_SEL_CLASS:"",pmSelectedClass:t.meridien==this.CONSTANTS.PM?this.CONSTANTS.MERDIEN_SEL_CLASS:""},"InSecureHTML")},isCustomOptionSelected:function(){return ScheduleMessageUtils.isCustomOptionSelected(this.state.timeStamp)},getFormattedDate:function(){var e=this.isCustomOptionSelected()?Date.now():this.state.customDate,t=e>0?new Date(e):new Date;return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()},getCurrentNearestTime:function(){return{meridien:this.state.customMeridien,hours:this.state.customHours,mins:this.state.customMins}},updateToNearsetTime:function(){var e=this.isCustomOptionSelected(),t=this.state.isReschedule||this.state.timeStamp?e?EventsMain.UTIL.getTimeToPopulate():this.state.timeStamp:EventsMain.UTIL.getTimeToPopulate();date=t>0?new Date(t):new Date;var s=date.getHours(),i=date.getMinutes(),n=s>=12?"pm":"am";i=i<10?"0"+i:i,s=(s=s>12?s-12:0==s?12:s)<10?"0"+s:s,this.updateState({customMeridien:n,customHours:s,customMins:i})},bindEvents:function(){var e=this;this.$el.on("keydown keyup","[time_format]",(function(t){e.onHourandMinChange(t),t.stopPropagation()})),this.$el.on("mousedown",'[set_time_button="plusone"], [set_time_button="minusone"]',(function(t){e.onHourandMinChange(t),t.stopPropagation()})),this.$el.on("click","[data-action]",(function(t){var s=$(this).attr("data-action");s in e&&e[s](t)}))},onMeridienChange:function(e){var t=e.target.getAttribute("data-meridien");this.toggleSelectedClassToHighlightMeridien(t==this.CONSTANTS.AM),this.updateState({customMeridien:t}),this.disableDoneBtnBasedOnTimeStamp()},toggleSelectedClassToHighlightMeridien:function(e){this.$(this.DOMSELECTORS.ante_meridien).toggleClass(this.CONSTANTS.MERDIEN_SEL_CLASS,e),this.$(this.DOMSELECTORS.post_meridien).toggleClass(this.CONSTANTS.MERDIEN_SEL_CLASS,!e)},onSelectRescheduleChange:function(e){this.updateState({isRescheduleAll:e.target.checked})},updateState:function(e){return $.extend(this.state,e),this},updateProps:function(e){return $.extend(this.params,e),this},onScheduleOptionChange:function(e){if(this.state.selectedSchedulingOption!=e.target.dataset.selectedoptionid){if(this.updateState({selectedSchedulingOption:e.target.dataset.selectedoptionid}),this.showOrHideCustomDateOption(),this.isCustomDate())if(this.state.isReschedule){var t=this.isCustomOptionSelected()?Date.now():this.state.timeStamp;this.updateState({customDate:t})}else this.isCustomOptionSelected()&&this.updateState({customDate:Date.now()});this.disableDoneBtnBasedOnTimeStamp()}},isCustomDate:function(){if(this.state.selectedSchedulingOption==this.CONSTANTS.CUSTOM_DATE)return!0},showOrHideCustomDateOption:function(){var e=this.state.selectedSchedulingOption==this.CONSTANTS.CUSTOM_DATE,t=this.$(this.DOMSELECTORS.schdeulemsgdatesection);e?t.show():t.hide()},updateTimeZone:function(){var e=Users.getInfo($zcg._ZUID);e&&Timezones.hasTimeZoneMap()&&(this.state.isReschedule||this.state.timezone||!e.timezone||Timezones.findTimeZone(e.timezone)&&this.updateState({timezone:e.timezone}))},destroyView:function(){this.$el.empty(),this.hideScheduleMsgSelectionPopUpContainer(),MessageOperations.setPreviousScheduleMsgOptionEle(this.state.triggeringEle),ScheduleMessageUtils.clearCurrentValues(),this.updateState({rendered:!1,schMsgUid:null,isReschedule:!1,isRescheduleAll:!1,timeStamp:null,triggeringEle:null,isUserDetailsFetched:!1,ischeckInCheckOutViewPermissionRestricted:!1}),MessageOperations.visibleMsgOptionListUid=void 0,this.params.onDestroy&&this.params.onDestroy(),Config.isClientMemoryOptimizationEnabled()&&(Clickoutside.clear(this.CONSTANTS.CLICK_OUTSIDE_CONTAINER_ID),this.params={})},hideScheduleMsgSelectionPopUpContainer:function(){ScheduleMessageUtils.$getScheduledMessageSelectionPopUpUIContainer().hide()},showScheduleMsgSelectionPopUpContainer:function(){ScheduleMessageUtils.$getScheduledMessageSelectionPopUpUIContainer().show()},$:function(e){return this.$el.find(e)},renderCalendar:function(e){var t=this,s=new Date;s.setFullYear(s.getFullYear()+1);var i={time:!1,range:{from:Date.now(),to:s.getTime()},preview:!1,scheduledMsg:!0},n=new DateTimeWidget("schedulemessagecalendar"+this.chatID,i);this.isCustomOptionSelected()&&this.updateState({customDate:Date.now()}),n.initialize(new Date(this.state.customDate)),n.handleModify=function(){var s=this.getSelection(),i=s.getDate()+"/"+(s.getMonth()+1)+"/"+s.getFullYear();t.$(t.DOMSELECTORS.schedule_msg_date).html(i),t.updateState({customDate:s}),t.disableDoneBtnBasedOnTimeStamp(),Clickoutside.handleClick(e)},n.handleCancel=function(e){Clickoutside.handleClickOnChild(e)}},onHourandMinChange:function(e){var t=$(e.target).attr("purpose"),s=ScheduleMessageUtils.getSelectedHourAndMinute(e,this.$el,t==this.CONSTANTS.SET_TIME);if(s){var i=s.hours||this.state.customHours,n=s.mins||this.state.customMins,a=s.isInvalidCustomTime||!1;this.updateState({customHours:i,customMins:n,isInvalidCustomTime:a}),this.disableDoneBtnBasedOnTimeStamp()}},isSelectedDateLesserThanCurrentDate:function(){var e=new Date(EventsMain.UTIL.getTimestampForGivenTimezone((new Date).getTime(),this.state.timezone)),t=this.getConvertedDateBasedOnMeridiem();return e>(t=new Date(EventsMain.UTIL.getTimestampForGivenTimezone(t.getTime(),this.state.timezone)))},disableDoneBtnBasedOnTimeStamp:function(){if(this.isCustomDate()){var e=this.state.isInvalidCustomTime,t=this.isSelectedDateLesserThanCurrentDate();e?this.$(this.DOMSELECTORS.doneBtn).toggleClass(this.CONSTANTS.DISABLE_BTN_CLASS,e):this.$(this.DOMSELECTORS.doneBtn).toggleClass(this.CONSTANTS.DISABLE_BTN_CLASS,t)}else this.$(this.DOMSELECTORS.doneBtn).toggleClass(this.CONSTANTS.DISABLE_BTN_CLASS,!1)},onScheduleBtnClick:function(){if(!this.isInvalidTimeStamp()){var e={selectedTimeStamp:this.getScheduledTimeStamp(),timezone:this.state.timezone};"function"==typeof this.params.onDoneBtnClick&&this.params.onDoneBtnClick(e)}},onRescheduleBtnClick:function(){if(!this.isInvalidTimeStamp())if(this.state.timeStamp!=this.getScheduledTimeStamp()){var e={isRescheduleAll:this.state.isRescheduleAll,selectedTimeStamp:this.getScheduledTimeStamp()};"function"==typeof this.params.onRescheduleBtnClick&&this.params.onRescheduleBtnClick(e)}else this.destroyView()},isInvalidTimeStamp:function(){var e=this.CONSTANTS;if([e.CUSTOM_STATUS_ONE,e.CUSTOM_STATUS_TWO,e.CUSTOM_STATUS_CHECKIN].includes(this.state.selectedSchedulingOption))return!1;if(this.state.isInvalidCustomTime)return!0;var t=this.getScheduledTimeStamp();return!this.isValidTimeStamp(t)||void 0},isRenderedAlready:function(){return this.state.rendered},getScheduleMsgUid:function(){return this.state.schMsgUid},isValidTimeStamp:function(e){return!(EventsMain.UTIL.getTimestampForGivenTimezone((new Date).getTime(),this.state.timezone)>e)},showCalendar:function(e){var t=this;this.renderCalendar(e),Clickoutside.bind({srcid:"schedcalendar"+this.chatID,destid:"schedulemessagecalendar"+this.chatID,event:e,closeOnClickSrc:!1,customShow:function(e){t.$el.find("#"+e.destid).show();var s=t.getParentContainer().find("#calendar"+t.chatID),{top:i}=s[0].getBoundingClientRect();i<=0&&t.getParentContainer().removeClass("zcsched-calauto").toggleClass("zcsched-caloverflw",!0)},customHide:function(e){t.$el.find("#"+e.destid).hide()}})},renderTimeZoneDropDown:function(){var e=this.$el.find(this.DOMSELECTORS.schedule_timezone);if(this.state.timezone){var t=this;Timezones.getTimeZoneMap((function(s){var i=Timezones.getTimeZoneMap(),n={type:"dropdown",selected:[{key:t.state.timeZone,title:i[t.state.timeZone]}],data:s,placeholder:Resource.getRealValue("common.search"),searchinoptions:!0,drpdwnplaceholder:Resource.getRealValue("formdialog.datetime.timezone"),clickcallback:function(e){t.updateState({timezone:e.key});var i=new RegExp(/\(([^)]+)\)/);t.$(t.DOMSELECTORS.timeZoneInHeader).text(i.exec(s[e.key])[1]),t.disableDoneBtnBasedOnTimeStamp()}};e.dropdown(n)}))}},getAllTimeZones:function(e){return Timezones.getTimeZoneMap(e)},getTimezone:function(){return this.state.timezone},canShowTodayOption:function(){return this.state.selectedSchedulingOption==this.CONSTANTS.TODAY||this.isCurrentTimeBetween12AMAnd6AM()},canShowMondayOption:function(){return this.isCurrentTimeAbove6PMOnFriday()||this.isCurrentTimeBelow12AMOnSaturday()},isCurrentTimeAbove6PMOnFriday:function(){var e=new Date;if(e.getDay()!==this.CONSTANTS.FRIDAY_NUM)return!1;var t=e.getHours();return e.getDay()==this.CONSTANTS.FRIDAY_NUM&&t>=18||void 0},isCurrentTimeBelow12AMOnSaturday:function(){var e=new Date;if(e.getDay()!==this.CONSTANTS.SATURDAY_NUM)return!1;var t=e.getHours();return t=t>12?t-12:0==t?12:t,e.getDay()==this.CONSTANTS.SATURDAY_NUM&&t<12||void 0},getSchedulingOptionsHtml:function(){var e="",t=this;return Object.entries(this.scheduleOptions).sort((function(e,t){return e.renderOrder-t.renderOrder})).filter(e=>(function(e){return e[0]==t.CONSTANTS.TODAY?t.canShowTodayOption():e[0]!=t.CONSTANTS.MONDAY||t.canShowMondayOption()})(e)).forEach((function(s){var i=s[0],n=s[1].getDisplayName();e+=$WC.template.replace(t.template.option,{selectedOptionId:i,id:"sch-opt"+i,className:"schd-"+i,checked:i==t.state.selectedSchedulingOption?"checked":"",displayName:n||"",showClass:n?"":"dN"},"InSecureHTML")})),e},isRescheduling:function(){return this.state.isReschedule||!1},getContainer:function(){return $WC.template.replace(this.template.container,{chatid:this.chatID})},getParentContainer:function(){return ScheduleMessageUtils.$getScheduledMessageSelectionPopUpUIContainer()},getScheduledTimeStamp:function(){var e=this.state.selectedSchedulingOption,t=this.CONSTANTS;if([t.CUSTOM_STATUS_ONE,t.CUSTOM_STATUS_TWO,t.CUSTOM_STATUS_CHECKIN].includes(e))return this.scheduleOptions[e].getTimeStamp();var s=this.getScheduleOptions()[e].getTimeStamp();return EventsMain.UTIL.getTimestampForGivenTimezone(new Date(s).getTime(),this.state.timezone)},DOMSELECTORS:{schedule_msg_date:"[schedule-msg-date]",ante_meridien:'[data-meridien="am"]',post_meridien:'[data-meridien="pm"]',schedule_timezone:'[data-purpose="schedtimezone"]',schedule_msg_calendar:"#schedulemessagecalendar",schdeulemsgdatesection:".schdeulemsgdatesection",schedule_msg_time_hours:'[data-time="hours"]',schedule_msg_time_mins:'[data-time="mins"]',timeZoneInHeader:".header_rec_timezone",doneBtn:".sched-msg-done-btn",scheduleMsgIcon:"#schedule-msg-icon"},template:ScheduleMessageTemplates.schedulemessagepopupui};var $ScheduleMsgCwin=function(e){this.$el=$(this.getContainer()),this.chatId=e.chatId,this.totalScheduledMessageCount=0,this.scheduleMessageInfo=e,this.scheduledTimeStamp="",this.initState()};$ScheduleMsgCwin.prototype={initState:function(){this.state={rendered:!1,collapsedWin:!0,expandedWin:!1}},updateState:function(e){$.extend(this.state,e)},resetState:function(){this.initState()},getState:function(){return this.state},expandWindow:function(){this.makeInitialFetch().then(()=>this.afterExpandWindow())},afterExpandWindow:function(){this.getScheduledTimeStamp()||this.updateScheduledTimeStampBasedOnLastSchTime(),this.scheduleMessageInfo.onExpand(),this.scrollDown(),this.updateState({expandedWin:!0,collapsedWin:!1})},collapseWindow:function(){this.updateState({expandedWin:!1,collapsedWin:!0}),this.scheduleMessageInfo.onCollapse()},render:function(){return this.state.rendered?this:(this.$el.html(this.getScheduledWindowHtml()),this.initMessageStorageAndView(),this.bindEvents(),this.updateState({rendered:!0}),this)},makeInitialFetch:function(){var e=this.getMessageStorage();return e.isListEmpty()?(this.initialFetchPromise=this.initialFetchPromise||e.initialFetch(),this.initialFetchPromise):Promise.resolve()},scrollDown:function(){var e=this.getView();e&&e.scrollDown()},getScheduledWindowHtml:function(){return $WC.template.replace(this.templates.container,{sch_msg_count:this.totalScheduledMessageCount,alertclass:this.CONSTANTS.MAX_LIMIT<=this.totalScheduledMessageCount?this.CONSTANTS.MAX_LIMIT_CLASS:""})},getTotalSchMsgCount:function(){return this.totalScheduledMessageCount},updateTotalScheduledMessageCount:function(e){this.totalScheduledMessageCount=e,this.updateTotalScheduledMessageCountUI()},getMessage:function(e){return this.getMessageStorage().getList().getMessage(e)},getStorage:function(){return this.getMessageStorage()},getView:function(){return this.getMessageStorage().getView()},getMessageStorage:function(){return this.messageStorage},hasMessageStorage:function(){return Boolean(this.messageStorage)},hasMessage:function(e){return this.getMessageStorage().getList().hasMessage(e)},getMessage:function(e){return this.getMessageStorage().getList().getMessage(e)},getMessagePosition:function(e){return this.getMessageStorage().getList().getMsgPositionFromLastMessage(e)},focus:function(){ChatUI.getWin(this.chatId).focus()},initMessageStorageAndView:function(){this.messageStorage=new ScheduleMessageStorage(this.chatId),this.initView()},destroyAndInitMessageStorage:function(){this.getMessageStorage().getView().clearView(),this.getMessageStorage().destroy(),this.initMessageStorageAndView(),this.initialFetchPromise=void 0},destroy:function(){this.hasMessageStorage()&&this.getMessageStorage().destroy()},getMessageOptions:function(){return MessageOperations.getBasicMsgOperations()},bindEvents:function(){var e=this;this.$el.on("click","[data-action]",(function(t){var s=t.target.dataset.action;s in e&&(t.stopPropagation(),e[s](t))}))},increaseTotalMsgCountByOne:function(){return this.updateTotalScheduledMessageCount(this.totalScheduledMessageCount+1),this},decreaseTotalMsgCountByOne:function(){return this.updateTotalScheduledMessageCount(this.totalScheduledMessageCount-1),this},updateScheduleTimeInUI:function(){this.hasScheduledTime()?this.scheduleMessageInfo.onScheduleTimeChange(this.getFormattedScheduledTimeStamp()):this.scheduleMessageInfo.onScheduleTimeChange("")},getFormattedScheduledTimeStamp:function(){var e,t=this.scheduledTimeStamp;if(ScheduleMessageUtils.isCustomOptionSelected(t)){var s=ScheduleMessageUtils.getRecipientStatusMap(t,this.chatId);e=I18N("schmsg.scheduling.for",[s,"",""])}else{s=$Date.day(t,{shorten:!0});e=$Date.time(t,{shorten:!0}),e=I18N("schmsg.scheduling.for",[s,this.CONSTANTS.AT,e])}return e},updateTotalScheduledMessageCountUI:function(){this.$el.find(this.domSelector.schmsgMaxCount).toggleClass(this.CONSTANTS.MAX_LIMIT_CLASS,this.totalScheduledMessageCount>=this.CONSTANTS.MAX_LIMIT),this.$(this.domSelector.count).text(this.totalScheduledMessageCount),this.$el.toggleClass(this.CONSTANTS.NO_SCHDEULED_MSGS_CLASS,0==this.totalScheduledMessageCount)},initView:function(){if(!this.getMessageStorage().isViewExist()){var e=new ScheduleMessageView(this.chatId,this.getMessageStorage().getId(),this.$el.find(this.domSelector.main),this);this.getMessageStorage().initView(e)}},expandOrCollapseSchWindow:function(){this.state.expandedWin?this.collapseWindow():this.expandWindow()},getScheduledTimeStamp:function(){return this.scheduledTimeStamp},resetScheduledTimeStamp:function(){this.updateScheduledTimeStamp("")},disableHoverByMsgUid:function(e){this.hasMessage(e)&&this.getStorage().getView().disableHoverByMsgUid(e)},enableHoverByMsgUid:function(e){this.hasMessage(e)&&this.getStorage().getView().enableHoverByMsgUid(e)},updateScheduledTimeStampBasedOnLastSchTime:function(){var e=this.getMessageStorage();if(!e.isListEmpty()){var t=e.getList().getVisibleLastMessage().getScheduleTime(),s=e.getList().getVisibleLastMessage().getScheduleTimezone();this.updateScheduledTimeStamp(t),this.updateScheduledTimezone(s)}},updateScheduledTimeStamp:function(e){var t=this.scheduledTimeStamp;this.scheduledTimeStamp=e,t!=this.scheduledTimeStamp&&this.updateScheduleTimeInUI()},updateScheduledTimezone:function(e){this.scheduledMsgTimezone=e},getScheduledTimezone:function(){return this.scheduledMsgTimezone},hasScheduledTime:function(){return Boolean(this.scheduledTimeStamp)},cancelScheduling:function(){this.scheduleMessageInfo.onCancelScheduling()},sendAllScheduledMessages:function(){$Util.Button.addLoadIconForAjax(this.getSendIcon()),ScheduleMessageApis.sendAll({chatId:this.chatId}).then(()=>this.onSendAllScheduledMsgSuccess(),()=>this.onSendAllScheduledMsgFailure())},onSendAllScheduledMsgFailure:function(){$Util.Button.showCompletionAndResetContent(this.getSendIcon(),!0)},deleteAllScheduledMessages:function(){var e={type:"DELETEALL",scheduledMsgCount:this.totalScheduledMessageCount};ScheduleMessageUtils.renderConfirmDialog(e).then(()=>ScheduleMessageApis.deleteAll({chatId:this.chatId}).then(()=>this.onDeleteAllScheduledMsgSuccess()))},onDeleteAllScheduledMsgSuccess:function(){UI.updateBanner(I18N("schmsg.deleteall.success")),this.handleAllSchMsgRemoval()},onSendAllScheduledMsgSuccess:function(){UI.updateBanner(I18N("schmsg.sendall.success")),this.handleAllSchMsgRemoval()},handleAllSchMsgRemoval:function(){this.updateTotalScheduledMessageCount(0),this.destroyAndInitMessageStorage(),this.collapseWindow(),this.destroyWindow(),Composer.clearAutoComplete(this.chatId)},destroyWindow:function(){this.$getElement().remove(),this.updateState({rendered:!1}),this.scheduleMessageInfo.onDestroy&&this.scheduleMessageInfo.onDestroy()},$getElement:function(){return this.$el},win:function(){return this.$getElement()},hasMessage:function(e){return this.getStorage().getList().hasMessage(e)},getMessage:function(e){var t=this.getStorage();if(this.hasMessage(e))return t.getList().getMessage(e)},getMessageObject:function(e){if(this.hasMessage(e))return this.getMessage(e).getObject()},$:function(e){return this.$getElement().find(e)},getContainer:function(){return this.templates.outerContainer},findAndScrollToMsg:function(e){var t=this.getStorage().getExactMessageByMsguid(e.msguid,e.sender),s=this;return t.then((function(t){if(t.message)return ChatUI.popOutMultiPaneThreadCwinIfExists(t.chid,!0),s.scheduleMessageInfo.onExpand(),s.getStorage().scrollToMsg(e.msguid),void s.updateState({expandedWin:!0,collapsedWin:!1});UI.updateBanner(Resource.getRealValue("message.replied.doesnotexist"),2e3,!1)}))},getSendIcon:function(){return this.$el.find(this.domSelector.sendNow)},CONSTANTS:{NO_SCHDEULED_MSGS_CLASS:"sch-msg-empty",MAX_LIMIT:ScheduleMessageUtils.CONSTANTS.max_limit,MAX_LIMIT_CLASS:"zc-sched-msg-max",AT:"at"},domSelector:{main:"#zcsched-msg-main",count:"#sch-msg-count",schMsgInfo:"#zcsched-msg-info",schMsgTime:"#scheduling-time",schmsgMaxCount:".zc-schmsg-count",sendNow:'[data-action="sendAllScheduledMessages"]'},templates:ScheduleMessageTemplates.scheduledChatWindow};var ScheduleMessageApis={scheduleTextMsg:function(e){var t="/v2/chats/"+e.chatId+"/scheduledmessages",s={text:e.text,id:e.currTime,schedule_timezone:e.timezone};ScheduleMessageUtils.isReplyMessage(e)&&(s.reply_to=e.replyTo),ScheduleMessageUtils.isReplyPrivateMessage(e)&&(s.reply_from=e.replyFrom),ScheduleMessageUtils.isWDPickerMessage(e)&&(s.workdrive_data=e.workdrive_data),ScheduleMessageUtils.hasPostInParent(e)&&(s.post_in_parent=e.postInParent);var i=ScheduleMessageUtils.getScheduleTimeOrScheduleStatus(e);return $.extend(s,i),MsgUtil.makePostRequest(t,s,e.additionalAjaxOptions)},fetchScheduledMessages:function(e){var t="/v2/chats/"+e.chatId+"/scheduledmessages",s={limit:50};return e.nextToken&&(s.next_token=e.nextToken),MsgUtil.makeGetRequest(t,s)},deleteScheduleMessage:function(e){var t="/v2/chats/"+e.chatId+"/scheduledmessages/"+e.schMsgId;return MsgUtil.makeDeleteRequest(t)},sendNow:function(e){var t="/v2/chats/"+e.chatId+"/scheduledmessages/"+e.schMsgId+"/send";return MsgUtil.makePutRequest(t)},sendAll:function(e){var t="/v2/chats/"+e.chatId+"/scheduledmessages/send";return MsgUtil.makePutRequest(t)},delete:function(e){var t="v2/chats/"+e.chatId+"/scheduledmessages",s={time:e.timeStamp};return MsgUtil.makeDeleteRequest(t,s)},deleteAll:function(e){var t="/v2/chats/"+e.chatId+"/scheduledmessages";return MsgUtil.makeDeleteRequest(t)},editMsg:function(e){var t="/v2/chats/"+e.chatId+"/scheduledmessages/"+e.schMsgId,s={text:e.text};ScheduleMessageUtils.isReplyMessage(e)&&(s.reply_to=e.replyTo),ScheduleMessageUtils.isReplyPrivateMessage(e)&&(s.reply_from=e.replyFrom),ScheduleMessageUtils.hasPostInParent(e)&&(s.post_in_parent=e.postInParent),ScheduleMessageUtils.hasFiles(e)&&(s.files=e.files),e.att_removed&&(s.att_removed=e.att_removed);var i=ScheduleMessageUtils.getScheduleTimeOrScheduleStatus(e);return $.extend(s,i),Config.isAttachmentUploadOptimised()&&ScheduleMessageUtils.hasFiles(e)?FileUploadUI.handleEditAttachment({isScheduledEdit:!0,url:t,additionalAjaxOptions:e.additionalAjaxOptions,msguid:e.schMsgId,chid:e.chatId,data:s}):MsgUtil.makePutRequest(t,s,e.additionalAjaxOptions)},rescheduleMsg:function(e){var t="/v2/chats/"+e.chatId+"/scheduledmessages/"+e.schMsgId,s={schedule_timezone:e.timezone};ScheduleMessageUtils.hasPostInParent(e)&&(s.post_in_parent=e.postInParent);var i=ScheduleMessageUtils.getScheduleTimeOrScheduleStatus(e);return $.extend(s,i),MsgUtil.makePutRequest(t,s)},rescheduleAllMsgs:function(e){var t="/v2/chats/"+e.chatId+"/scheduledmessages",s=e.status?{status:e.status}:{time:e.time},i=ScheduleMessageUtils.getScheduleTimeOrScheduleStatus(e);return $.extend(s,i),MsgUtil.makePutRequest(t,s)},fetchAllScheduledMessages:function(e){var t={limit:25};return e.nextToken&&(t.next_token=e.nextToken),MsgUtil.makeGetRequest("/v2/scheduledmessages",t)}},CwinScheduleMessageState=function(e,t){this.scheduleMsgCwin=e,this.scheduleMessagePopUp=t,this.initState()};CwinScheduleMessageState.prototype={initState:function(){var e=this;this.state={isScheduledMessageWindowRendered:function(){return e.scheduleMsgCwin.getState().rendered},isCwinInSchedulingMode:function(){return this.isSchCwinInExpandedMode()&&this.hasScheduledTime()},hasScheduledTime:function(){return e.scheduleMsgCwin.hasScheduledTime()},isSchCwinInCollapsedMode:function(){return e.scheduleMsgCwin.getState().collapsedWin},isSchCwinInExpandedMode:function(){return e.scheduleMsgCwin.getState().expandedWin}}},getState:function(){return this.state}};var CwinScheduleMessageController=function(e,t){this.parentCwinInstance=e,this.chatId=t,this.scheduleMsgCwin=new $ScheduleMsgCwin(this.getPropsForScheduleCwin()),this.scheduleMessagePopUp=new ScheduleMessageSelectionPopUpUi(this.getPropsForSelectionPopUp()),this.scheduleMsgState=new CwinScheduleMessageState(this.scheduleMsgCwin,this.scheduleMessagePopUp).getState(),Config.isScheduleMessagePromptEnabled()&&(this.scheduleMsgPrompt=new ScheduleMessagePromptUI(this.getParamsForScheduleMsgPrompt()))};CwinScheduleMessageController.prototype={isCwinExpandedButNotInSchedulingMode:function(){return this.scheduleMsgState.isSchCwinInExpandedMode()&&!this.isInSchedulingMode()},isScheduleMsgCwinOpened:function(){return this.scheduleMsgState.isSchCwinInExpandedMode()},isInSchedulingMode:function(){return this.scheduleMsgState.isCwinInSchedulingMode()},$getParentCwinDom:function(){return this.parentCwinInstance.win()},getScheduledTimeStamp:function(){return this.scheduleMsgCwin.getScheduledTimeStamp()},onScheduleMessageIconClick:function(e){e=e||{onDoneBtnClick:this.onSchedulePopUpDoneBtnClick.bind(this)};var t={timeStamp:this.getScheduledTimeStamp()||this.getSuggestedScheduledTimeFromPrompt(),isReschedule:!1,timezone:this.getScheduledTimezone()};this.scheduleMessagePopUp.renderLoader().positionAbove(this.getScheduleMsgPopUpTriggeringEle()),this.scheduleMessagePopUp.fetchAdditionalDetails().then(s=>{if("object"==typeof s[0]&&s[0].hasOwnProperty("checkin_status")){var i=s[0].checkInCheckOutViewPermissionRestricted||!RemoteWork.isCheckInAllowed();$.extend(t,{isUserDetailsFetched:!0,ischeckInCheckOutViewPermissionRestricted:i})}this.renderScheduleMsgPopUp(e,t)}).catch(s=>{this.renderScheduleMsgPopUp(e,t)})},renderScheduleMsgPopUp:function(e,t){e=e||{},t=t||{};this.scheduleMessagePopUp.updateState(t).updateProps(e).render().positionAbove(this.getScheduleMsgPopUpTriggeringEle())},isScheduledPopUpOpened:function(){return this.scheduleMessagePopUp.isRenderedAlready()},onrescheduleMsgIconClick:function(e){var t={timeStamp:this.scheduleMsgCwin.getMessage(e).getScheduleTime(),timezone:this.scheduleMsgCwin.getMessage(e).getScheduleTimezone(),schMsgUid:e,isReschedule:!0,triggeringEle:this.getScheduleMsgPopUpTriggeringEle()};this.scheduleMessagePopUp.renderLoader().positionAbove(this.getScheduleMsgPopUpTriggeringEle()),this.scheduleMessagePopUp.fetchAdditionalDetails().then(e=>{if("object"==typeof e[0]&&e[0].hasOwnProperty("checkin_status")){var s=e[0].checkInCheckOutViewPermissionRestricted||!RemoteWork.isCheckInAllowed();$.extend(t,{isUserDetailsFetched:!0,ischeckInCheckOutViewPermissionRestricted:s})}this.renderScheduleMsgPopUp(this.getPropsForSelectionPopUp(),t)}).catch(e=>{this.renderScheduleMsgPopUp(this.getPropsForSelectionPopUp(),t)})},getScheduleMsgPopUpTriggeringEle:function(){return this.$scheduleMsgPopUpTriggeringEle?this.$scheduleMsgPopUpTriggeringEle:this.$getParentCwinDom().find(this.domSelectors.scheduleMessageIcon)},setScheduleMsgPopUpTriggeringEle:function(e){this.$scheduleMsgPopUpTriggeringEle=e},getStorage:function(){return this.scheduleMsgCwin.getStorage()},getScheduledMsgCwin:function(){if(!window.Proxy)return this.scheduleMsgCwin;var e=ScheduleMessageUtils.getDummyCwinObj();return new Proxy(this.scheduleMsgCwin,{get:function(t,s){return!(s in t)&&s in e&&(t[s]="function"==typeof e[s]?function(){}:void 0),t[s]}})},getParentCwinChatId:function(){return this.parentCwinInstance.getChid()},getMessagePosition:function(e){return this.scheduleMsgCwin.getMessagePosition(e)},renderScheduleMessageWindowInCollapsedMode:function(e){if(this.scheduleMsgState.isScheduledMessageWindowRendered())return this;var t=this.$getParentCwinDom();t.addClass(this.CONSTANTS.PARENTCWIN_SCH_MSG_CLASS+" "+this.CONSTANTS.SCH_MSG_COLLAPSE_CLASS);var s=t.find(this.domSelectors.parentCwinScheduleMsgContainer);return this.scheduleMsgCwin.updateTotalScheduledMessageCount(e),s.html(this.scheduleMsgCwin.render().$getElement()),this},renderScheduleMessageWindowInExpandedMode:function(e){this.renderScheduleMessageWindowInCollapsedMode(e),this.scheduleMsgCwin.expandWindow()},fetchScheduleMessageInitialTranscript:function(){this.scheduleMsgCwin.makeInitialFetch()},getPropsForScheduleCwin:function(){return{chatId:this.chatId,onExpand:this.onSchCwinExpand.bind(this),onCollapse:this.onSchCwinCollapse.bind(this),onDestroy:this.onSchCwinDestroy.bind(this),onCancelScheduling:this.onCancelScheduling.bind(this),onScheduleTimeChange:this.onScheduleTimeChange.bind(this)}},getPropsForSelectionPopUp:function(){return{chatId:this.chatId,onDestroy:this.onScheduleMessagePopUpDestroy.bind(this),onRescheduleBtnClick:this.rescheduleMessage.bind(this),getMsgPosition:this.getMessagePosition.bind(this)}},onScheduleTimeChange:function(e){this.parentCwinInstance.getDomCache().getComposer().attr("placeholder",e)},onSchedulePopUpDoneBtnClick:function(e){this.handleBeforeSchedulingMessages(),this.triggerSendMessageFromCwinComposer()},handleBeforeSchedulingMessages:function(){this.scheduleMsgState.isScheduledMessageWindowRendered()||this.renderScheduleMessageWindowInCollapsedMode(0),this.toggleSchedulingModeCss(!0),this.scheduleMsgCwin.updateScheduledTimeStamp(this.scheduleMessagePopUp.getScheduledTimeStamp()),this.scheduleMsgCwin.updateScheduledTimezone(this.scheduleMessagePopUp.getTimezone()),this.destroyPopUpView(),this.scheduleMsgCwin.afterExpandWindow()},rescheduleMessage:function(e){if(!e.isRescheduleAll){var t={chatId:this.getParentCwinChatId(),schMsgId:this.scheduleMessagePopUp.getScheduleMsgUid(),scheduledTimeStamp:this.scheduleMessagePopUp.getScheduledTimeStamp(),rescheduleAll:e.isRescheduleAll,timezone:this.scheduleMessagePopUp.getTimezone()},s=this.scheduleMsgCwin.getMessage(t.schMsgId);return ScheduleMessageUtils.canPostMsgInParentChat(this.getParentCwinChatId(),s)&&(t.postInParent=!0),this.destroyPopUpView(),ScheduleMessageApis.rescheduleMsg(t).then(e=>this.onRescheduleMessageSuccessCb(e,t.schMsgId))}this.rescheduleAllMessagesByTime(e)},rescheduleAllMessagesByTime:function(e){var t=this.scheduleMsgCwin.getMessage(this.scheduleMessagePopUp.getScheduleMsgUid()).getScheduleTime(),s={chatId:this.getParentCwinChatId(),time:ScheduleMessageUtils.isCustomOptionSelected(t)?Date.now():t,scheduledTimeStamp:e.selectedTimeStamp};return ScheduleMessageUtils.isCustomOptionSelected(t)&&(s.status=t),this.destroyPopUpView(),ScheduleMessageApis.rescheduleAllMsgs(s).then(e=>this.onRescheduleAllMessagesByTimeSuccessCb(e,s.schMsgId))},getSchedulePopUp:function(){return this.scheduleMessagePopUp},onRescheduleMessageSuccessCb:function(e,t){UI.updateBanner(I18N("schmsg.reschedule.success")),this.scheduleMsgCwin.getStorage().deleteMessage(t),this.scheduleMessageSuccessCb(e,!0),this.scheduleMsgCwin.updateScheduledTimeStampBasedOnLastSchTime()},onRescheduleAllMessagesByTimeSuccessCb:function(e){var t=this.scheduleMsgCwin.getView().getContainer();t.css("min-height",t.outerHeight()),UI.updateBanner(I18N("schmsg.rescheduleall.success")),this.scheduleMsgCwin.destroyAndInitMessageStorage(),this.scheduleMsgCwin.makeInitialFetch().then(()=>t.css("min-height","")),this.scheduleMsgCwin.updateScheduledTimeStampBasedOnLastSchTime()},destroyPopUpView:function(){this.scheduleMessagePopUp.destroyView()},triggerSendMessageFromCwinComposer:function(){var e=this.parentCwinInstance.getDomCache().getComposer()[0];e&&Composer.sendMsgOnEnter(this.getParentCwinChatId(),e)},scheduleTextMessage:function(e){if(!this.isMaximumScheduleMsgLimitReached(1)){var t={chatId:this.getParentCwinChatId(),text:e.message,currTime:e.currTime,scheduledTimeStamp:e.scheduledTimeStamp||this.scheduleMsgCwin.getScheduledTimeStamp(),replyTo:e.replyTo,replyFrom:e.replyFrom,timezone:e.timezone||this.scheduleMsgCwin.getScheduledTimezone(),postInParent:e.postInParent};ScheduleMessageUtils.isWDPickerMessage(e)&&(t.workdrive_data=e.workdrive_data);var s=this;return ScheduleMessageApis.scheduleTextMsg(t).then(e=>this.scheduleMessageSuccessCb(e),(function(t){var i=MsgConstants.retryErrors.API_FAILURE;t&&0==t.status&&(i=MsgConstants.retryErrors.NETWORK_FAILURE),s.scheduleMessageFailureCb(e.currTime,i)}))}this.disableScheduleMsgComposer()},disableScheduleMsgComposer:function(){this.parentCwinInstance.disableComposer(this.getParentCwinChatId(),Resource.getRealValue("schmsg.limit.header",[ScheduleMessageUtils.CONSTANTS.max_limit]),null,{isScheduleMsgMax:!0})},isMaximumScheduleMsgLimitReached:function(e){return ScheduleMessageUtils.CONSTANTS.max_limit<this.scheduleMsgCwin.getStorage().getListSize()+e},hasMessageStorage:function(){return this.scheduleMsgCwin.hasMessageStorage()},initScheduleMessageStorage:function(){this.scheduleMsgCwin.initMessageStorageAndView()},editMessage:function(e){var t={chatId:this.getParentCwinChatId(),text:e.message,schMsgId:e.msguid,scheduledTimeStamp:this.scheduleMsgCwin.getMessage(e.msguid).getScheduleTime(),files:e.files,att_removed:e.att_removed,additionalAjaxOptions:e.additionalAjaxOptions},s=this.scheduleMsgCwin.getMessage(e.msguid);if(s.isReplyMessage()){var i=s.getReplyMsgInfo();t.replyTo=i.msguid,t.replyFrom=i.chid}return ScheduleMessageUtils.canPostMsgInParentChat(this.getParentCwinChatId(),s,!0)&&(t.postInParent=!0),Config.isAttachmentUploadOptimised()&&ScheduleMessageUtils.hasFiles(t)?ScheduleMessageApis.editMsg(t):ScheduleMessageApis.editMsg(t).then(e=>this.onEditScheduleMsgSuccessCb(e))},handleResend:function(e){var t=this.scheduleMsgCwin.getStorage().getList().getMessage(e);if(t){var s={message:t.getObject().msg,currTime:t.getMsguid(),scheduledTimeStamp:t.getScheduleTime()};this.scheduleTextMessage(s)}},handleRemoveMsg:function(e){this.scheduleMsgCwin.getStorage().deleteMessage(e,!0),0==this.scheduleMsgCwin.getTotalSchMsgCount()&&this.scheduleMsgCwin.handleAllSchMsgRemoval()},handleResendAll:function(){this.scheduleMsgCwin.getStorage().handleReSendAll()},scheduleAttachmentMessage:function(){},getScheduledTimezone:function(){return this.scheduleMsgCwin.getScheduledTimezone()},handleNewMessage:function(e){this.scheduleMsgCwin.getMessageStorage().addNewMessage(e),e.msgobj.mtype==$zcg.ATTACHMENT_MTYPE&&this.scheduleMsgCwin.getMessageStorage().getView().handleViewableArea()},handleEditMessage:function(e){this.scheduleMsgCwin.getMessageStorage().editMessage(e)},scheduleMessageSuccessCb:function(e,t){this.scheduleMsgState.isScheduledMessageWindowRendered()?!t&&this.scheduleMsgCwin.increaseTotalMsgCountByOne().expandWindow():this.renderScheduleMessageWindowInExpandedMode(1);var s=ScheduleMessageUtils.mockScheduleMessageObjAsNormalMessageObj([e])[0];this.handleNewMessage(MessageFactory(s,this.chatId)),this.enableComposer(),this.toggleScheduleIconInTopBar(!0)},toggleScheduleIconInTopBar:function(e){var t=ScheduleMessageUtils.getTopBarEle();t.find("."+this.CONSTANTS.SCHEDULEICONCLS).removeClass("dN"),t.find(this.domSelectors.topBarScheduleEle).removeClass("dN")},scheduleMessageFailureCb:function(e,t){this.scheduleMsgCwin.getStorage().handleSendFailed(e,t)},onEditScheduleMsgSuccessCb:function(e){var t=ScheduleMessageUtils.mockScheduleMessageObjAsNormalMessageObj([e])[0];this.scheduleMsgCwin.getMessage(t.msguid).setEditProperties(null),this.scheduleMsgCwin.getMessageStorage().editMessage(MessageFactory(t,this.chatId))},deleteScheduleMessage:function(e){if(this.scheduleMsgCwin.hasMessage(e)){ScheduleMessageUtils.renderConfirmDialog({type:"DELETE"}).then(()=>ScheduleMessageApis.deleteScheduleMessage({chatId:this.chatId,schMsgId:e}).then(t=>this.deleteSchMsgSuccessCb(e)))}},deleteSchMsgSuccessCb:function(e,t){this.scheduleMsgCwin.hasMessage(e)&&(this.scheduleMsgCwin.getStorage().deleteMessage(e),this.scheduleMsgCwin.getTotalSchMsgCount()>0&&this.scheduleMsgCwin.decreaseTotalMsgCountByOne(),0==this.scheduleMsgCwin.getTotalSchMsgCount()&&this.scheduleMsgCwin.handleAllSchMsgRemoval(),t?UI.updateBanner(I18N("schmsg.send.success")):UI.updateBanner(I18N("schmsg.delete.success")),this.enableComposer())},sendScheduleMessage:function(e){this.scheduleMsgCwin.hasMessage(e)&&(this.scheduleMsgCwin.disableHoverByMsgUid(e),ScheduleMessageApis.sendNow({chatId:this.chatId,schMsgId:e}).then(()=>this.onSendNowSuccess(e),()=>this.onSendNowFailure(e)))},onSendNowSuccess:function(e){this.deleteSchMsgSuccessCb(e,!0),this.scheduleMsgCwin.enableHoverByMsgUid(e)},onSendNowFailure:function(e){this.scheduleMsgCwin.enableHoverByMsgUid(e)},onScheduleMessagePopUpDestroy:function(){this.$getParentCwinDom().find(this.domSelectors.scheduleMessageIcon).removeClass("sel")},onSchCwinExpand:function(){this.toggleExpandAndCollapseClass(!0),this.onComposerNotEmpty(),this.parentCwinInstance.focus(),this.scheduleMsgState.hasScheduledTime()&&this.toggleSchedulingModeCss(!0),this.isMaximumScheduleMsgLimitReached(1)&&this.disableScheduleMsgComposer(),Config.isScheduleMessagePromptEnabled()&&this.scheduleMsgPrompt.destroy()},onSchCwinCollapse:function(){this.toggleExpandAndCollapseClass(!1),this.parentCwinInstance.focus(),this.showDefaultComposerOptions(),this.enableComposer()},enableComposer:function(){var e=this.parentCwinInstance;e.iscomposerdisabled&&e.enableComposer(this.getParentCwinChatId(),{isEnableComposerOnScheduleCollapse:!0})},onSchCwinDestroy:function(){this.showDefaultComposerOptions()},showDefaultComposerOptions:function(){Composer.hasMessage(this.parentCwinInstance.getDomCache().getComposer()[0])?this.onComposerNotEmpty():this.onComposerEmpty()},onCancelScheduling:function(){this.scheduleMsgCwin.resetScheduledTimeStamp(),this.toggleSchedulingModeCss(!1)},onComposerNotEmpty:function(){this.scheduleMsgState.isCwinInSchedulingMode()||(this.toggleScheduleIconAndVoiceRecordingIcon(!0),this.scheduleMsgPrompt&&(this.scheduleMsgPrompt.isPromptHidden&&this.scheduleMsgPrompt.toggleScheduleMsgPrompt(!0),!this.scheduleMsgPrompt.canShowPrompt()||this.scheduleMsgPrompt.hasRendered()||this.scheduleMsgPrompt.hasPromptAutoDestroyed()||this.scheduleMsgPrompt.hasSnoozed()||this.scheduleMsgPrompt.hasValidPrompt()&&this.scheduleMsgPrompt.render()))},onComposerEmpty:function(){this.scheduleMsgState.isCwinInSchedulingMode()||(this.toggleScheduleIconAndVoiceRecordingIcon(!1),Config.isScheduleMessagePromptEnabled()&&ConversationsList.isOnetoOneChat(this.chatId)&&this.scheduleMsgPrompt.hasRendered()&&this.scheduleMsgPrompt.destroy())},hasPromptRenderCriteriaFullfilled:function(){return this.scheduleMsgPrompt.hasStatus()},handleStatusChange:function(e){e&&(this.scheduleMsgPrompt.hasValidPrompt()?(this.updatePromptIfAnyUploadUIExist(),this.parentCwinInstance.isComposerEmpty||this.scheduleMsgPrompt.render()):this.scheduleMsgPrompt.destroy())},updatePromptIfAnyUploadUIExist:function(){var e=ScheduleMessageUtils.getOpenedFileUploadModal();e&&e.updateScheduleMsgPrompt()},getScheduleMsgPrompt:function(){return this.scheduleMsgPrompt},toggleExpandAndCollapseClass:function(e){this.$getParentCwinDom().toggleClass(this.CONSTANTS.SCH_MSG_EXPAND_CLASS,e),this.$getParentCwinDom().toggleClass(this.CONSTANTS.SCH_MSG_COLLAPSE_CLASS,!e)},toggleScheduleIconAndVoiceRecordingIcon:function(e){this.$getParentCwinDom().find(this.domSelectors.scheduleMessageIcon).toggleClass("dN",!e),this.$getParentCwinDom().find(this.domSelectors.voiceNoteIcon).toggleClass("dN",e)},toggleSchedulingModeCss:function(e){this.$getParentCwinDom().toggleClass("sch-mode",!!e)},disableScheduleMsg:function(){this.$getParentCwinDom().find(this.domSelectors.parentCwinScheduleMsgContainer).toggleClass(this.CONSTANTS.SCH_MSG_HIDE_CLS)},getParamsForScheduleMsgPrompt:function(){return{chatId:this.chatId,scheduleMessagePopUp:this.scheduleMessagePopUp,$cwin:this.$getParentCwinDom()}},getScheduleMsgPromptHTML:function(){return this.scheduleMsgPrompt.getPromptHTML()},getSuggestedScheduledTimeFromPrompt:function(){if(Config.isScheduleMessagePromptEnabled()&&ConversationsList.isOnetoOneChat(this.chatId)){var e=this.scheduleMessagePopUp;return e.getStatusCodeDisplayName(e.getStatusCode())}},handleScheduleMsgCwinClosed:function(){this.scheduleMessagePopUp.destroyView(),this.scheduleMsgCwin.destroy(),this.parentCwinInstance=null,this.scheduleMsgState=null,this.scheduleMsgCwin=null,this.scheduleMessagePopUp=null},CONSTANTS:{PARENTCWIN_SCH_MSG_CLASS:"zcsched-msg",SCH_MSG_COLLAPSE_CLASS:"zcsched-collapse",SCH_MSG_EXPAND_CLASS:"zcsched-expand",COMPOSER:"#composer",SCH_MSG_HIDE_CLS:"zcsched-hide",SCHEDULEICONCLS:"zcf-schedule"},domSelectors:{scheduleMessageIcon:"#schedule-msg-icon",voiceNoteIcon:"#voice-note-icon-dummy",parentCwinScheduleMsgContainer:"#scheduled-message-window-container",topBarScheduleEle:"#ztb-topBarScheduleMsgIcon"}};var ScheduleMessageRHSListings=function(){var e="[data-type='time']",t="[data-type='optionicon']",s="#schedulelistoptions",i="#sticky_date_item",n="#historyMainContainer",a={},o=120,d="scheduledListView",c={openScheduleMsgListOptions:function(e){var t=e.target.getAttribute("data-messageuid"),i=e.target.getAttribute("data-chid"),n=e.target.getAttribute("data-time"),a=e.target,o=this.getHistoryViewContainer();Clickoutside.handleClickOnChild(e),r(h,o);var d=[{val:I18N("chat.sendnow"),action:"sendNow"},{val:I18N("common.gotochat"),action:"openChat"},{val:I18N("common.delete"),action:"deleteScheduledMsg",isneg:!0}],c="";d.forEach((function(e){c+=$WC.template.replace(HistoryTemplate.action,{actionName:e.val,className:e.isneg?"zcl-neg-menu-item":"",action:e.action,schMsgUid:t,chid:i,msgTime:n})}));var u=$WC.template.replace(HistoryTemplate.msgOptions,{actions:c},"InSecureHTML");o.find("[data-messageuid="+t+"]").html(u);var g={event:e,srcid:t,destid:"schedulelistoptions",customShow:function(e){h=t,l(o,a),o.find(s).removeClass("dN")},customHide:function(){o.find(s).remove(),r(h,o),h=null}};Clickoutside.bind(g)},openChat:function(e){var t=e.target.getAttribute("data-chid"),s=e.target.getAttribute("data-schmsguid");Clickoutside.handleClickOnChild(e),$WC.$Win.destroy(d),Chat.jumpToConversation(t,!1,s,void 0,void 0,void 0,void 0,!0)},sendNow:function(e){e.stopImmediatePropagation();var t=e.target.dataset,s={chatId:t.chid,schMsgId:t.schmsguid,schMsgTime:t.time};ScheduleMessageApis.sendNow(s).then(()=>this.onSendSchMsgSuccessCb(s,!0),()=>this.handleScheduleMsgFailure())},deleteScheduledMsg:function(e){var t=e.target.dataset,s={chatId:t.chid,schMsgId:t.schmsguid,schMsgTime:t.time};ScheduleMessageUtils.renderConfirmDialog({type:"DELETE"}).then(()=>ScheduleMessageApis.deleteScheduleMessage(s).then(()=>this.deleteSchMsgSuccessCb(s)))},onSendSchMsgSuccessCb:function(e,t){this.showSentSuccessMsgBanner(e),this.handleBeforeRemovingMsg(e,t)},showSentSuccessMsgBanner:function(e){ChatUI.getWin(e.chatId)||UI.updateBanner(I18N("schmsg.send.success"))},deleteSchMsgSuccessCb:function(e){this.showDeleteMsgBanner(e),this.handleBeforeRemovingMsg(e)},showDeleteMsgBanner:function(e){ChatUI.getWin(e.chatId)||UI.updateBanner(I18N("schmsg.delete.success"))},handleBeforeRemovingMsg:function(e,t){this.removeScheduledMessage(e),this.deleteMsgInCwinAndStorage(e,t),this.showEmptyStateIfScheduleMsgListIsEmpty()},removeScheduledMessage:function(e){this.removeDateFromScheduleListObj(e),this.removeMsgFromView(e),this.removeDateFromView(e)},removeDateFromScheduleListObj:function(e){a[e.schMsgTime]=a[e.schMsgTime].filter(t=>e.schMsgId!==t)},showEmptyStateIfScheduleMsgListIsEmpty:function(){this.isSchMsgListEmpty()&&this.getHistoryViewContainer().find(n).html(TemplateUtil.noCategoryResult(I18N("schmsg.list.empty"),'<div class="zcschedulelist-empty"></div>',""))},isSchMsgListEmpty:function(){return 0==Object.keys(a).length},removeDateFromView:function(e){if(0==a[e.schMsgTime].length){var t=this.getHistoryViewContainer();t.find("[data-time="+e.schMsgTime+"]").remove(),this.isStickyDate(e)&&(t.find(i).empty(),$Util.initializeStickyTitle($("#scheduledListView"))),delete a[e.schMsgTime]}},deleteMsgInCwinAndStorage:function(e,t){var s=ChatUI.getWin(e.chatId);s&&s.hasScheduleMessageController()&&s.getScheduleMessageController().deleteSchMsgSuccessCb(e.schMsgId,t)},handleScheduleMsgFailure:function(){UI.updateBanner(I18N("apierror.message.two"))},isStickyDate:function(e){var t=this.getHistoryViewContainer().find(i).text();return ScheduleMessageUtils.getRecipientStatusMap(e.schMsgTime,e.chatId)==t||$Date.date(e.schMsgTime)==t},removeMsgFromView:function(e){var t=this.getHistoryViewContainer().find("[data-msguid="+e.schMsgId+"]"),s=t.prev().attr("data-time"),i=t.next().attr("data-time"),n=!!i&&$Date.isSameDay(t.attr("data-time"),i),a=!!s&&$Date.isSameDay(t.attr("data-time"),s);if(!(n||a)){var o=t.parent();o.prev().remove(),o.remove()}this.getHistoryViewContainer().find("[data-msguid="+e.schMsgId+"]").remove()}},l=function(e,t){t=t.getBoundingClientRect();window.innerHeight-t.bottom<o&&e.find(s).css({top:`-${o}px}`})},h=void 0,r=function(s,i){i&&_rAF(()=>{i.find("[data-msguid="+s+"]").find(e).removeClass("dN"),i.find("[data-msguid="+s+"]").find(t).addClass("dN")})},u={uniqueid:"schedulemessagelisting",listDataParams:{action:"",onMouseOverCB:function(s,i){var n=s.currentTarget.getAttribute("data-msguid");_rAF(()=>{var s=i.find("[data-msguid="+n+"]");s.find(e).addClass("dN"),s.find(t).removeClass("dN")})},onMouseLeaveCB:function(e,t){var s=e.currentTarget.getAttribute("data-msguid");h!==s&&r(s,t)}},emptyStateParams:{defaultEmpty:{name:I18N("schmsg.list.empty"),className:"msg-container-empty"}},apiParams:{url:"/v2/scheduledmessages",payload:{limit:25}},isGroupView:!0,getMockResponse:function(e){var t=e,s=[];return t?(t.forEach((function(e,t){var i={messagetype:e.message.mtype,chat_type:e.message.ctype,message:"string"==typeof e.message.msg?e.message.msg:"",fname:e.message.fName,chid:e.message.chid,msguid:e.id,pcount:e.chat_details.pcount,recipants:e.chat_details.recipants||[],iscustomgroup:e.chat_details.iscustomgroup,ctitle:e.chat_details.title||" ",parent_chat_id:e.chat_details.parent_chat_id,ctype:e.message.ctype,meta:e.message.meta};ConversationsList.isOnetoOneChat(e.chid)&&(i.recipants="string"==typeof e.chat_details.recipientssumm?JSON.parse(e.chat_details.recipientssumm):e.chat_details.recipientssumm),s.push($.extend(e,i))})),ConversationsList.updateConversationsDB(t),function(e){e.forEach(e=>{e.time?a[e.time]=a[e.time]?a[e.time].concat(e.id):[].concat(e.id):e.schedule_status&&(a[e.schedule_status]=a[e.schedule_status]?a[e.schedule_status].concat(e.id):[].concat(e.id))})}(t),s):[]}};return{open:function(){var e={id:"scheduledListView",class:"modalwindow rhsoverly modalwindow2 configurationheader zcbg_mask zcscheduledlist",aligncenter:!1,header:`<div class='fontB mL15'>${I18N("schmsg.title")}</div>`,closeoutside:!0,html:'<div id="scheduledlistbody" class="scheduledlistbody h100"></div>',closefn:()=>{a={}}};$WC.$Win.create(e);var t=new HistoryViewController(u);Object.assign(HistoryViewController.prototype,c),$("#scheduledlistbody").html(t.getHTML())}}}(),ScheduleMessagePromptUI=function(e){this.chatId=e.chatId,this.scheduleMsgPopUp=e.scheduleMessagePopUp,this.additionalParams={}};ScheduleMessagePromptUI.prototype={render:function(){this.preRender(),this.$el.find(this.domSelectors.prompt).html(this.getPromptHTML()),this.postRender()},getPromptHTML:function(){return $WC.template.replace(this.template(),{schedulePromptText:this.getPromptContent()||""},"InSecureHTML")},preRender:function(){this.$el=this.getElement(),this.prevStatus=this.getStatusCode(),this.hasValidPrompt(this.prevStatus)&&this.bindEvents(this.getElement())},postRender:function(){this.hasValidPrompt(this.prevStatus)&&(this.toggleScheduleMsgPrompt(!0),this.promptRenderedInUI=!0)},hideOrShowPromptUI:function(e){this.$el.find(this.domSelectors.prompt).toggleClass("dN",!e)},hideOrShowActionButtons:function(e){this.$el.find(this.domSelectors.actionbtnContainer).toggleClass("dN",e)},isSameStatus:function(){return this.prevStatus==this.getStatusCode()},getStatusCode:function(){return this.scheduleMsgPopUp.getStatusCode()},getPromptContent:function(){return this.getPromptDisplayContent(this.getStatusCode())},updateActionButtonStyle:function(e){this.getElement().find(this.domSelectors.actionbtnContainer).toggleClass("mT5",e),this.getElement().find(this.domSelectors.promptContent).toggleClass("mB5",!e)},getPromptDisplayContent:function(e){var t=ConversationsList.get121RecipientIdFromChatId(this.chatId),s=Users.getName(t);if(s){var i={0:I18N("schmsg.prompt.offline",[s]),5:I18N("schmsg.prompt.dnd",[s]),7:I18N("schmsg.prompt.away",[s])};return i[e]?i[e]:""}},hasStatus:function(){return Boolean(this.getStatusCode())},hasValidPrompt:function(e){e=e||this.getStatusCode();return Boolean(this.getPromptDisplayContent(e))},autoDestroy:function(){},bindEvents:function(e){var t=this;e.on("click","[data-action]",(function(e){var s=e.target.dataset.action;s in t&&t[s](e)}))},getElement:function(){return this.$el||(this.$el=$("#"+this.chatId).find(this.domSelectors.compContainer))},hasPromptAutoDestroyed:function(){return Boolean(this.isPromptAutoDestroyed)},isStatusDND:function(){return this.CONSTANS.DND==this.getStatusCode()},closeSchedulePrompt:function(){this.snooze(),this.destroy()},destroy:function(e){this.$el&&(this.hideOrShowPromptUI(!1),this.hideOrShowActionButtons(!1),this.emptyPromptEle(),this.$el=null,this.updateActionButtonStyle(!1)),this.additionalParams.destroyPromptCB&&this.additionalParams.destroyPromptCB(e),this.prevStatus=null,this.promptRenderedInUI=!1,e==this.CONSTANS.DESTROY_TYPE&&(this.isPromptAutoDestroyed=!0)},snooze:function(){var e=Date.now();ScheduleMessageUtils.setPromptSnoozeTime(e),localStorage.setItem(this.CONSTANS.SNOOZE,e)},getSnoozedTime:function(){return localStorage.getItem(this.CONSTANS.SNOOZE)},hasSnoozed:function(){var e=ScheduleMessageUtils.getPromptSnoozeTime();return e=parseInt(e),!isNaN(e)&&Date.now()-e<this.CONSTANS.ONE_DAY},updateProps:function(e){return $.extend(this.additionalParams,e),this},emptyPromptEle:function(){this.$el.find(this.domSelectors.promptView).empty()},openScheduleMsgPopUp:function(e){var t=ChatUI.getWin(this.chatId);if(t&&t.hasScheduleMessageController()){var s=t.getScheduleMessageController();s.setScheduleMsgPopUpTriggeringEle($(e.target)),s.onScheduleMessageIconClick()}},hasRendered:function(){return Boolean(this.promptRenderedInUI)},toggleScheduleMsgPrompt:function(e){if(this.$el){this.hideOrShowPromptUI(e);var t=!!e&&this.isStatusDND();this.hideOrShowActionButtons(!!e&&!t),this.updateActionButtonStyle(t),this.isPromptHidden=!e}},canShowPrompt:function(){return void 0!==this.canPromptBeShow?this.canPromptBeShow:(this.canPromptBeShow=!(!ConversationsList.isOnetoOneChat(this.chatId)||ConversationsList.get(this.chatId).isGuestChat),this.canPromptBeShow)},CONSTANS:{LOGOUT:1,ONE_DAY:864e5,SNOOZE:"snoozePrompt",TEN_SECONDS:1e4,DND:5,DESTROY_TYPE:"auto"},domSelectors:{prompt:"#schedulemsgprompt",compContainer:"#composermain",actionbtnContainer:"#composer_wrapper",promptView:'[data-view="schedulemsgprompt"]',promptContent:'[data-view="promptcontent"]'},template:()=>Template.scheduleMsgPromptHTML};