var ClientFrame=function(){function e(e,t,n){this.frameSelector=e,this.domain=t,this.source=t+n,this.frameId="client-frame-"+e+"_"+Date.now(),this.isRendered=!1,this.callBackFrame=void 0,this._listeners=[]}function t(t,n){t instanceof e&&t.sendMessage(n)}return e.prototype.generateFrame=function(e,t){if(this.$iframeElement)return this.$iframeElement;this.$iframeElement=document.createElement("iframe"),this.$iframeElement.setAttribute("src",this.source),this.$iframeElement.setAttribute("id",this.frameSelector),this.$iframeElement.setAttribute("name",this.frameSelector),Object.assign(this.$iframeElement.style,e);var n=this;return this.$iframeElement.onload=function(){n.isRendered=!0,n.sendMessage({action:"client-frame",data:{status:"loaded",frameId:n.frameId}}),t&&t()},this.$iframeElement},e.prototype.render=function(e,t,n){this.isRendered||(this.generateFrame(t,n),e.appendChild(this.$iframeElement))},e.prototype.sendMessage=function(e){if(!this.isRendered)throw new Error("ClientFrame not rendered");this.$iframeElement.contentWindow.postMessage(e,this.domain)},e.prototype.listenMessage=function(e){var n;this.listenerAdded||(window.addEventListener("message",e=>{var n=e.data;if(n.frameId===this.frameId)switch(n.action){case"client-frame-render":n=n,this.getRendererFrame(function(e){e.showFrame(),t(e,n)});break;case"client-renderer-callback":!function(e,n){n.meta.showFrame||e.hideFrame(),t(e.callBackFrame,n)}(this,n);break;default:this._listeners.length>0&&this._listeners.forEach(function(t){try{t(n,e)}catch(e){Lyte.error(e)}})}}),this.listenerAdded=!0),"function"==typeof e&&this._listeners.push(e)},e.prototype.showFrame=function(){this.$iframeElement&&(this.$iframeElement.style.display="block")},e.prototype.hideFrame=function(){this.$iframeElement&&(this.$iframeElement.style.display="none")},e.prototype.deleteFrame=function(){this.$iframeElement&&this.$iframeElement.parentNode.removeChild(this.$iframeElement)},e.prototype.setRendererFrameProvider=function(e){this.rendererFrameProvider=e},e.prototype.getRendererFrame=function(e){var t=this;if("function"==typeof t.rendererFrameProvider)return t.rendererFrameProvider().then(function(n){n.callBackFrame=t,e(n)})},e}(),PB=PB||{};function initPBSDK(){return new Promise(function(e){var t=document.createElement("script");t.src=PBClient.getFingerPrintUsingFileName("pbone.js"),document.head.appendChild(t),t.onload=function(){ZPB.initPlatform(PB.serviceData),e()}})}function attachZTIListner(){window.ZTI&&(ZTI.handleCrossProductMessage=function(e){var t="test".constructor;if(e.constructor===t&&(e=JSON.parse(e)),e.action&&"reloadSDK"===e.action){var n=PB.serviceData.loadPB||!0;PB.pbxhr=new XMLHttpRequest,PB.pbxhr.open("GET",PB.server+"/phonebridge/integration/integrationREST?serviceName="+PB.serviceData.serviceName+"&serviceID="+PB.serviceData.serviceId+"&loadPB="+n,!0),PB.pbxhr.withCredentials=!0,PB.pbxhr.onreadystatechange=function(){if(this.readyState===this.DONE){var e,t=JSON.parse(PB.pbxhr.response);if(e=t.integResponse,PBClient.fingerPrintJson=t.parentFing,PBClient.log("Parent fing Loaded"),"true"===e||"syncuser"==e||"D_ORG"===e||"O_ORG"===e){PB.integEnabled="syncuser"!==e,PB.integRest=e;var n=document.getElementById("zpbsdk");void 0!=PB.serviceData.doNotDisturb&&!PB.serviceData.doNotDisturb&&n?(n.src=n.src,"SDPOnDemand"===PB.serviceData.serviceName&&window.callbackZPB&&callbackZPB()):initPBSDK().then(function(){window.callbackZPB&&callbackZPB()})}else PB.integRest="false","SDPOnDemand"===PB.serviceData.serviceName&&window.callbackZPB&&callbackZPB()}},PB.pbxhr.send(null)}else if(e.hasOwnProperty("CTDConfiguration"))for(var i=document.getElementsByTagName("zpb-phone"),r=0;r<i.length;r++)e.CTDConfiguration?i[r].component.setData("isCTD",!0):i[r].component.setData("isCTD",!1);e.subAction&&"alterModify"===e.subAction&&ZPB.sendMessage("zpbsetup",{action:"alterModify",providerID:e.providerID})})}function registerCustomTag(){Lyte.Component.register("zpb-phone",{_template:'<template tag-name="zpb-phone"><a class="pH2" title="Call" onclick="{{action(\'telcall\',event,number)}}"></a>\t</template>\n<style>.telIcon{ display: inline-block; width: 16px;height: 19px;background: transparent url(//static.zohocdn.com/phonebridge/images/svgicons.svg) no-repeat -160px -471px;margin-right: 6px;cursor: pointer;}</style>',_dynamicNodes:[{type:"attr",position:[0]}],_observedAttributes:["number","lyteUnbound"],data:function(){return{number:Lyte.attr("string"),lyteUnbound:Lyte.attr("boolean",{default:!1})}},actions:{telcall:function(e,t){e.stopPropagation(),window.location.href="tel:"+t}}})}PB.parts=location.hostname.split("."),PB.subdomain=PB.parts.shift(),PB.uplvldom=PB.parts.join("."),PB.server=PB.uplvldom.includes("tsi")?"https://phonebridge.csez.zohocorpin.com":"https://phonebridge."+PB.uplvldom,PB.serviceData=void 0,PB.jsurl="",PB.integEnabled=!1,PB.defaultOrgIntegEnabled=!1,PB.target="splitscreen",PB.integRest="false",PB.tagNeededProducts=["ZohoCRM","ZohoRecruit","Solution"],PB.cdnUrl="",PB.loadPromise=void 0,PB.init=function(e){PB.cdnUrl=PB.jsurl.substring(0,PB.jsurl.lastIndexOf("/"))+"/",PB.initFingFile(e)},PB.followUp=function(e){attachZTIListner(),PB.serviceData=e;var t=e.loadPB||!0;e.crmplusData&&!e.isUnifiedPB&&(PB.serviceData.serviceId=e.crmplusData.ZohoCRM||e.crmplusData.ZohoSupport||e.crmplusData.LiveDesk,PB.serviceData.serviceName=e.crmplusData.ZohoCRM?"ZohoCRM":e.crmplusData.ZohoSupport?"ZohoSupport":"LiveDesk","LiveDesk"===PB.serviceData.serviceName&&delete PB.serviceData.crmplusData),void 0!=e.pbDomain&&""!=e.pbDomain&&(PB.server=e.pbDomain),PB.pbxhr=new XMLHttpRequest,PB.pbxhr.open("GET",PB.server+"/phonebridge/integration/integrationREST?serviceName="+PB.serviceData.serviceName+"&serviceID="+PB.serviceData.serviceId+"&loadPB="+t,!0),PB.pbxhr.withCredentials=!0,PB.pbxhr.onreadystatechange=PB.ready,PB.pbxhr.send(null)},PB.initFingFile=function(e){var t=document.createElement("script");t.src=PB.jsurl+"/pcdn.js",t.onload=function(){PB.followUp(e)},document.head.appendChild(t)},PB.ready=function(){if(this.readyState===this.DONE){var e,t=JSON.parse(PB.pbxhr.response);if(e=t.integResponse,PBClient.fingerPrintJson=t.parentFing,PBClient.log("Parent fing Loaded"),PB.integRest=e,"true"===e||"syncuser"==e||"D_ORG"===e||"O_ORG"===e){if(PB.integEnabled="syncuser"!==e,"CRMPlus"===PB.serviceData.bundleService&&PB.serviceData.crmplusData&&"O_ORG"===e)return delete PB.serviceData.crmplusData[PB.serviceData.serviceName],PB.serviceData.serviceId=serviceData.crmplusData.ZohoSupport||serviceData.crmplusData.LiveDesk,PB.serviceData.serviceName=serviceData.crmplusData.ZohoSupport?"ZohoSupport":"LiveDesk",void PB.init(PB.serviceData);initPBSDK().then(function(){window.callbackZPB&&callbackZPB()})}else{if(PB.tagNeededProducts.includes(PB.serviceData.serviceName))if(window.Lyte)registerCustomTag();else{var n=document.createElement("script");n.src=wmsUserConfig.phonebridgejsurl.substring(0,wmsUserConfig.phonebridgejsurl.lastIndexOf("/"))+"/lyte-parent-dom.js",n.type="text/javascript",n.onload=function(){registerCustomTag()},document.head.appendChild(n)}if(window.Lyte){var i=Lyte.Router.getRouteInstance();i&&i.transition&&"crm.settings.section.telephony.marketplace"===i.transition.target&&!document.getElementById("zpbsetup")&&i.refresh()}window.callbackZPB&&callbackZPB()}}},PB.loadSetup=function(e,t,n){if("undefined"==typeof ZPB){var i=document.createElement("script");i.src=PBClient.getFingerPrintUsingFileName("pbone.js"),i.onload=function(){ZPB.initPlatform(PB.serviceData)},document.head.appendChild(i)}var r,a=document.location.origin,s="0";if(PB.serviceData&&PB.serviceData.serviceData&&PB.serviceData.serviceData.planId?s=PB.serviceData.serviceData.planId:PB.serviceData&&PB.serviceData.planId&&(s=PB.serviceData.planId),PB.serviceData.bundleService&&""!==PB.serviceData.bundleService){if("ZohoOne"===PB.serviceData.bundleService&&"ZohoOne"!==PB.serviceData.serviceName){var o=document.referrer;window.location!==window.parent.location&&document.referrer&&(o="https://"+(o=(o=document.referrer.split("https://"))[1].substr(0,o[1].indexOf("/")))),a=window.location!==window.parent.location?o+","+document.location.origin:document.location.origin}r="/phonebridge/viewcomponent/providers?frameorigin="+a+"&target="+PB.target+"&serviceName="+PB.serviceData.serviceName+"&serviceID="+PB.serviceData.serviceId+"&bundleService="+PB.serviceData.bundleService+"&bundleOrgId="+PB.serviceData.bundleOrgId+"&planId="+s}else r="/phonebridge/viewcomponent/providers?frameorigin="+a+"&target="+PB.target+"&serviceName="+PB.serviceData.serviceName+"&serviceID="+PB.serviceData.serviceId+"&planId="+s;if(document.location.origin.includes("bigin")){var c=document.createElement("div");c.id="loadingDivIblt",c.style=" position: fixed; top: 0; left: 0; right: 0; height: 3px; z-index: 800; background: #23ae73; transform: translateX(100%); overflow: hidden; animation: shift-rightwards 1.5s ease-in-out infinite; animation-delay: .8s; ",document.getElementById(t).appendChild(c)}var d,l={action:"setupPageReady",serviceID:PB.serviceData.serviceId,serviceName:PB.serviceData.serviceName,serviceData:PB.serviceData.serviceData,bundleService:PB.serviceData.bundleService,bundleOrgId:PB.serviceData.bundleOrgId,planId:PB.serviceData.planId},u={border:"none",width:"100%",height:e+"px"},m=function(){if(document.location.origin.includes("bigin")&&document.getElementById("phoneSetup"))try{document.getElementById("phoneSetup").removeChild(document.getElementById("loadingDivIblt"))}catch(e){PBClient.log("Exception ",e)}if(ZPB.sendMessage("zpbsetup",l),n){var e=null!==document.getElementById("pb_response")?document.getElementById("pb_response").value:"success";n(e)}},p=new ClientFrame("zpbsetup",PB.server,r);if(p.setRendererFrameProvider(function(){return d?new Promise(function(e){e(d)}):new Promise(function(e){(d=new ClientFrame("pb_renderer_frame",PB.server,"/phonebridge/ui/base?frameorigin="+a+"&serviceName="+PB.serviceData.serviceName+"&serviceId="+PB.serviceData.serviceId)).listenMessage(),d.render(document.body,{border:"none",position:"fixed",left:"0px",top:"0px",height:"100vh",width:"100vw","z-index":"400",display:"none"},function(){e(d)})})}),p.listenMessage(),t){var P=document.getElementById(t);return P.textContent="",void p.render(P,u,m)}return p.generateFrame(u,m)},PB.isIntegrationEnabled=function(){return PB.integEnabled},PB.isIntegrationEnabledinCurrentOrg=function(){return"D_ORG"===PB.integRest},PB.isDefaultIntegrationEnabled=function(){return"D_ORG"===PB.integRest},PB.getPhoneBridgeContainer=function(){return void 0!==PB.serviceData&&PB.serviceData.zpbContainerId?document.getElementById(PB.serviceData.zpbContainerId):"undefined"!=typeof WebMessanger&&WebMessanger.getPhoneBridgeContainer?WebMessanger.getPhoneBridgeContainer():null},null!==PB.getPhoneBridgeContainer()&&(PB.getPhoneBridgeContainer().style.visibility="hidden"),PB.enableSMS=function(e){PB.target="inbuiltSMS",PB.loadSetup(500,"pbSmsSetup",e)},PB.loadRecording=function(){var e=window.Lyte?PBClient.getFingerPrintUsingFileName("audio.js"):PBClient.getFingerPrintUsingFileName("lyte-audio.js");const t=new Promise(function(e,t){var n=document.createElement("LINK");n.rel="stylesheet";var i=window.Lyte?"audio-tag.css":"laudio-tag.css";n.href=PBClient.getFingerPrintUsingFileName(i),n.onload=function(){e()},document.head.appendChild(n),setTimeout(function(){t()}.bind(this),4e3)}),n=new Promise(function(t,n){var i=document.createElement("SCRIPT");i.type="text/javascript",i.src=e,i.onload=function(){t()},document.head.appendChild(i),setTimeout(function(){n()}.bind(this),4e3)});return Promise.all([t,n])};